<!DOCTYPE html>
<!-- saved from url=(0044)file:///C:/Users/user/Downloads/index_4.html -->
<html lang="ko"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ëª¬ìŠ¤í„° ì¹´ë“œ ì‹œìŠ¤í…œ v3</title>
<link href="file:///C:/Users/user/Downloads/index_files/css2" rel="stylesheet">
<style>
:root {
  --bg: #080a0f;
  --bg1: #0d1018;
  --bg2: #111520;
  --bg3: #161c2a;
  --border: #1e2a3d;
  --border2: #2a3a56;
  --border3: #3a5080;
  --t1:#9ca3af; --t2:#4ade80; --t3:#38bdf8; --t4:#a78bfa;
  --t5:#f97316; --t6:#f43f5e; --t7:#fbbf24; --t7g:rgba(251,191,36,.3);
  --gold:#e8b84b; --gold2:#f5d070;
  --silver:#8baabb; --green:#34d399; --red:#f87171; --blue:#60a5fa;
  --text1:#e2e8f4; --text2:#7a90b0; --text3:#3d5070;
  --pair-c:#34d399; --twopair-c:#22d3ee; --triple-c:#e8b84b;
  --fullhouse-c:#a78bfa; --straight-c:#f87171;
  --e1:#4ade80; --e2:#38bdf8; --e3:#a78bfa; --e4:#f97316; --e5:#f43f5e;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text1);font-family:'Noto Sans KR',sans-serif;min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background:
  radial-gradient(ellipse 80% 50% at 15% 0%,rgba(74,110,200,.06) 0%,transparent 60%),
  radial-gradient(ellipse 60% 40% at 85% 90%,rgba(139,92,246,.05) 0%,transparent 60%),
  url("data:image/svg+xml,%3Csvg width='40' height='40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 20 L20 0 L40 20 L20 40 Z' fill='none' stroke='%231a2540' stroke-width='0.5'/%3E%3C/svg%3E");
  pointer-events:none;z-index:0;}
.app{position:relative;z-index:1;max-width:1500px;margin:0 auto;padding:16px 20px 40px;}

/* í—¤ë” */
header{text-align:center;padding:20px 0 16px;margin-bottom:16px;position:relative;}
header::after{content:'';position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:300px;height:1px;background:linear-gradient(90deg,transparent,var(--gold),transparent);}
.header-title{font-family:'Cinzel Decorative',serif;font-size:22px;font-weight:900;letter-spacing:3px;background:linear-gradient(135deg,var(--gold2),var(--gold),#a07828);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.header-sub{font-family:'Rajdhani',sans-serif;font-size:11px;color:var(--text3);letter-spacing:4px;text-transform:uppercase;margin-top:3px;}

/* íƒ­ */
.tabs{display:flex;gap:3px;background:var(--bg1);border:1px solid var(--border);border-radius:8px;padding:3px;margin-bottom:16px;}
.tab-btn{flex:1;padding:9px 12px;background:transparent;border:none;color:var(--text2);font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:600;letter-spacing:1px;cursor:pointer;border-radius:6px;transition:all .2s;text-transform:uppercase;}
.tab-btn:hover{color:var(--text1);background:var(--bg2);}
.tab-btn.active{background:var(--bg3);color:var(--gold);border:1px solid var(--border2);}

/* íŒ¨ë„ */
.panel{background:var(--bg1);border:1px solid var(--border);border-radius:10px;overflow:hidden;}
.panel-hd{padding:11px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;}
.panel-title{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;letter-spacing:2px;color:var(--gold);text-transform:uppercase;}
.panel-bd{padding:16px;}
.main-grid{display:grid;grid-template-columns:360px 1fr;gap:16px;}
.col{display:flex;flex-direction:column;gap:16px;}
@media(max-width:900px){.main-grid{grid-template-columns:1fr;}}

/* í¼ */
.form-group{margin-bottom:13px;}
.form-label{display:block;font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;color:var(--text2);letter-spacing:2px;text-transform:uppercase;margin-bottom:5px;}
.form-input{width:100%;padding:8px 11px;background:var(--bg);border:1px solid var(--border);border-radius:5px;color:var(--text1);font-family:'Noto Sans KR',sans-serif;font-size:12px;outline:none;transition:border-color .2s;}
.form-input:focus{border-color:var(--border3);box-shadow:0 0 0 2px rgba(74,110,200,.12);}
.stat-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}

/* í‹°ì–´ ë²„íŠ¼ */
.tier-selector{display:flex;gap:4px;flex-wrap:wrap;}
.tier-btn{flex:1;min-width:40px;padding:6px 4px;border:1px solid var(--border);background:var(--bg);color:var(--text3);border-radius:5px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;text-align:center;transition:all .2s;}
.tier-btn:hover{opacity:.85;}
.tier-btn.active {
  color: #fff !important; /* ê¸€ììƒ‰ì„ í°ìƒ‰ìœ¼ë¡œ ê³ ì • */
  font-weight: 800;
}
.tier-btn[data-tier="1"].active { background: var(--t1); border-color: var(--t1); }
.tier-btn[data-tier="2"].active { background: var(--t2); border-color: var(--t2); }
.tier-btn[data-tier="3"].active { background: var(--t3); border-color: var(--t3); }
.tier-btn[data-tier="4"].active { background: var(--t4); border-color: var(--t4); }
.tier-btn[data-tier="5"].active { background: var(--t5); border-color: var(--t5); }
.tier-btn[data-tier="6"].active { background: var(--t6); border-color: var(--t6); }
.tier-btn[data-tier="7"].active { background: var(--t7); border-color: var(--t7); color: #1a0f00 !important; }
/* ë²„íŠ¼ */
.btn-primary{width:100%;padding:11px;background:linear-gradient(135deg,#152040,#1e3060);border:1px solid var(--border3);color:var(--gold2);font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;letter-spacing:2px;border-radius:6px;cursor:pointer;text-transform:uppercase;transition:all .2s;position:relative;overflow:hidden;}
.btn-primary::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.05),transparent);transition:left .4s;}
.btn-primary:hover::before{left:100%;}
.btn-primary:hover{border-color:var(--gold);box-shadow:0 0 16px rgba(232,184,75,.15);transform:translateY(-1px);}
.btn-danger{padding:4px 9px;background:rgba(248,113,113,.1);border:1px solid rgba(248,113,113,.25);color:var(--red);border-radius:4px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;transition:all .2s;}
.btn-danger:hover{background:rgba(248,113,113,.25);}
.btn-sm{padding:4px 10px;background:rgba(60,80,150,.2);border:1px solid var(--border);color:var(--silver);border-radius:4px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;transition:all .2s;}
.btn-sm:hover{background:rgba(60,80,150,.4);border-color:var(--border2);}

/* ê°•í™” ë²„íŠ¼ (ì¸ë²¤í† ë¦¬ ì¹´ë“œìš©) */
.btn-enh{padding:4px 9px;background:rgba(249,115,22,.1);border:1px solid rgba(249,115,22,.3);color:#fb923c;border-radius:4px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;transition:all .2s;letter-spacing:.5px;}
.btn-enh:hover{background:rgba(249,115,22,.25);border-color:#fb923c;}

/* ìŠ¬ë¡¯ ê°•í™” ë²„íŠ¼ */
.slot-enh-btn{
  margin-top:5px;width:84px;
  padding:4px 0;
  background:rgba(249,115,22,.12);border:1px solid rgba(249,115,22,.35);
  color:#fb923c;border-radius:4px;cursor:pointer;
  font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;
  letter-spacing:.5px;transition:all .2s;
}
.slot-enh-btn:hover{background:rgba(249,115,22,.3);border-color:#fb923c;box-shadow:0 0 8px rgba(249,115,22,.2);}


/* --- ê°•í™” ë‹¨ê³„ ë²„íŠ¼ ì „ìš© ë””ìì¸ --- */
/* 1. ê¸°ë³¸ ìƒíƒœ */
.step-btn {
  flex: 1;
  min-width: 40px;
  padding: 8px 4px;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--text3); /* í‰ì†Œì—” ëˆˆì— ëœ ë„ê²Œ */
  border-radius: 5px;
  cursor: pointer;
  font-family: 'Rajdhani', sans-serif;
  font-size: 11px;
  font-weight: 700;
  transition: all 0.2s;
}

/* 2. ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ */
.step-btn:hover:not(.active) {
  background: var(--bg3);
  color: var(--text1);
}

/* 3. í´ë¦­í•´ì„œ ì„ íƒë˜ì—ˆì„ ë•Œ (ê°€ì¥ ì¤‘ìš”) */
.step-btn.active {
  background: rgba(232, 184, 75, 0.2) !important; /* ì€ì€í•œ ê³¨ë“œ ë°°ê²½ */
  color: var(--gold2) !important;                  /* í°íŠ¸ë¥¼ ê³¨ë“œìƒ‰ìœ¼ë¡œ ê³ ì • (ê²€ì • ë°©ì§€) */
  border: 1px solid var(--gold) !important;       /* í…Œë‘ë¦¬ ê°•ì¡° */
  text-shadow: 0 0 8px rgba(232, 184, 75, 0.6);   /* ê¸€ì ë°œê´‘ íš¨ê³¼ */
  box-shadow: inset 0 0 10px rgba(232, 184, 75, 0.1);
}

/* =========================================
   ì¹´ë“œ íˆ´íŒ ì˜¤ë²„ë ˆì´
   ========================================= */
.card-tooltip-overlay{
  display:none;position:fixed;inset:0;
  background:rgba(0,0,0,.65);
  backdrop-filter:blur(3px);
  -webkit-backdrop-filter:blur(3px);
  z-index:600;
  align-items:center;justify-content:center;
  padding:20px;
}
.card-tooltip-overlay.open{display:flex;animation:fadeInOverlay .18s ease;}

.card-tooltip-modal{
  background:var(--bg1);
  border:1px solid var(--border2);
  border-radius:14px;
  width:360px;max-width:100%;
  max-height:85vh;overflow-y:auto;
  animation:slideUp .2s cubic-bezier(.16,1,.3,1);
}
.card-tooltip-modal::-webkit-scrollbar{width:3px;}
.card-tooltip-modal::-webkit-scrollbar-thumb{background:var(--border);}

/* íˆ´íŒ í—¤ë” */
.ctt-header{
  padding:20px 20px 16px;
  display:flex;align-items:center;gap:16px;
  border-bottom:1px solid var(--border);
  position:relative;
}
.ctt-big-icon{
  width:60px;height:60px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  font-size:32px;flex-shrink:0;border:2px solid;
}
.ctt-title-block{flex:1;}
.ctt-name{font-size:16px;font-weight:700;color:var(--text1);margin-bottom:3px;}
.ctt-sub{font-family:'Rajdhani',sans-serif;font-size:10px;letter-spacing:1.5px;margin-bottom:6px;}
.ctt-close-hint{
  position:absolute;top:12px;right:14px;
  font-family:'Rajdhani',sans-serif;font-size:9px;color:var(--text3);
  letter-spacing:1px;
}

/* íˆ´íŒ ë°”ë”” */
.ctt-body{padding:14px 20px;}
.ctt-section-label{
  font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;
  letter-spacing:2px;color:var(--text3);text-transform:uppercase;
  margin-bottom:8px;margin-top:14px;
}
.ctt-section-label:first-child{margin-top:0;}
.ctt-stat-row{
  display:flex;justify-content:space-between;align-items:center;
  padding:5px 8px;border-radius:5px;
  background:rgba(255,255,255,.02);border:1px solid var(--border);
  margin-bottom:4px;
}
.ctt-stat-name{font-family:'Rajdhani',sans-serif;font-size:10px;color:var(--text2);}
.ctt-stat-val{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;color:var(--gold2);}

/* ì—…ê·¸ë ˆì´ë“œ ë‹¨ê³„ í…Œì´ë¸” */
.ctt-upgrade-table{width:100%;border-collapse:collapse;font-family:'Rajdhani',sans-serif;font-size:10px;}
.ctt-upgrade-table th{color:var(--text3);font-weight:700;letter-spacing:1px;padding:4px 8px;border-bottom:1px solid var(--border);text-align:center;}
.ctt-upgrade-table td{padding:4px 8px;text-align:center;border-bottom:1px solid rgba(30,42,61,.4);}
.ctt-upgrade-table tr:last-child td{border-bottom:none;}
.ctt-upgrade-table tr.active-step td{background:rgba(232,184,75,.06);color:var(--gold2);font-weight:700;}
.ctt-upgrade-table td:first-child{color:var(--text3);}

/* ì„¸íŠ¸ íš¨ê³¼ ì¹© */
.ctt-set-effects{display:flex;flex-direction:column;gap:5px;}
.ctt-set-row{padding:7px 10px;border-radius:6px;border:1px solid var(--border);}
.ctt-set-type{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;margin-bottom:3px;}
.ctt-set-desc{font-size:10px;color:var(--text2);line-height:1.5;}

/* íˆ´íŒ í‘¸í„° (ì•¡ì…˜ ë²„íŠ¼) */
.ctt-footer{
  padding:14px 20px;
  border-top:1px solid var(--border);
  display:flex;gap:8px;
}
.btn-export{padding:4px 10px;background:rgba(52,211,153,.1);border:1px solid rgba(52,211,153,.25);color:var(--green);border-radius:4px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;transition:all .2s;letter-spacing:.5px;}
.btn-export:hover{background:rgba(52,211,153,.25);border-color:var(--green);}
.btn-import{padding:4px 10px;background:rgba(56,189,248,.1);border:1px solid rgba(56,189,248,.25);color:var(--t3);border-radius:4px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;transition:all .2s;letter-spacing:.5px;}
.btn-import:hover{background:rgba(56,189,248,.25);border-color:var(--t3);}

/* ì¹´ë“œ ì•„ì´í…œ */
.card-item{background:var(--bg2);border:1px solid var(--border);border-radius:7px;padding:12px 14px;display:flex;align-items:flex-start;gap:12px;cursor:pointer;transition:all .2s;position:relative;user-select:none;min-height: auto !important;height: auto !important;}
.card-item::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;}
.card-item[data-tier="1"]::before{background:var(--t1);}
.card-item[data-tier="2"]::before{background:var(--t2);}
.card-item[data-tier="3"]::before{background:var(--t3);}
.card-item[data-tier="4"]::before{background:var(--t4);}
.card-item[data-tier="5"]::before{background:var(--t5);}
.card-item[data-tier="6"]::before{background:var(--t6);}
.card-item[data-tier="7"]::before{background:var(--t7);box-shadow:0 0 8px var(--t7g);}
.card-item:hover{background:var(--bg3);border-color:var(--border2);transform:translateX(2px);}
.card-item.dragging{opacity:.35;transform:scale(.97);}
.card-item.equipped{border-color:var(--green);background:rgba(52,211,153,.04);}

.card-icon{width:46px;height:46px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0;background:rgba(255,255,255,.03);border:1px solid var(--border);}
.card-info{flex:1;min-width:0;}
.card-tier-badge{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;padding:1px 5px;border-radius:3px;display:inline-block;margin-bottom:2px;}
.tb1{background:rgba(156,163,175,.15);color:var(--t1);border:1px solid rgba(156,163,175,.2);}
.tb2{background:rgba(74,222,128,.12);color:var(--t2);border:1px solid rgba(74,222,128,.2);}
.tb3{background:rgba(56,189,248,.12);color:var(--t3);border:1px solid rgba(56,189,248,.2);}
.tb4{background:rgba(167,139,250,.12);color:var(--t4);border:1px solid rgba(167,139,250,.2);}
.tb5{background:rgba(249,115,22,.12);color:var(--t5);border:1px solid rgba(249,115,22,.2);}
.tb6{background:rgba(244,63,94,.12);color:var(--t6);border:1px solid rgba(244,63,94,.2);}
.tb7{background:rgba(251,191,36,.15);color:var(--t7);border:1px solid rgba(251,191,36,.3);}
.card-name{font-size:12px;font-weight:700;color:var(--text1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.card-stats-row{font-size:9px;display:flex;flex-wrap:wrap;gap:4px;margin-top:3px;}
.stat-chip{padding:1px 5px;background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:3px;font-size:9px;}
.stat-chip.hp{color:#f87171;}.stat-chip.atk{color:#fb923c;}.stat-chip.def{color:#60a5fa;}
.stat-chip.spd{color:#4ade80;}.stat-chip.crit{color:#ff8a65;}.stat-chip.crit_dmg{color:#fbbf24;}

/* ê°•í™” ë°°ì§€ */
.enh-badge{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;padding:1px 6px;border-radius:3px;background:rgba(255,255,255,.05);border:1px solid var(--border);color:var(--text3);white-space:nowrap;flex-shrink:0;}
.enh-badge.lv1{color:var(--e1);border-color:rgba(74,222,128,.3);background:rgba(74,222,128,.08);}
.enh-badge.lv2{color:var(--e2);border-color:rgba(56,189,248,.3);background:rgba(56,189,248,.08);}
.enh-badge.lv3{color:var(--e3);border-color:rgba(167,139,250,.3);background:rgba(167,139,250,.08);}
.enh-badge.lv4{color:var(--e4);border-color:rgba(249,115,22,.3);background:rgba(249,115,22,.08);}
.enh-badge.lv5{color:var(--e5);border-color:rgba(244,63,94,.3);background:rgba(244,63,94,.08);animation:glow5 2s ease-in-out infinite;}
@keyframes glow5{0%,100%{box-shadow:0 0 4px rgba(244,63,94,.2);}50%{box-shadow:0 0 10px rgba(244,63,94,.5);}}

/* ì¹´ë“œ ëª©ë¡ ìŠ¤í¬ë¡¤ */
.card-list{display:flex;flex-direction:column;gap:5px;max-height:calc(100vh - 350px) !important;overflow-y:auto;padding-right:6px;}
.card-list::-webkit-scrollbar{width:3px;}
.card-list::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}

/* ìŠ¬ë¡¯ */
.slots-grid{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:16px;}
.slot{width:122px;min-height:155px;background:var(--bg2);border:2px dashed var(--border);border-radius:10px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .25s;position:relative;overflow:hidden;}
.slot.drag-over{border-color:var(--gold);background:rgba(232,184,75,.05);box-shadow:0 0 16px rgba(232,184,75,.1) inset;}
.slot.filled{border-style:solid;cursor:pointer;}
.slot.filled:hover{filter:brightness(1.1);}
.slot.filled[data-tier="1"]{border-color:var(--t1);}
.slot.filled[data-tier="2"]{border-color:var(--t2);}
.slot.filled[data-tier="3"]{border-color:var(--t3);}
.slot.filled[data-tier="4"]{border-color:var(--t4);}
.slot.filled[data-tier="5"]{border-color:var(--t5);}
.slot.filled[data-tier="6"]{border-color:var(--t6);}
.slot.filled[data-tier="7"]{border-color:var(--t7);box-shadow:0 0 10px var(--t7g) inset;}
.slot-num{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;color:var(--text3);letter-spacing:2px;position:absolute;top:7px;left:9px;}
.slot-empty-ico{font-size:26px;opacity:.1;margin-bottom:6px;}
.slot-empty-txt{font-family:'Rajdhani',sans-serif;font-size:9px;color:var(--text3);letter-spacing:1px;text-align:center;padding:0 8px;}
.slot-ico{font-size:32px;margin-bottom:6px;}
.slot-name{font-size:10px;font-weight:700;color:var(--text1);text-align:center;padding:0 6px;line-height:1.3;}
.slot-tier{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;margin:2px 0 4px;}
.slot-stats{font-size:8px;color:var(--text2);text-align:center;line-height:1.6;}
.slot-enh{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:.5px;margin-bottom:3px;}
.slot-remove{position:absolute;top:5px;right:5px;width:17px;height:17px;background:rgba(248,113,113,.15);border:1px solid rgba(248,113,113,.25);color:var(--red);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:9px;transition:all .2s;opacity:0;z-index:2;}
.slot.filled:hover .slot-remove{opacity:1;}
.slot-remove:hover{background:rgba(248,113,113,.4);}
/* ìŠ¬ë¡¯ ê°•í™” ë²„íŠ¼ì€ .slot-enh-btn ìœ¼ë¡œ ëŒ€ì²´ */

/* íš¨ê³¼ í•©ì‚° */
.set-area{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:14px;}
.set-area-title{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:2px;color:var(--text3);text-transform:uppercase;margin-bottom:10px;}
.eff-row{display:flex;align-items:flex-start;gap:8px;padding:8px 10px;border-radius:5px;margin-bottom:5px;border:1px solid transparent;}
.eff-row.ind{background:rgba(255,255,255,.015);border-color:var(--border);}
.eff-row.sp{background:rgba(61,184,122,.05);border-color:rgba(61,184,122,.15);}
.eff-row.st{background:rgba(34,211,238,.05);border-color:rgba(34,211,238,.15);}
.eff-row.tr{background:rgba(232,184,75,.05);border-color:rgba(232,184,75,.15);}
.eff-row.fh{background:rgba(167,139,250,.05);border-color:rgba(167,139,250,.15);}
.eff-row.str{background:rgba(248,113,113,.07);border-color:rgba(248,113,113,.2);}
.eff-badge{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;padding:1px 6px;border-radius:3px;flex-shrink:0;white-space:nowrap;margin-top:1px;}
.eff-label{font-size:11px;font-weight:700;color:var(--text1);margin-bottom:2px;}
.eff-desc{font-size:10px;color:var(--text2);line-height:1.5;}
.eff-stats{font-size:10px;display:flex;flex-wrap:wrap;gap:5px;margin-top:3px;}
.eff-stat-chip{padding:1px 6px;border-radius:3px;font-weight:700;font-size:9px;background:rgba(52,211,153,.12);color:var(--green);border:1px solid rgba(52,211,153,.18);}
.total-stats{background:var(--bg);border:1px solid var(--border);border-radius:7px;padding:12px 14px;margin-top:10px;}
.total-stats-title{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:2px;color:var(--gold);text-transform:uppercase;margin-bottom:8px;}
.total-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;}
.total-item{background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:5px;padding:7px 8px;text-align:center;}
.total-name{font-family:'Rajdhani',sans-serif;font-size:8px;color:var(--text3);letter-spacing:1px;text-transform:uppercase;margin-bottom:2px;}
.total-val{font-family:'Rajdhani',sans-serif;font-size:17px;font-weight:700;line-height:1;}
.total-val.hp{color:#f87171;}.total-val.atk{color:#fb923c;}.total-val.def{color:#60a5fa;}
.total-val.spd{color:#4ade80;}.total-val.crit{color:#ff8a65;}.total-val.crit_dmg{color:#fbbf24;}

/* ë¹ˆ ìƒíƒœ */
.empty{text-align:center;padding:32px 16px;color:var(--text3);font-size:11px;letter-spacing:1px;}
.empty-ico{font-size:30px;opacity:.25;margin-bottom:8px;}

/* êµ¬ë¶„ì„  */
.divider{display:flex;align-items:center;gap:10px;margin:14px 0;}
.divider-line{flex:1;height:1px;background:var(--border);}
.divider-txt{font-family:'Rajdhani',sans-serif;font-size:9px;color:var(--text3);letter-spacing:2px;text-transform:uppercase;}

/* ì•„ì´ì½˜ ì„ íƒ */
.icon-grid{display:flex;flex-wrap:wrap;gap:5px;}
.icon-btn{width:34px;height:34px;display:flex;align-items:center;justify-content:center;font-size:18px;border-radius:5px;cursor:pointer;transition:all .15s;background:rgba(255,255,255,.02);border:1px solid var(--border);}
.icon-btn.active{background:rgba(60,80,150,.3);border-color:var(--border3);}
.icon-btn:hover{background:rgba(60,80,150,.2);}

/* í•„í„° */
.filter-bar{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:12px;}
.filter-chip{padding:3px 10px;background:var(--bg);border:1px solid var(--border);color:var(--text3);border-radius:20px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;transition:all .2s;}
.filter-chip:hover{color:var(--text1);}
.filter-chip.active{background:rgba(60,80,150,.2);border-color:var(--border3);color:var(--silver);}

/* ì„¸íŠ¸ ëª©ë¡ */
.set-card-item{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:12px 14px;margin-bottom:8px;cursor:pointer;transition:all .2s;position:relative;}
.set-card-item:hover{border-color:var(--border2);transform:translateX(2px);}
.set-card-item.type-pair{border-left:3px solid var(--pair-c);}
.set-card-item.type-twopair{border-left:3px solid var(--twopair-c);}
.set-card-item.type-triple{border-left:3px solid var(--triple-c);}
.set-card-item.type-fullhouse{border-left:3px solid var(--fullhouse-c);}
.set-card-item.type-straight{border-left:3px solid var(--straight-c);}
.set-card-item.type-none{border-left:3px solid var(--text3);}
.set-hd{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.set-rank{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;color:var(--text3);}
.set-score{margin-left:auto;font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;color:var(--gold);background:rgba(232,184,75,.08);border:1px solid rgba(232,184,75,.18);padding:1px 8px;border-radius:4px;}
.set-chips{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:7px;}
.set-chip{display:flex;align-items:center;gap:3px;padding:2px 7px;background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:3px;font-size:9px;color:var(--text2);}
.set-eff-chips{display:flex;gap:5px;flex-wrap:wrap;}
.set-eff-chip{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;padding:2px 7px;border-radius:3px;}
.set-apply{position:absolute;right:10px;bottom:10px;padding:4px 12px;background:rgba(60,80,150,.2);border:1px solid var(--border2);color:var(--silver);border-radius:4px;cursor:pointer;font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;transition:all .2s;}
.set-apply:hover{background:rgba(60,80,150,.4);color:var(--text1);}

/* =========================================
   ê°•í™” config íƒ­
   ========================================= */
.config-section-title{font-family:'Rajdhani',sans-serif;font-size:10px;font-weight:700;letter-spacing:2px;color:var(--text3);text-transform:uppercase;margin-bottom:12px;}
.config-table{width:100%;border-collapse:collapse;}
.config-table th{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;color:var(--text3);letter-spacing:1px;text-align:center;padding:6px 10px;border-bottom:1px solid var(--border);text-transform:uppercase;}
.config-table td{padding:7px 10px;text-align:center;border-bottom:1px solid rgba(30,42,61,.5);}
.config-table tr:last-child td{border-bottom:none;}
.config-table tr:hover td{background:rgba(255,255,255,.015);}
.config-lv-label{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;}
.config-input{width:64px;padding:5px 8px;background:var(--bg);border:1px solid var(--border);border-radius:4px;color:var(--text1);font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;text-align:center;outline:none;transition:all .2s;}
.config-input:focus{border-color:var(--border3);box-shadow:0 0 0 2px rgba(74,110,200,.1);}
.prob-bar-wrap{width:80px;height:6px;background:var(--bg);border-radius:3px;overflow:hidden;display:inline-block;vertical-align:middle;margin-left:6px;}
.prob-bar{height:100%;border-radius:3px;transition:width .3s;}
.config-note{font-size:10px;color:var(--text3);line-height:1.7;font-family:'Rajdhani',sans-serif;padding:12px 14px;background:rgba(255,255,255,.02);border-radius:6px;border:1px solid var(--border);margin-top:16px;}

/* =========================================
   ê°•í™” ì˜¤ë²„ë ˆì´
   ========================================= */
.enh-overlay{
  display:none;
  position:fixed;inset:0;
  background:rgba(0,0,0,.75);
  backdrop-filter:blur(4px);
  -webkit-backdrop-filter:blur(4px);
  z-index:700;
  align-items:center;justify-content:center;
  padding:20px;
}
.enh-overlay.open{display:flex;animation:fadeInOverlay .2s ease;}
@keyframes fadeInOverlay{from{opacity:0;}to{opacity:1;}}

.enh-modal{
  background:var(--bg1);
  border:1px solid var(--border2);
  border-radius:16px;
  width:480px;
  max-width:100%;
  max-height:90vh;
  overflow-y:auto;
  position:relative;
  animation:slideUp .25s cubic-bezier(.16,1,.3,1);
}
.enh-modal::-webkit-scrollbar{width:3px;}
.enh-modal::-webkit-scrollbar-thumb{background:var(--border);}
@keyframes slideUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}

/* ëª¨ë‹¬ ìƒë‹¨ ì¹´ë“œ í—¤ë” */
.enh-card-header{
  padding:24px 24px 20px;
  display:flex;
  align-items:center;
  gap:18px;
  position:relative;
}
.enh-card-header::after{content:'';position:absolute;bottom:0;left:24px;right:24px;height:1px;background:var(--border);}

.enh-card-big-icon{
  width:64px;height:64px;
  border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  font-size:34px;flex-shrink:0;
  border:2px solid;
  position:relative;
}
.enh-card-header-info{flex:1;}
.enh-card-header-name{font-size:17px;font-weight:700;color:var(--text1);margin-bottom:3px;}
.enh-card-header-sub{font-family:'Rajdhani',sans-serif;font-size:11px;letter-spacing:1px;margin-bottom:8px;}

/* ë ˆë²¨ íŒŒì´í”„ */
.lv-bar{display:flex;gap:5px;align-items:center;}
.lv-pip{width:32px;height:7px;border-radius:4px;background:var(--bg);border:1px solid var(--border);transition:all .3s;}
.lv-pip.filled{border-color:transparent;}
.lv-pip.p1{background:var(--e1);}
.lv-pip.p2{background:var(--e2);}
.lv-pip.p3{background:var(--e3);}
.lv-pip.p4{background:var(--e4);}
.lv-pip.p5{background:var(--e5);animation:pipGlow5 1.5s ease-in-out infinite;}
@keyframes pipGlow5{0%,100%{box-shadow:0 0 4px rgba(244,63,94,.3);}50%{box-shadow:0 0 10px rgba(244,63,94,.7);}}
.lv-label{font-family:'Rajdhani',sans-serif;font-size:11px;font-weight:700;color:var(--text3);letter-spacing:1px;}

.enh-modal-close{
  position:absolute;top:14px;right:16px;
  width:26px;height:26px;
  background:rgba(255,255,255,.05);border:1px solid var(--border);
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;font-size:12px;color:var(--text3);transition:all .2s;
  line-height:1;
}
.enh-modal-close:hover{color:var(--text1);background:rgba(255,255,255,.1);}

/* í™•ë¥  ì„¹ì…˜ */
.enh-section{padding:16px 24px;border-bottom:1px solid var(--border);}
.enh-section-label{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:2px;color:var(--text3);text-transform:uppercase;margin-bottom:10px;}

.prob-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.prob-card{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:10px;text-align:center;}
.prob-card-label{font-family:'Rajdhani',sans-serif;font-size:9px;letter-spacing:1px;color:var(--text3);margin-bottom:4px;}
.prob-card-val{font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;line-height:1;}
.prob-card-val.succ{color:var(--green);}
.prob-card-val.fail{color:var(--red);}
.prob-card-val.dest{color:#ff3030;}

/* ìŠ¤íƒ¯ ë¹„êµ ì„¹ì…˜ */
.stat-compare-grid{display:grid;gap:6px;}
.stat-compare-row{
  display:grid;
  grid-template-columns:80px 1fr 24px 1fr;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:6px;
}
.stat-cmp-name{font-family:'Rajdhani',sans-serif;font-size:10px;color:var(--text3);letter-spacing:1px;}
.stat-cmp-before{font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;color:var(--text2);text-align:right;}
.stat-cmp-arrow{font-size:10px;color:var(--text3);text-align:center;}
.stat-cmp-after{font-family:'Rajdhani',sans-serif;font-size:13px;font-weight:700;text-align:left;}
.stat-cmp-after.up{color:var(--green);}
.stat-cmp-diff{font-family:'Rajdhani',sans-serif;font-size:9px;color:var(--green);margin-left:3px;}

/* ê°•í™” ë²„íŠ¼ ì„¹ì…˜ */
.enh-action{padding:20px 24px 24px;display:flex;flex-direction:column;gap:10px;}

.btn-enhance{
  width:100%;padding:14px;
  background:linear-gradient(135deg,#1a0a00,#3a1800);
  border:1px solid rgba(249,115,22,.45);
  color:#fb923c;
  font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:700;
  letter-spacing:2px;border-radius:8px;cursor:pointer;
  text-transform:uppercase;transition:all .25s;
  position:relative;overflow:hidden;
}
.btn-enhance::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(249,115,22,.08),transparent);transition:left .4s;}
.btn-enhance:hover:not(:disabled)::before{left:100%;}
.btn-enhance:hover:not(:disabled){box-shadow:0 0 24px rgba(249,115,22,.25);border-color:rgba(249,115,22,.8);transform:translateY(-1px);}
.btn-enhance:disabled{opacity:.3;cursor:not-allowed;transform:none;}
.btn-enhance.max{background:linear-gradient(135deg,#1a1000,#3a2800);border-color:rgba(251,191,36,.4);color:var(--t7);cursor:not-allowed;}

.enh-action-note{font-family:'Rajdhani',sans-serif;font-size:10px;color:var(--text3);text-align:center;line-height:1.6;letter-spacing:.5px;}

/* =========================================
   ê°•í™” ê²°ê³¼ íŒì—…
   ========================================= */
.result-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:800;align-items:center;justify-content:center;}
.result-overlay.show{display:flex;}
.result-box{background:var(--bg1);border:1px solid var(--border2);border-radius:16px;width:340px;max-width:95vw;text-align:center;padding:36px 28px 28px;position:relative;overflow:hidden;}
.result-box.suc{border-color:rgba(52,211,153,.4);}
.result-box.fail{border-color:rgba(248,113,113,.3);}
.result-box.dest{border-color:rgba(248,113,113,.6);}
.result-ico{font-size:56px;margin-bottom:10px;}
.result-title{font-family:'Cinzel Decorative',serif;font-size:18px;font-weight:700;margin-bottom:8px;letter-spacing:2px;}
.result-title.s{color:var(--green);}
.result-title.f{color:var(--red);}
.result-title.d{color:#ff2020;text-shadow:0 0 20px rgba(255,32,32,.5);}
.result-desc{font-size:12px;color:var(--text2);margin-bottom:20px;line-height:1.7;}
.sparks{position:absolute;inset:0;pointer-events:none;overflow:hidden;}
.spark{position:absolute;width:5px;height:5px;border-radius:50%;animation:spk .7s ease-out forwards;}
@keyframes spk{0%{opacity:1;transform:translate(0,0) scale(1);}100%{opacity:0;transform:translate(var(--tx),var(--ty)) scale(0);}}

/* ê°•í™” ë¡œê·¸ */
.enh-log{background:var(--bg);border:1px solid var(--border);border-radius:7px;padding:10px 12px;max-height:150px;overflow-y:auto;}
.enh-log::-webkit-scrollbar{width:3px;}
.enh-log::-webkit-scrollbar-thumb{background:var(--border);}
.log-row{font-size:10px;padding:3px 0;border-bottom:1px solid rgba(30,42,61,.4);display:flex;gap:6px;align-items:center;}
.log-row:last-child{border-bottom:none;}
.log-time{color:var(--text3);font-family:'Rajdhani',sans-serif;font-size:9px;flex-shrink:0;}
.log-txt.ok{color:var(--green);}
.log-txt.fail{color:var(--text2);}
.log-txt.dest{color:var(--red);}

/* ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ (ìŠ¬ë¡¯ìš©) */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:500;align-items:center;justify-content:center;}
.modal-overlay.open{display:flex;}
.modal-inner{background:var(--bg1);border:1px solid var(--border2);border-radius:12px;width:480px;max-width:95vw;max-height:80vh;display:flex;flex-direction:column;overflow:hidden;}
.modal-hd{padding:13px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.modal-title{font-family:'Rajdhani',sans-serif;font-size:14px;font-weight:700;letter-spacing:1px;color:var(--gold);}
.modal-close-btn{background:none;border:none;color:var(--text3);cursor:pointer;font-size:18px;padding:0 4px;transition:color .2s;}
.modal-close-btn:hover{color:var(--text1);}
.modal-body{flex:1;overflow-y:auto;padding:14px;}
.modal-body .card-list{max-height:none;}

/* =========================================
   ì„¸íŠ¸ ì •ì˜ UI
   ========================================= */
.set-def-card{background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:12px 14px;margin-bottom:8px;position:relative;}
.set-def-card.grade-pair{border-left:3px solid var(--pair-c);}
.set-def-card.grade-triple{border-left:3px solid var(--triple-c);}
.set-def-card.grade-straight{border-left:3px solid var(--straight-c);}
.set-def-name{font-size:13px;font-weight:700;color:var(--text1);margin-bottom:4px;}
.set-def-grade{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;padding:1px 6px;border-radius:3px;display:inline-block;margin-bottom:6px;}
.set-def-members{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:6px;}
.set-def-chip{font-family:'Rajdhani',sans-serif;font-size:10px;padding:2px 7px;background:rgba(255,255,255,.04);border:1px solid var(--border2);border-radius:4px;color:var(--text2);}
.set-def-desc{font-size:10px;color:var(--text2);line-height:1.5;margin-bottom:6px;}
.set-def-effect{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px;}
.set-def-efx-chip{font-size:9px;padding:1px 6px;background:rgba(52,211,153,.08);border:1px solid rgba(52,211,153,.2);border-radius:3px;color:var(--green);font-family:'Rajdhani',sans-serif;font-weight:700;}
.set-def-actions{display:flex;gap:6px;}
.set-def-active{border-color:var(--gold);background:rgba(232,184,75,.04);}
.set-def-active-badge{font-family:'Rajdhani',sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;color:var(--gold);padding:1px 6px;background:rgba(232,184,75,.12);border:1px solid rgba(232,184,75,.3);border-radius:3px;position:absolute;top:10px;right:10px;}

/* ì¹´ë“œ ì„ íƒ í”¼ì»¤ */
.card-picker-chip{font-family:'Rajdhani',sans-serif;font-size:10px;padding:4px 8px;background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:5px;cursor:pointer;transition:all .15s;color:var(--text2);}
.card-picker-chip:hover{border-color:var(--border2);color:var(--text1);}
.card-picker-chip.selected{background:rgba(96,165,250,.12);border-color:var(--blue);color:var(--blue);}
.card-picker-chip.disabled{opacity:.3;cursor:not-allowed;}

/* í¼ ë³´ë„ˆìŠ¤ ìŠ¤íƒ¯ í–‰ */
.sf-stat-row{display:flex;align-items:center;justify-content:space-between;padding:4px 8px;background:var(--bg);border:1px solid var(--border);border-radius:5px;font-size:10px;}
.sf-stat-row-name{color:var(--text2);font-family:'Rajdhani',sans-serif;}
.sf-stat-row-val{color:var(--gold2);font-family:'Rajdhani',sans-serif;font-weight:700;}

/* ë°œë™ ì¤‘ì¸ ì„¸íŠ¸ íš¨ê³¼ í–‰ */
.active-set-row{padding:10px 12px;border-radius:7px;border:1px solid var(--border);margin-bottom:6px;background:rgba(255,255,255,.02);}
.active-set-row.grade-pair{border-left:3px solid var(--pair-c);}
.active-set-row.grade-triple{border-left:3px solid var(--triple-c);}
.active-set-row.grade-straight{border-left:3px solid var(--straight-c);}
.active-set-name{font-size:12px;font-weight:700;color:var(--text1);margin-bottom:3px;}
.active-set-desc{font-size:10px;color:var(--text2);line-height:1.5;}
.active-set-bonus{display:flex;flex-wrap:wrap;gap:4px;margin-top:5px;}

/* ë°œë™ ì˜ˆì • ì„¸íŠ¸ ìŠ¤íƒ€ì¼ */
.potential-set-row {
  padding: 8px 10px;
  border-radius: 6px;
  border: 1px dashed var(--border2);
  margin-bottom: 6px;
  background: rgba(255, 255, 255, 0.02);
}
.potential-badge {
  font-family: 'Rajdhani', sans-serif;
  font-size: 8px;
  font-weight: 700;
  padding: 1px 5px;
  background: var(--bg3);
  color: var(--text3);
  border: 1px solid var(--border);
  border-radius: 3px;
  white-space: nowrap;
}
.needed-card {
  color: var(--gold);
  font-weight: bold;
  text-decoration: underline;
  text-underline-offset: 2px;
}

/* grade radio */
/* ì„¸íŠ¸ ë“±ê¸‰ ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
.grade-radio-label {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  padding: 8px 5px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 5px;
  cursor: pointer;
  font-size: 11px;
  font-family: 'Rajdhani', sans-serif;
  font-weight: 700;
  transition: all 0.2s;
  color: var(--text3); /* ê¸°ë³¸ ìƒíƒœëŠ” íë¦¿í•˜ê²Œ */
}

.grade-radio-label:hover {
  border-color: var(--border2);
  background: var(--bg2);
}

/* ë¼ë””ì˜¤ ë²„íŠ¼ì´ ì²´í¬ë˜ì—ˆì„ ë•Œ ë¶€ëª¨ label ê°•ì¡° (í•µì‹¬) */
.grade-radio-label:has(input:checked) {
  background: rgba(232, 184, 75, 0.15) !important; /* ì€ì€í•œ ê³¨ë“œ ë°°ê²½ */
  border: 1px solid var(--gold) !important;         /* ê³¨ë“œ í…Œë‘ë¦¬ */
  box-shadow: inset 0 0 8px rgba(232, 184, 75, 0.1);
}

/* ì²´í¬ëœ ë²„íŠ¼ ë‚´ë¶€ì˜ ê¸€ììƒ‰ ìœ ì§€ */
.grade-radio-label:has(input[value="pair"]:checked) span { color: var(--pair-c) !important; }
.grade-radio-label:has(input[value="triple"]:checked) span { color: var(--triple-c) !important; }
.grade-radio-label:has(input[value="straight"]:checked) span { color: var(--straight-c) !important; }

/* ì‹¤ì œ ë¼ë””ì˜¤ inputì€ ìˆ¨ê¹€ */
.grade-radio-label input {
  display: none;
}
#toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(16px);background:var(--bg1);border:1px solid var(--border);color:var(--text1);padding:9px 18px;border-radius:6px;font-size:11px;letter-spacing:.5px;opacity:0;transition:all .3s;z-index:1000;pointer-events:none;font-family:'Rajdhani',sans-serif;font-weight:700;}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
#toast.ok{border-color:var(--green);color:var(--green);}
#toast.err{border-color:var(--red);color:var(--red);}

@keyframes fadeIn{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);}}
.ani{animation:fadeIn .2s ease forwards;}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="header-title">MONSTER CARD SYSTEM</div>
    <div class="header-sub">Prototype v3.0 Â· Game Design Tool</div>
  </header>

  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab(&#39;equip&#39;)">âš”ï¸ ì¹´ë“œ ì¥ì°©</button>
    <button class="tab-btn" onclick="switchTab(&#39;create&#39;)">âœ¨ ì¹´ë“œ ìƒì„±</button>
    <button class="tab-btn" onclick="switchTab(&#39;config&#39;)">âš™ï¸ ê°•í™” ì„¤ì •</button>
    <button class="tab-btn" onclick="switchTab(&#39;sets&#39;)">ğŸƒ ì„¸íŠ¸ ì¡°í•©</button>
  </div>

  <!-- â”€â”€ ì¥ì°© íƒ­ â”€â”€ -->
  <div id="tab-equip" class="tab-content" style="display: block;">
    <div class="main-grid">
      <div class="col">
        <div class="panel">
          <div class="panel-hd">
            <div class="panel-title">ğŸ“¦ ì¸ë²¤í† ë¦¬</div>
            <button class="btn-import" style="margin-left:8px; padding:2px 8px; font-size:9px;" onclick="openObtainModal()">â• ì¹´ë“œ íšë“</button>
            <span id="inv-count" style="font-size:10px;color:var(--text3);margin-left:auto;font-family:'Rajdhani',sans-serif;font-weight:700;">0ì¥</span>
          </div>
          <div class="panel-bd" style="padding:12px;">
            <div class="filter-bar" id="inv-filter">
              <div class="filter-chip active" onclick="filterInv(&#39;all&#39;,this)">ALL</div>
              <div class="filter-chip" onclick="filterInv(&#39;1&#39;,this)">T1</div>
              <div class="filter-chip" onclick="filterInv(&#39;2&#39;,this)">T2</div>
              <div class="filter-chip" onclick="filterInv(&#39;3&#39;,this)">T3</div>
              <div class="filter-chip" onclick="filterInv(&#39;4&#39;,this)">T4</div>
              <div class="filter-chip" onclick="filterInv(&#39;5&#39;,this)">T5</div>
              <div class="filter-chip" onclick="filterInv(&#39;6&#39;,this)">T6</div>
              <div class="filter-chip" onclick="filterInv(&#39;7&#39;,this)">T7</div>
            </div>
            <div class="card-list" id="inv-list" ondragover="e=&gt;e.preventDefault()" ondrop="onDropToList(event)"><div class="card-item equipped ani" data-tier="1" data-id="s7bcnxq" onclick="openCardTooltip(&#39;s7bcnxq&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;s7bcnxq&#39;,null)">
    <div class="card-icon">ğŸŒ¿</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ëˆ„ì´ì•ˆ</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+25 ìµœëŒ€ ì²´ë ¥</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <span style="font-size:9px;color:var(--green);font-family:&#39;Rajdhani&#39;,sans-serif;font-weight:700;letter-spacing:.5px;">âœ“ì¥ì°©</span>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;s7bcnxq&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;s7bcnxq&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="rjspw80" onclick="openCardTooltip(&#39;rjspw80&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;rjspw80&#39;,null)">
    <div class="card-icon">ğŸ‘¹</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ì˜¤í¬</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+10 ë¬¼ë¦¬ ë°©ì–´ë ¥</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <button class="btn-sm" onclick="event.stopPropagation();quickEquip(&#39;rjspw80&#39;)">ì¥ì°©</button>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;rjspw80&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;rjspw80&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="j4970y5" onclick="openCardTooltip(&#39;j4970y5&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;j4970y5&#39;,null)">
    <div class="card-icon">ğŸ¦</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë†€</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+10 ë¬¼ë¦¬ ë°©ì–´ë ¥</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <button class="btn-sm" onclick="event.stopPropagation();quickEquip(&#39;j4970y5&#39;)">ì¥ì°©</button>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;j4970y5&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;j4970y5&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="q29b9ge" onclick="openCardTooltip(&#39;q29b9ge&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;q29b9ge&#39;,null)">
    <div class="card-icon">ğŸ’€</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ìŠ¤ì¼ˆë ˆí†¤</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ì²´ë ¥ ì§€ì† íšŒë³µëŸ‰</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <button class="btn-sm" onclick="event.stopPropagation();quickEquip(&#39;q29b9ge&#39;)">ì¥ì°©</button>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;q29b9ge&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;q29b9ge&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="4o5b756" onclick="openCardTooltip(&#39;4o5b756&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;4o5b756&#39;,null)">
    <div class="card-icon">ğŸŒ‘</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">íŒ¬í…€</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ê³µê²©ë ¥</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <button class="btn-sm" onclick="event.stopPropagation();quickEquip(&#39;4o5b756&#39;)">ì¥ì°©</button>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;4o5b756&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;4o5b756&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item equipped ani" data-tier="1" data-id="c692ti5" onclick="openCardTooltip(&#39;c692ti5&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;c692ti5&#39;,null)">
    <div class="card-icon">ğŸ’§</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë¬¼ ì •ë ¹</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ë§ˆë ¥ ì§€ì† íšŒë³µëŸ‰</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <span style="font-size:9px;color:var(--green);font-family:&#39;Rajdhani&#39;,sans-serif;font-weight:700;letter-spacing:.5px;">âœ“ì¥ì°©</span>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;c692ti5&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;c692ti5&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item equipped ani" data-tier="1" data-id="tasoy2e" onclick="openCardTooltip(&#39;tasoy2e&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;tasoy2e&#39;,null)">
    <div class="card-icon">ğŸŒ¿</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë‚˜ë¬´ ì •ë ¹</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ìŠ¤í‚¬ ê°€ì†</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <span style="font-size:9px;color:var(--green);font-family:&#39;Rajdhani&#39;,sans-serif;font-weight:700;letter-spacing:.5px;">âœ“ì¥ì°©</span>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;tasoy2e&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;tasoy2e&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item equipped ani" data-tier="1" data-id="fjk8pnk" onclick="openCardTooltip(&#39;fjk8pnk&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;fjk8pnk&#39;,null)">
    <div class="card-icon">ğŸª¨</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë°”ìœ„ ì •ë ¹</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ìŠ¤í‚¬ ê°€ì†</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <span style="font-size:9px;color:var(--green);font-family:&#39;Rajdhani&#39;,sans-serif;font-weight:700;letter-spacing:.5px;">âœ“ì¥ì°©</span>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;fjk8pnk&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;fjk8pnk&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item equipped ani" data-tier="1" data-id="g10fuep" onclick="openCardTooltip(&#39;g10fuep&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;g10fuep&#39;,null)">
    <div class="card-icon">ğŸŒ±</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ì´ë¼ ì •ë ¹</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ìŠ¤í‚¬ ê°€ì†</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <span style="font-size:9px;color:var(--green);font-family:&#39;Rajdhani&#39;,sans-serif;font-weight:700;letter-spacing:.5px;">âœ“ì¥ì°©</span>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;g10fuep&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;g10fuep&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item ani" data-tier="2" data-id="ihnriil" onclick="openCardTooltip(&#39;ihnriil&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;ihnriil&#39;,null)">
    <div class="card-icon">âš”ï¸</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb2" style="flex-shrink:0;">T2</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ì˜¤í¬ ì¡±ì¥</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+0.4% ê³µê²© ì†ë„</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <button class="btn-sm" onclick="event.stopPropagation();quickEquip(&#39;ihnriil&#39;)">ì¥ì°©</button>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;ihnriil&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;ihnriil&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item ani" data-tier="2" data-id="10selhk" onclick="openCardTooltip(&#39;10selhk&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;10selhk&#39;,null)">
    <div class="card-icon">ğŸ¦…</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb2" style="flex-shrink:0;">T2</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë†€ ìš°ë‘ë¨¸ë¦¬</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+0.3% ì´ë™ ì†ë„</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <button class="btn-sm" onclick="event.stopPropagation();quickEquip(&#39;10selhk&#39;)">ì¥ì°©</button>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;10selhk&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;10selhk&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item ani" data-tier="3" data-id="8sys69j" onclick="openCardTooltip(&#39;8sys69j&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;8sys69j&#39;,null)">
    <div class="card-icon">ğŸ¦‚</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb3" style="flex-shrink:0;">T3</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ìŠ¤ì¹¼ë‹ˆí† ìŠ¤</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+0.2% PVE ëŒ€ë¯¸ì§€ ê°ì†Œ</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <button class="btn-sm" onclick="event.stopPropagation();quickEquip(&#39;8sys69j&#39;)">ì¥ì°©</button>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;8sys69j&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;8sys69j&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div><div class="card-item ani" data-tier="3" data-id="9r43tpw" onclick="openCardTooltip(&#39;9r43tpw&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;9r43tpw&#39;,null)">
    <div class="card-icon">ğŸ²</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb3" style="flex-shrink:0;">T3</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë§ì¹´ë°”ëˆ</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+0.2% PVE ëŒ€ë¯¸ì§€ ì¦ê°€</span></div>
      <div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      <button class="btn-sm" onclick="event.stopPropagation();quickEquip(&#39;9r43tpw&#39;)">ì¥ì°©</button>
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay(&#39;9r43tpw&#39;)">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard(&#39;9r43tpw&#39;)">ì‚­ì œ</button>
    </div>
    </div>
  </div></div>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="panel">
          <div class="panel-hd">
            <div class="panel-title">âš”ï¸ ì¹´ë“œ ìŠ¬ë¡¯</div>
            <span style="font-size:10px;color:var(--text3);margin-left:auto;font-family:&#39;Rajdhani&#39;,sans-serif;">ë“œë˜ê·¸ ì¥ì°© Â· í´ë¦­ìœ¼ë¡œ ê°•í™”</span>
          </div>
          <div class="panel-bd">
            <div class="slots-grid" id="slots-grid">
      <div class="slot filled" id="slot-0" data-tier="1" ondragover="onDragOverSlot(event,0)" ondrop="onDropSlot(event,0)" ondragleave="onDragLeaveSlot(0)" draggable="true" ondragstart="onDragStart(event,&#39;s7bcnxq&#39;,0)" onclick="openCardTooltip(&#39;s7bcnxq&#39;)">
        <div class="slot-num">SLOT 1</div>
        <div class="slot-remove" onclick="event.stopPropagation();unequipSlot(0)">âœ•</div>
        <div class="slot-ico">ğŸŒ¿</div>
        <div class="slot-name">ëˆ„ì´ì•ˆ</div>
        <div class="slot-tier" style="color:var(--t1)">T1 Â· ëˆ„ì´ì•ˆ</div>
        
        <div class="slot-stats">+25 ìµœëŒ€ ì²´ë ¥</div>
        <button class="slot-enh-btn" onclick="event.stopPropagation();openEnhOverlay(&#39;s7bcnxq&#39;)">ğŸ”¥ ê°•í™”</button>
      </div>
      <div class="slot filled" id="slot-1" data-tier="1" ondragover="onDragOverSlot(event,1)" ondrop="onDropSlot(event,1)" ondragleave="onDragLeaveSlot(1)" draggable="true" ondragstart="onDragStart(event,&#39;fjk8pnk&#39;,1)" onclick="openCardTooltip(&#39;fjk8pnk&#39;)">
        <div class="slot-num">SLOT 2</div>
        <div class="slot-remove" onclick="event.stopPropagation();unequipSlot(1)">âœ•</div>
        <div class="slot-ico">ğŸª¨</div>
        <div class="slot-name">ë°”ìœ„ ì •ë ¹</div>
        <div class="slot-tier" style="color:var(--t1)">T1 Â· ë°”ìœ„ ì •ë ¹</div>
        
        <div class="slot-stats">+3 ìŠ¤í‚¬ ê°€ì†</div>
        <button class="slot-enh-btn" onclick="event.stopPropagation();openEnhOverlay(&#39;fjk8pnk&#39;)">ğŸ”¥ ê°•í™”</button>
      </div>
      <div class="slot filled" id="slot-2" data-tier="1" ondragover="onDragOverSlot(event,2)" ondrop="onDropSlot(event,2)" ondragleave="onDragLeaveSlot(2)" draggable="true" ondragstart="onDragStart(event,&#39;c692ti5&#39;,2)" onclick="openCardTooltip(&#39;c692ti5&#39;)">
        <div class="slot-num">SLOT 3</div>
        <div class="slot-remove" onclick="event.stopPropagation();unequipSlot(2)">âœ•</div>
        <div class="slot-ico">ğŸ’§</div>
        <div class="slot-name">ë¬¼ ì •ë ¹</div>
        <div class="slot-tier" style="color:var(--t1)">T1 Â· ë¬¼ ì •ë ¹</div>
        
        <div class="slot-stats">+3 ë§ˆë ¥ ì§€ì† íšŒë³µëŸ‰</div>
        <button class="slot-enh-btn" onclick="event.stopPropagation();openEnhOverlay(&#39;c692ti5&#39;)">ğŸ”¥ ê°•í™”</button>
      </div>
      <div class="slot filled" id="slot-3" data-tier="1" ondragover="onDragOverSlot(event,3)" ondrop="onDropSlot(event,3)" ondragleave="onDragLeaveSlot(3)" draggable="true" ondragstart="onDragStart(event,&#39;tasoy2e&#39;,3)" onclick="openCardTooltip(&#39;tasoy2e&#39;)">
        <div class="slot-num">SLOT 4</div>
        <div class="slot-remove" onclick="event.stopPropagation();unequipSlot(3)">âœ•</div>
        <div class="slot-ico">ğŸŒ¿</div>
        <div class="slot-name">ë‚˜ë¬´ ì •ë ¹</div>
        <div class="slot-tier" style="color:var(--t1)">T1 Â· ë‚˜ë¬´ ì •ë ¹</div>
        
        <div class="slot-stats">+3 ìŠ¤í‚¬ ê°€ì†</div>
        <button class="slot-enh-btn" onclick="event.stopPropagation();openEnhOverlay(&#39;tasoy2e&#39;)">ğŸ”¥ ê°•í™”</button>
      </div>
      <div class="slot filled" id="slot-4" data-tier="1" ondragover="onDragOverSlot(event,4)" ondrop="onDropSlot(event,4)" ondragleave="onDragLeaveSlot(4)" draggable="true" ondragstart="onDragStart(event,&#39;g10fuep&#39;,4)" onclick="openCardTooltip(&#39;g10fuep&#39;)">
        <div class="slot-num">SLOT 5</div>
        <div class="slot-remove" onclick="event.stopPropagation();unequipSlot(4)">âœ•</div>
        <div class="slot-ico">ğŸŒ±</div>
        <div class="slot-name">ì´ë¼ ì •ë ¹</div>
        <div class="slot-tier" style="color:var(--t1)">T1 Â· ì´ë¼ ì •ë ¹</div>
        
        <div class="slot-stats">+3 ìŠ¤í‚¬ ê°€ì†</div>
        <button class="slot-enh-btn" onclick="event.stopPropagation();openEnhOverlay(&#39;g10fuep&#39;)">ğŸ”¥ ê°•í™”</button>
      </div></div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-hd"><div class="panel-title">âœ¨ íš¨ê³¼ í•©ì‚°</div></div>
          <div class="panel-bd"><div id="effect-summary"><div class="set-area"><div class="set-area-title">ì ìš© ì¤‘ì¸ íš¨ê³¼</div><div class="eff-row ind">
    <span class="eff-badge" style="background:rgba(255,255,255,.06);color:var(--text3);">ê°œë³„</span>
    <div>
      <div class="eff-label">ê°œë³„ ìŠ¤íƒ¯ í•©ì‚°</div>
      <div class="eff-stats"><span class="eff-stat-chip">+25 ìµœëŒ€ ì²´ë ¥</span><span class="eff-stat-chip">+9 ìŠ¤í‚¬ ê°€ì†</span><span class="eff-stat-chip">+3 ë§ˆë ¥ ì§€ì† íšŒë³µëŸ‰</span></div>
    </div>
  </div><div class="active-set-row grade-straight">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px;">
          <span class="set-def-grade" style="background:var(--straight-c)20;color:var(--straight-c);font-family:&#39;Rajdhani&#39;,sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;padding:1px 6px;border-radius:3px;">âš¡ ìŠ¤íŠ¸ë ˆì´íŠ¸</span>
          <span class="active-set-name">ì¸ê°„ê³¼ ì •ë ¹</span>
        </div>
        <div class="active-set-desc">ëŒ€ì§€ì˜ ì •ë ¹ë“¤ê³¼ ì¸ê°„ì´ í•˜ë‚˜ê°€ ë˜ì–´ ìì—°ì˜ ëª¨ë“  í˜ì„ ì´ëŒì–´ë‚¸ë‹¤.</div>
        <div class="active-set-bonus"><span class="eff-stat-chip" style="background:rgba(232,184,75,.08);border-color:rgba(232,184,75,.2);color:var(--gold2);">+200 ìµœëŒ€ ì²´ë ¥</span><span class="eff-stat-chip" style="background:rgba(232,184,75,.08);border-color:rgba(232,184,75,.2);color:var(--gold2);">+5 ì²´ë ¥ ì§€ì† íšŒë³µëŸ‰</span><span class="eff-stat-chip" style="background:rgba(232,184,75,.08);border-color:rgba(232,184,75,.2);color:var(--gold2);">+10 ìŠ¤í‚¬ ê°€ì†</span></div>
      </div><div class="active-set-row grade-triple">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:4px;">
          <span class="set-def-grade" style="background:var(--triple-c)20;color:var(--triple-c);font-family:&#39;Rajdhani&#39;,sans-serif;font-size:9px;font-weight:700;letter-spacing:1px;padding:1px 6px;border-radius:3px;">âš¡ íŠ¸ë¦¬í”Œ</span>
          <span class="active-set-name">ë¬¼ë‚˜ë¬´ì¸ê°„</span>
        </div>
        <div class="active-set-desc">-</div>
        <div class="active-set-bonus"><span class="eff-stat-chip" style="background:rgba(232,184,75,.08);border-color:rgba(232,184,75,.2);color:var(--gold2);">+100 ìµœëŒ€ ì²´ë ¥</span></div>
      </div></div><div class="total-stats"><div class="total-stats-title">í•©ì‚° ìŠ¤íƒ¯</div>
    <div class="total-grid" style="grid-template-columns:repeat(3,1fr);"><div class="total-item">
      <div class="total-name">ìµœëŒ€ ì²´ë ¥</div>
      <div class="total-val" style="color:var(--gold2);">+325<span style="font-size:8px;color:var(--gold);margin-left:2px;">(ì„¸íŠ¸+300)</span></div>
    </div><div class="total-item">
      <div class="total-name">ìŠ¤í‚¬ ê°€ì†</div>
      <div class="total-val" style="color:var(--gold2);">+19<span style="font-size:8px;color:var(--gold);margin-left:2px;">(ì„¸íŠ¸+10)</span></div>
    </div><div class="total-item">
      <div class="total-name">ë§ˆë ¥ ì§€ì† íšŒë³µëŸ‰</div>
      <div class="total-val" style="color:var(--green);">+3</div>
    </div><div class="total-item">
      <div class="total-name">ì²´ë ¥ ì§€ì† íšŒë³µëŸ‰</div>
      <div class="total-val" style="color:var(--gold2);">+5<span style="font-size:8px;color:var(--gold);margin-left:2px;">(ì„¸íŠ¸+5)</span></div>
    </div></div></div>
  <div style="margin-top:8px;text-align:center;font-family:&#39;Rajdhani&#39;,sans-serif;font-size:12px;font-weight:700;letter-spacing:2px;color:var(--straight-c);">ğŸƒ ìŠ¤íŠ¸ë ˆì´íŠ¸</div></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ ìƒì„± íƒ­ â”€â”€ -->
  <div id="tab-create" class="tab-content" style="display:none;">
    <div class="main-grid">
      <div class="col">
        <div class="panel">
          <div class="panel-hd"><div class="panel-title">âœ¨ ì¹´ë“œ ìƒì„±</div></div>
          <div class="panel-bd">
            <div class="form-group">
            <label class="form-label">ì¹´ë“œ CID (ìë™ ìƒì„±)</label>
            <input class="form-input" id="c-cid" readonly style="background:var(--bg2); color:var(--gold); font-weight:700;" placeholder="í‹°ì–´ë¥¼ ì„ íƒí•˜ë©´ CIDê°€ ë¶€ì—¬ë©ë‹ˆë‹¤.">
          </div>
          <div class="form-group">
            <label class="form-label">ì¹´ë“œ ì´ë¦„</label>
            <input class="form-input" id="c-name" placeholder="ì˜ˆ: ë¶ˆê½ƒ ê³ ë¸”ë¦°" maxlength="20">
          </div>
          <div class="form-group"><label class="form-label">ì•„ì´ì½˜</label><div class="icon-grid" id="icon-grid"></div></div>
          <div class="form-group"><label class="form-label">í‹°ì–´</label>
            <div class="tier-selector">
              <button class="tier-btn" data-tier="1" onclick="selTier(1,this)">T1</button>
              <button class="tier-btn" data-tier="2" onclick="selTier(2,this)">T2</button>
              <button class="tier-btn" data-tier="3" onclick="selTier(3,this)">T3</button>
              <button class="tier-btn" data-tier="4" onclick="selTier(4,this)">T4</button>
              <button class="tier-btn" data-tier="5" onclick="selTier(5,this)">T5</button>
              <button class="tier-btn" data-tier="6" onclick="selTier(6,this)">T6</button>
              <button class="tier-btn" data-tier="7" onclick="selTier(7,this)">T7</button>
            </div>
          </div>
          <div class="divider"><div class="divider-line"></div><div class="divider-txt">ê°•í™” ë‹¨ê³„ë³„ ìŠ¤íƒ¯ ì„¤ì •</div><div class="divider-line"></div></div>
          <div class="step-selector" style="margin-bottom: 10px;">
            <button class="step-btn active" id="step-btn-0" onclick="switchStep(0)">+0</button>
            <button class="step-btn" id="step-btn-1" onclick="switchStep(1)">+1</button>
            <button class="step-btn" id="step-btn-2" onclick="switchStep(2)">+2</button>
            <button class="step-btn" id="step-btn-3" onclick="switchStep(3)">+3</button>
            <button class="step-btn" id="step-btn-4" onclick="switchStep(4)">+4</button>
            <button class="step-btn" id="step-btn-5" onclick="switchStep(5)">+5</button>
          </div>

          <div style="display:flex; flex-direction:column; gap:8px; margin-bottom:15px;">
            <div style="display:flex; gap:5px; align-items:center;">
              <button class="btn-sm" style="flex:2; background:rgba(232,184,75,0.1); border-color:var(--gold);" onclick="copyBaseToAll()">
                ğŸ“‹ 0ê°• ìŠ¤íƒ¯ì„ në°°ë¥¼ ëª¨ë“  ë‹¨ê³„ì— ë³µì‚¬
              </button>
              <div style="display:flex; align-items:center; gap:3px; flex:1;">
                <span style="font-size:10px; color:var(--text3);">n=</span>
                <input type="number" id="copy-all-n" class="form-input" value="1.2" step="0.1" style="padding:4px 8px; text-align:center;">
              </div>
            </div>

            <div style="display:flex; gap:5px; align-items:center;">
              <button class="btn-sm" style="flex:2;" onclick="copyPrevStep()">
                â—€ ì´ì „ ë‹¨ê³„ì˜ në°°ë¡œ ë³µì‚¬
              </button>
              <div style="display:flex; align-items:center; gap:3px; flex:1;">
                <span style="font-size:10px; color:var(--text3);">n=</span>
                <input type="number" id="copy-prev-n" class="form-input" value="1.1" step="0.1" style="padding:4px 8px; text-align:center;">
              </div>
            </div>
          </div>

          <div id="stat-entries" style="display:flex;flex-direction:column;gap:5px;margin-bottom:8px;"></div>
            <div class="divider"><div class="divider-line"></div><div class="divider-txt">ê°œë³„ íš¨ê³¼ ìŠ¤íƒ¯</div><div class="divider-line"></div></div>
            <!-- ìŠ¤íƒ¯ ë™ì  ì¶”ê°€ ì˜ì—­ -->
            <div id="stat-entries" style="display:flex;flex-direction:column;gap:5px;margin-bottom:8px;"></div>
            <div style="display:grid;grid-template-columns:1fr 90px auto;gap:6px;align-items:center;margin-bottom:13px;">
              <select class="form-input" id="stat-select" style="padding:7px 10px;">
                <option value="">-- ìŠ¤íƒ¯ ì„ íƒ --</option>
                <optgroup label="â–  ì£¼ìš” ìŠ¤íƒ¯">
                  <option value="AttackVary">ê³µê²©ë ¥</option>
                  <option value="PhysicalDefenseVary">ë¬¼ë¦¬ ë°©ì–´ë ¥</option>
                  <option value="MagicDefenseVary">ë§ˆë²• ë°©ì–´ë ¥</option>
                </optgroup>
                <optgroup label="â–  ì„¸ë¶€ ìŠ¤íƒ¯">
                  <option value="AtkSpeedVaryper">ê³µê²© ì†ë„ (%)</option>
                  <option value="MoveSpeedVaryper">ì´ë™ ì†ë„ (%)</option>
                  <option value="MaxHpVary">ìµœëŒ€ ì²´ë ¥</option>
                  <option value="MaxMpVary">ìµœëŒ€ ë§ˆë ¥</option>
                  <option value="RegenHpVary">ì²´ë ¥ ì§€ì† íšŒë³µëŸ‰</option>
                  <option value="RegenMpVary">ë§ˆë ¥ ì§€ì† íšŒë³µëŸ‰</option>
                  <option value="DamageUpVaryper">ì£¼ëŠ” í”¼í•´ ì¦ê°€ (%)</option>
                  <option value="DamageDownVaryper">ë°›ëŠ” í”¼í•´ ê°ì†Œ (%)</option>
                  <option value="PhysicalDamageUpVaryper">ë¬¼ë¦¬ í”¼í•´ ì¦ê°€ (%)</option>
                  <option value="PhysicalDamageDownVaryper">ë¬¼ë¦¬ í”¼í•´ ê°ì†Œ (%)</option>
                  <option value="MagicDamageUpVaryper">ë§ˆë²• í”¼í•´ ì¦ê°€ (%)</option>
                  <option value="MagicDamageDownVaryper">ë§ˆë²• í”¼í•´ ê°ì†Œ (%)</option>
                  <option value="PVEDamageUpVaryper">PVE ëŒ€ë¯¸ì§€ ì¦ê°€ (%)</option>
                  <option value="PVEDamageDownVaryper">PVE ëŒ€ë¯¸ì§€ ê°ì†Œ (%)</option>
                  <option value="PVPDamageUpVaryper">PVP ëŒ€ë¯¸ì§€ ì¦ê°€ (%)</option>
                  <option value="PVPDamageDownVaryper">PVP ëŒ€ë¯¸ì§€ ê°ì†Œ (%)</option>
                  <option value="DodgeVaryper">íšŒí”¼ (%)</option>
                  <option value="CriVaryper">ì¹˜ëª…íƒ€ í™•ë¥  (%)</option>
                  <option value="CriDamageVaryper">ì¹˜ëª…íƒ€ í”¼í•´ ì¦ê°€ (%)</option>
                  <option value="SkillCooldownAccVary">ìŠ¤í‚¬ ê°€ì†</option>
                  <option value="SCNegativeRecoveryVary">ìƒíƒœ ì´ìƒ íšŒë³µ</option>
                  <option value="CostMpDownVaryper">ë§ˆë‚˜ ì†Œëª¨ëŸ‰ ê°ì†Œ (%)</option>
                  <option value="MountSpeedVaryper">íƒˆ ê²ƒ ì´ë™ ì†ë„ (%)</option>
                </optgroup>
              </select>
              <input class="form-input" id="stat-val" type="number" min="0" step="0.1" placeholder="ê°’" style="padding:7px 10px;">
              <button class="btn-sm" onclick="addStatEntry()" style="padding:7px 10px;white-space:nowrap;">+ ì¶”ê°€</button>
            </div>
            <button class="btn-primary" onclick="createCard()">âœ¨ ì¹´ë“œ ìƒì„±</button>
          </div>
        </div>
      </div>
      <div class="col">
        <div class="panel">
          <div class="panel-hd">
            <div class="panel-title">ğŸ“¦ ì¹´ë“œ ëª©ë¡</div>
            <div style="margin-left:auto;display:flex;gap:6px;align-items:center;">
              <button class="btn-import" onclick="document.getElementById(&#39;csv-file-input&#39;).click()">â¬† CSV ê°€ì ¸ì˜¤ê¸°</button>
              <input type="file" id="csv-file-input" accept=".csv" style="display:none;" onchange="importCSV(event)">
              <button class="btn-export" onclick="exportCSV()">â¬‡ CSV ë‚´ë³´ë‚´ê¸°</button>
              <button class="btn-danger" onclick="clearAll()">ì „ì²´ ì‚­ì œ</button>
            </div>
          </div>
          <div class="panel-bd" style="padding:12px;">
            <div style="display:flex; flex-direction:column; gap:8px; margin-bottom:12px; padding:10px; background:var(--bg); border:1px solid var(--border); border-radius:8px;">
              <input type="text" id="master-search" class="form-input" placeholder="ë„ê° ì¹´ë“œëª… ê²€ìƒ‰..." oninput="renderCreatedList()">
              <div style="display:flex; gap:5px; align-items:center; flex-wrap:wrap;">
                <div class="filter-bar" id="master-filter" style="margin-bottom:0; flex:1;">
                  <div class="filter-chip active" onclick="filterMaster('all',this)">ALL</div>
                  <div class="filter-chip" onclick="filterMaster('1',this)">T1</div>
                  <div class="filter-chip" onclick="filterMaster('2',this)">T2</div>
                  <div class="filter-chip" onclick="filterMaster('3',this)">T3</div>
                  <div class="filter-chip" onclick="filterMaster('4',this)">T4</div>
                  <div class="filter-chip" onclick="filterMaster('5',this)">T5</div>
                  <div class="filter-chip" onclick="filterMaster('6',this)">T6</div>
                  <div class="filter-chip" onclick="filterMaster('7',this)">T7</div>
                </div>
                <select id="master-stat-filter" class="form-input" style="width:150px; font-size:11px;" onchange="renderCreatedList()">
                  <option value="">ìŠ¤íƒ¯ í•„í„°: ì „ì²´</option>
                </select>
              </div>
            </div>
            
            <div class="card-list" id="created-list"><div class="card-item ani" data-tier="1" data-id="s7bcnxq" onclick="openCardTooltip(&#39;s7bcnxq&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;s7bcnxq&#39;,null)">
    <div class="card-icon">ğŸŒ¿</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ëˆ„ì´ì•ˆ</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+25 ìµœëŒ€ ì²´ë ¥</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;s7bcnxq&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="rjspw80" onclick="openCardTooltip(&#39;rjspw80&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;rjspw80&#39;,null)">
    <div class="card-icon">ğŸ‘¹</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ì˜¤í¬</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+10 ë¬¼ë¦¬ ë°©ì–´ë ¥</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;rjspw80&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="j4970y5" onclick="openCardTooltip(&#39;j4970y5&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;j4970y5&#39;,null)">
    <div class="card-icon">ğŸ¦</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë†€</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+10 ë¬¼ë¦¬ ë°©ì–´ë ¥</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;j4970y5&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="q29b9ge" onclick="openCardTooltip(&#39;q29b9ge&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;q29b9ge&#39;,null)">
    <div class="card-icon">ğŸ’€</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ìŠ¤ì¼ˆë ˆí†¤</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ì²´ë ¥ ì§€ì† íšŒë³µëŸ‰</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;q29b9ge&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="4o5b756" onclick="openCardTooltip(&#39;4o5b756&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;4o5b756&#39;,null)">
    <div class="card-icon">ğŸŒ‘</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">íŒ¬í…€</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ê³µê²©ë ¥</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;4o5b756&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="c692ti5" onclick="openCardTooltip(&#39;c692ti5&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;c692ti5&#39;,null)">
    <div class="card-icon">ğŸ’§</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë¬¼ ì •ë ¹</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ë§ˆë ¥ ì§€ì† íšŒë³µëŸ‰</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;c692ti5&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="tasoy2e" onclick="openCardTooltip(&#39;tasoy2e&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;tasoy2e&#39;,null)">
    <div class="card-icon">ğŸŒ¿</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë‚˜ë¬´ ì •ë ¹</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ìŠ¤í‚¬ ê°€ì†</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;tasoy2e&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="fjk8pnk" onclick="openCardTooltip(&#39;fjk8pnk&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;fjk8pnk&#39;,null)">
    <div class="card-icon">ğŸª¨</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë°”ìœ„ ì •ë ¹</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ìŠ¤í‚¬ ê°€ì†</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;fjk8pnk&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="1" data-id="g10fuep" onclick="openCardTooltip(&#39;g10fuep&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;g10fuep&#39;,null)">
    <div class="card-icon">ğŸŒ±</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb1" style="flex-shrink:0;">T1</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ì´ë¼ ì •ë ¹</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+3 ìŠ¤í‚¬ ê°€ì†</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;g10fuep&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="2" data-id="ihnriil" onclick="openCardTooltip(&#39;ihnriil&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;ihnriil&#39;,null)">
    <div class="card-icon">âš”ï¸</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb2" style="flex-shrink:0;">T2</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ì˜¤í¬ ì¡±ì¥</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+0.4% ê³µê²© ì†ë„</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;ihnriil&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="2" data-id="10selhk" onclick="openCardTooltip(&#39;10selhk&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;10selhk&#39;,null)">
    <div class="card-icon">ğŸ¦…</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb2" style="flex-shrink:0;">T2</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë†€ ìš°ë‘ë¨¸ë¦¬</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+0.3% ì´ë™ ì†ë„</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;10selhk&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="3" data-id="8sys69j" onclick="openCardTooltip(&#39;8sys69j&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;8sys69j&#39;,null)">
    <div class="card-icon">ğŸ¦‚</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb3" style="flex-shrink:0;">T3</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ìŠ¤ì¹¼ë‹ˆí† ìŠ¤</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+0.2% PVE ëŒ€ë¯¸ì§€ ê°ì†Œ</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;8sys69j&#39;)">ì‚­ì œ</button></div>
    </div>
  </div><div class="card-item ani" data-tier="3" data-id="9r43tpw" onclick="openCardTooltip(&#39;9r43tpw&#39;)" draggable="true" ondragstart="if(document.getElementById(&#39;enh-overlay&#39;).classList.contains(&#39;open&#39;)){event.preventDefault();return;}onDragStart(event,&#39;9r43tpw&#39;,null)">
    <div class="card-icon">ğŸ²</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb3" style="flex-shrink:0;">T3</span>
        <span class="enh-badge">0ê°•</span>
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">ë§ì¹´ë°”ëˆ</span>
      </div>
      <div class="card-stats-row"><span class="stat-chip">+0.2% PVE ëŒ€ë¯¸ì§€ ì¦ê°€</span></div>
      <div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard(&#39;9r43tpw&#39;)">ì‚­ì œ</button></div>
    </div>
  </div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ ê°•í™” ì„¤ì • íƒ­ â”€â”€ -->
  <div id="tab-config" class="tab-content" style="display:none;">
    <div style="max-width:700px;margin:0 auto;">
      <div class="panel" style="margin-bottom:16px;">
        <div class="panel-hd"><div class="panel-title">âš™ï¸ ê°•í™” í™•ë¥  ì„¤ì •</div></div>
        <div class="panel-bd">
          <table class="config-table">
            <thead>
              <tr>
                <th>ê°•í™” ë‹¨ê³„</th>
                <th>ì‹¤íŒ¨ í™•ë¥  (%)</th>
                <th style="width:100px;"></th>
                <th>íŒŒê´´ í™•ë¥  (%)<br><span style="font-weight:400;font-size:8px;color:var(--text3)">(ì‹¤íŒ¨ì‹œ ì ìš©)</span></th>
                <th style="width:100px;"></th>
              </tr>
            </thead>
            <tbody id="config-tbody"><tr>
      <td><span class="config-lv-label" style="color:var(--e1)">0ê°• â†’ +1ê°•</span></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="0" oninput="updateCfg(0,&#39;fail&#39;,this.value);updateProbBar(&#39;fbar0&#39;,0,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="fbar0" style="width:0%;background:var(--red);"></div></div></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="0" oninput="updateCfg(0,&#39;destroy&#39;,this.value);updateProbBar(&#39;dbar0&#39;,0,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="dbar0" style="width:0%;background:#ff3030;"></div></div></td>
    </tr><tr>
      <td><span class="config-lv-label" style="color:var(--e2)">1ê°• â†’ +2ê°•</span></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="20" oninput="updateCfg(1,&#39;fail&#39;,this.value);updateProbBar(&#39;fbar1&#39;,20,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="fbar1" style="width:20%;background:var(--red);"></div></div></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="50" oninput="updateCfg(1,&#39;destroy&#39;,this.value);updateProbBar(&#39;dbar1&#39;,50,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="dbar1" style="width:50%;background:#ff3030;"></div></div></td>
    </tr><tr>
      <td><span class="config-lv-label" style="color:var(--e3)">2ê°• â†’ +3ê°•</span></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="50" oninput="updateCfg(2,&#39;fail&#39;,this.value);updateProbBar(&#39;fbar2&#39;,50,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="fbar2" style="width:50%;background:var(--red);"></div></div></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="50" oninput="updateCfg(2,&#39;destroy&#39;,this.value);updateProbBar(&#39;dbar2&#39;,50,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="dbar2" style="width:50%;background:#ff3030;"></div></div></td>
    </tr><tr>
      <td><span class="config-lv-label" style="color:var(--e4)">3ê°• â†’ +4ê°•</span></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="70" oninput="updateCfg(3,&#39;fail&#39;,this.value);updateProbBar(&#39;fbar3&#39;,70,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="fbar3" style="width:70%;background:var(--red);"></div></div></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="50" oninput="updateCfg(3,&#39;destroy&#39;,this.value);updateProbBar(&#39;dbar3&#39;,50,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="dbar3" style="width:50%;background:#ff3030;"></div></div></td>
    </tr><tr>
      <td><span class="config-lv-label" style="color:var(--e5)">4ê°• â†’ +5ê°•</span></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="90" oninput="updateCfg(4,&#39;fail&#39;,this.value);updateProbBar(&#39;fbar4&#39;,90,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="fbar4" style="width:90%;background:var(--red);"></div></div></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="50" oninput="updateCfg(4,&#39;destroy&#39;,this.value);updateProbBar(&#39;dbar4&#39;,50,this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="dbar4" style="width:50%;background:#ff3030;"></div></div></td>
    </tr></tbody>
          </table>
          <div class="config-note">
            âœ¦ ì‹¤íŒ¨ í™•ë¥  : ê°•í™” ì‹œë„ ì‹œ í•´ë‹¹ í™•ë¥ ë¡œ ê°•í™” ìˆ˜ì¹˜ê°€ ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
            âœ¦ íŒŒê´´ í™•ë¥  : ê°•í™” ì‹¤íŒ¨ ì‹œ í•´ë‹¹ í™•ë¥ ë¡œ ì›ë³¸ ì¹´ë“œê°€ ì†Œë©¸í•©ë‹ˆë‹¤.<br>
            âœ¦ ì¬ë£Œ ì¹´ë“œ ì—†ì´ ë™ì¼ ì¹´ë“œ ë‹¨ë…ìœ¼ë¡œ ê°•í™”í•©ë‹ˆë‹¤. ì‹¤íŒ¨í•´ë„ ê°•í™” ìˆ˜ì¹˜ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.
          </div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-hd"><div class="panel-title">ğŸ“œ ê°•í™” ê¸°ë¡</div></div>
        <div class="panel-bd" style="padding:10px;">
          <div class="enh-log" id="enh-log">
            <div style="font-size:10px;color:var(--text3);text-align:center;padding:8px;font-family:&#39;Rajdhani&#39;,sans-serif;">ê°•í™” ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ ì„¸íŠ¸ ì¡°í•© íƒ­ â”€â”€ -->
  <div id="tab-sets" class="tab-content" style="display: none;">
    <div class="main-grid" style="grid-template-columns:1fr 1fr;">

      <!-- ì„¸íŠ¸ ëª©ë¡ -->
      <div class="panel">
        <div class="panel-hd">
          <div class="panel-title">ğŸƒ ì„¸íŠ¸ íš¨ê³¼ ëª©ë¡</div>
          <span style="font-size:10px;color:var(--text3);margin-left:auto;font-family:&#39;Rajdhani&#39;,sans-serif;">ì¹´ë“œ ì¥ì°© ì‹œ ìë™ ë°œë™</span>
        </div>
        <div class="panel-bd" style="padding:10px;">
          <div style="display:flex; flex-direction:column; gap:8px; margin-bottom:15px; padding:10px; background:var(--bg); border:1px solid var(--border); border-radius:8px;">
            <input type="text" id="set-search" class="form-input" placeholder="ì„¸íŠ¸ëª… ë˜ëŠ” ì¹´ë“œëª… ê²€ìƒ‰..." oninput="renderSetDefsList()">
            
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
              <button id="filter-grade-toggle" class="btn-sm" style="min-width:100px; border-color:var(--border3);" onclick="toggleGradeFilter()">ë“±ê¸‰: ì „ì²´</button>
              
              <select id="filter-stat-dropdown" class="form-input" style="width:160px; font-size:11px;" onchange="toggleStatFilter(this.value)">
                <option value="">ìŠ¤íƒ¯ í•„í„°: ì „ì²´</option>
              </select>
            </div>
          </div>
          <div id="set-defs-list"><div class="set-def-card grade-pair set-def-active">
      <div class="set-def-active-badge">âš¡ ë°œë™ ì¤‘</div>
      <div class="set-def-name">ë¬¸ëª…ê³¼ ì•¼ì„±</div>
      <div class="set-def-grade" style="background:var(--pair-c)20;color:var(--pair-c);">í˜ì–´ Â· 2ì¥</div>
      <div class="set-def-members"><span class="set-def-chip">ëˆ„ì´ì•ˆ</span><span class="set-def-chip">ì˜¤í¬</span></div>
      <div class="set-def-desc">ìì—°ì˜ ì§€í˜œì™€ ì•¼ìˆ˜ì˜ í˜ì´ ì–´ìš°ëŸ¬ì ¸ ê³µê²©ë ¥ê³¼ ë°©ì–´ë ¥ì´ ì¦ê°€í•œë‹¤.</div>
      <div class="set-def-effect"><span class="set-def-efx-chip">+30 ê³µê²©ë ¥</span><span class="set-def-efx-chip">+20 ë¬¼ë¦¬ ë°©ì–´ë ¥</span></div>
      <div class="set-def-actions">
        <button class="btn-sm" onclick="editSetDef(&#39;set_001&#39;)">í¸ì§‘</button>
        <button class="btn-danger" onclick="deleteSetDef(&#39;set_001&#39;)">ì‚­ì œ</button>
      </div>
    </div><div class="set-def-card grade-triple">
      
      <div class="set-def-name">ì£½ìŒì˜ ê·¸ë¦¼ì</div>
      <div class="set-def-grade" style="background:var(--triple-c)20;color:var(--triple-c);">íŠ¸ë¦¬í”Œ Â· 3ì¥</div>
      <div class="set-def-members"><span class="set-def-chip">ìŠ¤ì¼ˆë ˆí†¤</span><span class="set-def-chip">íŒ¬í…€</span><span class="set-def-chip">ë§ì¹´ë°”ëˆ</span></div>
      <div class="set-def-desc">ì €ìŠ¹ì˜ ì„¸ ìˆ˜í˜¸ìê°€ ëª¨ì´ë©´ ê³µí¬ê°€ í˜„ì‹¤ì´ ëœë‹¤. ëª¨ë“  í”¼í•´ê°€ ëŒ€í­ ì¦ê°€í•œë‹¤.</div>
      <div class="set-def-effect"><span class="set-def-efx-chip">+15% ì£¼ëŠ” í”¼í•´ ì¦ê°€</span><span class="set-def-efx-chip">+10% PVE ëŒ€ë¯¸ì§€ ì¦ê°€</span></div>
      <div class="set-def-actions">
        <button class="btn-sm" onclick="editSetDef(&#39;set_002&#39;)">í¸ì§‘</button>
        <button class="btn-danger" onclick="deleteSetDef(&#39;set_002&#39;)">ì‚­ì œ</button>
      </div>
    </div><div class="set-def-card grade-straight">
      
      <div class="set-def-name">ì¸ê°„ê³¼ ì •ë ¹</div>
      <div class="set-def-grade" style="background:var(--straight-c)20;color:var(--straight-c);">ìŠ¤íŠ¸ë ˆì´íŠ¸ Â· 5ì¥</div>
      <div class="set-def-members"><span class="set-def-chip">ë‚˜ë¬´ ì •ë ¹</span><span class="set-def-chip">ë°”ìœ„ ì •ë ¹</span><span class="set-def-chip">ì´ë¼ ì •ë ¹</span><span class="set-def-chip">ë¬¼ ì •ë ¹</span><span class="set-def-chip">ëˆ„ì´ì•ˆ</span></div>
      <div class="set-def-desc">ëŒ€ì§€ì˜ ì •ë ¹ë“¤ê³¼ ì¸ê°„ì´ í•˜ë‚˜ê°€ ë˜ì–´ ìì—°ì˜ ëª¨ë“  í˜ì„ ì´ëŒì–´ë‚¸ë‹¤.</div>
      <div class="set-def-effect"><span class="set-def-efx-chip">+200 ìµœëŒ€ ì²´ë ¥</span><span class="set-def-efx-chip">+5 ì²´ë ¥ ì§€ì† íšŒë³µëŸ‰</span><span class="set-def-efx-chip">+10 ìŠ¤í‚¬ ê°€ì†</span></div>
      <div class="set-def-actions">
        <button class="btn-sm" onclick="editSetDef(&#39;set_003&#39;)">í¸ì§‘</button>
        <button class="btn-danger" onclick="deleteSetDef(&#39;set_003&#39;)">ì‚­ì œ</button>
      </div>
    </div><div class="set-def-card grade-triple">
      
      <div class="set-def-name">ë¬¼ë‚˜ë¬´ì¸ê°„</div>
      <div class="set-def-grade" style="background:var(--triple-c)20;color:var(--triple-c);">íŠ¸ë¦¬í”Œ Â· 3ì¥</div>
      <div class="set-def-members"><span class="set-def-chip">ë‚˜ë¬´ ì •ë ¹</span><span class="set-def-chip">ëˆ„ì´ì•ˆ</span><span class="set-def-chip">ë¬¼ ì •ë ¹</span></div>
      <div class="set-def-desc">-</div>
      <div class="set-def-effect"><span class="set-def-efx-chip">+100 ìµœëŒ€ ì²´ë ¥</span></div>
      <div class="set-def-actions">
        <button class="btn-sm" onclick="editSetDef(&#39;set_vse2pjo&#39;)">í¸ì§‘</button>
        <button class="btn-danger" onclick="deleteSetDef(&#39;set_vse2pjo&#39;)">ì‚­ì œ</button>
      </div>
    </div></div>
        </div>
      </div>

      <!-- ì„¸íŠ¸ ì¶”ê°€/í¸ì§‘ -->
      <div class="panel">
        <div class="panel-hd">
          <div class="panel-title" id="set-form-title">âœ¨ ìƒˆ ì„¸íŠ¸ ì¶”ê°€</div>
          <button class="btn-sm" style="margin-left:auto;font-size:10px;" onclick="resetSetForm()">ì´ˆê¸°í™”</button>
        </div>
        <div class="panel-bd" style="padding:14px;">

          <!-- ì„¸íŠ¸ ì´ë¦„ -->
          <div style="margin-bottom:10px;">
            <div class="form-label">ì„¸íŠ¸ ì´ë¦„</div>
            <input id="sf-name" class="form-input" type="text" placeholder="ex) ë¬¸ëª…ê³¼ ì•¼ì„±">
          </div>

          <!-- ì„¸íŠ¸ ë“±ê¸‰ -->
          <div style="margin-bottom:10px;">
            <div class="form-label">ì„¸íŠ¸ ë“±ê¸‰</div>
            <div style="display:flex;gap:6px;">
              <label class="grade-radio-label" id="grl-pair">
                <input type="radio" name="sf-grade" value="pair" checked="" onchange="onGradeChange(this)">
                <span style="color:var(--pair-c)">í˜ì–´ (2ì¥)</span>
              </label>
              <label class="grade-radio-label" id="grl-triple">
                <input type="radio" name="sf-grade" value="triple" onchange="onGradeChange(this)">
                <span style="color:var(--triple-c)">íŠ¸ë¦¬í”Œ (3ì¥)</span>
              </label>
              <label class="grade-radio-label" id="grl-straight">
                <input type="radio" name="sf-grade" value="straight" onchange="onGradeChange(this)">
                <span style="color:var(--straight-c)">ìŠ¤íŠ¸ë ˆì´íŠ¸ (5ì¥)</span>
              </label>
            </div>
          </div>

          <!-- ì¹´ë“œ êµ¬ì„± -->
          <div style="margin-bottom:10px;">
            <div class="form-label">êµ¬ì„± ì¹´ë“œ <span id="sf-card-hint" style="color: var(--pair-c); font-weight: 700;">2ì¥ ì„ íƒ</span></div>
            <div id="sf-card-picker" style="display:flex;flex-wrap:wrap;gap:5px;max-height:140px;overflow-y:auto;padding:6px;background:var(--bg);border:1px solid var(--border);border-radius:6px;">
          </div>

          <!-- ì„¸íŠ¸ ì„¤ëª… -->
          <div style="margin-bottom:10px;">
            <div class="form-label">ì„¸íŠ¸ íš¨ê³¼ ì„¤ëª…</div>
            <textarea id="sf-desc" class="form-input" rows="2" placeholder="ì„¸íŠ¸ ë°œë™ ì‹œ íš¨ê³¼ ì„¤ëª…"></textarea>
          </div>

          <!-- ë³´ë„ˆìŠ¤ ìŠ¤íƒ¯ -->
          <div style="margin-bottom:12px;">
            <div class="form-label">ë³´ë„ˆìŠ¤ ìŠ¤íƒ¯ <span style="color:var(--text3);font-size:9px;">(ì„ íƒ)</span></div>
            <div style="display:flex;gap:6px;margin-bottom:6px;">
              <select id="sf-stat-key" class="form-input" style="flex:1;"><option value="">ìŠ¤íƒ¯ ì„ íƒ</option><option value="AttackVary">ê³µê²©ë ¥</option><option value="PhysicalDefenseVary">ë¬¼ë¦¬ ë°©ì–´ë ¥</option><option value="MagicDefenseVary">ë§ˆë²• ë°©ì–´ë ¥</option><option value="AtkSpeedVaryper">ê³µê²© ì†ë„(%)</option><option value="MoveSpeedVaryper">ì´ë™ ì†ë„(%)</option><option value="MaxHpVary">ìµœëŒ€ ì²´ë ¥</option><option value="MaxMpVary">ìµœëŒ€ ë§ˆë ¥</option><option value="RegenHpVary">ì²´ë ¥ ì§€ì† íšŒë³µëŸ‰</option><option value="RegenMpVary">ë§ˆë ¥ ì§€ì† íšŒë³µëŸ‰</option><option value="DamageUpVaryper">ì£¼ëŠ” í”¼í•´ ì¦ê°€(%)</option><option value="DamageDownVaryper">ë°›ëŠ” í”¼í•´ ê°ì†Œ(%)</option><option value="PhysicalDamageUpVaryper">ë¬¼ë¦¬ í”¼í•´ ì¦ê°€(%)</option><option value="PhysicalDamageDownVaryper">ë¬¼ë¦¬ í”¼í•´ ê°ì†Œ(%)</option><option value="MagicDamageUpVaryper">ë§ˆë²• í”¼í•´ ì¦ê°€(%)</option><option value="MagicDamageDownVaryper">ë§ˆë²• í”¼í•´ ê°ì†Œ(%)</option><option value="PVEDamageUpVaryper">PVE ëŒ€ë¯¸ì§€ ì¦ê°€(%)</option><option value="PVEDamageDownVaryper">PVE ëŒ€ë¯¸ì§€ ê°ì†Œ(%)</option><option value="PVPDamageUpVaryper">PVP ëŒ€ë¯¸ì§€ ì¦ê°€(%)</option><option value="PVPDamageDownVaryper">PVP ëŒ€ë¯¸ì§€ ê°ì†Œ(%)</option><option value="DodgeVaryper">íšŒí”¼(%)</option><option value="CriVaryper">ì¹˜ëª…íƒ€ í™•ë¥ (%)</option><option value="CriDamageVaryper">ì¹˜ëª…íƒ€ í”¼í•´ ì¦ê°€(%)</option><option value="SkillCooldownAccVary">ìŠ¤í‚¬ ê°€ì†</option><option value="SCNegativeRecoveryVary">ìƒíƒœ ì´ìƒ íšŒë³µ</option><option value="CostMpDownVaryper">ë§ˆë‚˜ ì†Œëª¨ëŸ‰ ê°ì†Œ(%)</option><option value="MountSpeedVaryper">íƒˆ ê²ƒ ì´ë™ ì†ë„(%)</option></select>
              <input id="sf-stat-val" class="form-input" type="number" placeholder="ê°’" style="width:72px;">
              <button class="btn-sm" onclick="addSetStat()">+</button>
            </div>
            <div id="sf-stat-list" style="display:flex;flex-direction:column;gap:4px;"><span style="font-size:10px;color:var(--text3);">ë³´ë„ˆìŠ¤ ìŠ¤íƒ¯ ì—†ìŒ</span></div>
          </div>

          <input type="hidden" id="sf-edit-id" value="">
          <button class="btn-primary" style="width:100%;" onclick="saveSetDef()">ğŸ’¾ ì„¸íŠ¸ ì €ì¥</button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- â”€â”€ ê°•í™” ì˜¤ë²„ë ˆì´ â”€â”€ -->
<div class="enh-overlay" id="enh-overlay">
  <div class="enh-modal" id="enh-modal" onclick="event.stopPropagation()">

    <!-- ì¹´ë“œ í—¤ë” -->
    <div class="enh-card-header" id="enh-header"></div>

    <!-- í™•ë¥  ì„¹ì…˜ -->
    <div class="enh-section" id="enh-prob-section">
      <div class="enh-section-label">ê°•í™” í™•ë¥ </div>
      <div class="prob-grid" id="enh-prob-grid"></div>
    </div>

    <!-- ìŠ¤íƒ¯ ë¹„êµ -->
    <div class="enh-section" id="enh-stat-section">
      <div class="enh-section-label">ê°•í™” í›„ ëŠ¥ë ¥ì¹˜ ë³€í™”</div>
      <div class="stat-compare-grid" id="enh-stat-compare"></div>
    </div>

    <!-- ê°•í™” ë²„íŠ¼ -->
    <div class="enh-action">
      <button class="btn-enhance" id="enh-do-btn" onclick="doEnhance()">ğŸ”¥ ê°•í™” ì‹œë„</button>
      <div class="enh-action-note" id="enh-action-note"></div>
    </div>
  </div>
</div>

<!-- â”€â”€ ì¹´ë“œ íˆ´íŒ ì˜¤ë²„ë ˆì´ â”€â”€ -->
<div class="card-tooltip-overlay" id="card-tooltip-overlay" onclick="closeCardTooltip()">
  <div class="card-tooltip-modal" id="card-tooltip-modal" onclick="event.stopPropagation()">
    <div class="ctt-header" id="ctt-header"></div>
    <div class="ctt-body" id="ctt-body"></div>
    <div class="ctt-footer" id="ctt-footer"></div>
  </div>
</div>

<!-- ê°•í™” ê²°ê³¼ íŒì—… -->
<div class="result-overlay" id="result-overlay">
  <div class="result-box" id="result-box">
    <div class="sparks" id="result-sparks"></div>
    <div class="result-ico" id="result-ico"></div>
    <div class="result-title" id="result-title"></div>
    <div class="result-desc" id="result-desc"></div>
    <button class="btn-primary" style="width:160px;margin:0 auto;" onclick="closeResult()">í™•ì¸</button>
  </div>
</div>

<!-- ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ (ìŠ¬ë¡¯ìš©) -->
<div class="modal-overlay" id="card-modal">
  <div class="modal-inner">
    <div class="modal-hd">
      <div class="modal-title" id="modal-title">ì¹´ë“œ ì„ íƒ</div>
      <button class="modal-close-btn" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="card-list" id="modal-card-list"></div>
    </div>
  </div>
</div>

<div id="toast" class="">ìŠ¬ë¡¯ 2ì— "ë°”ìœ„ ì •ë ¹" ì¥ì°©!</div>

<script>
// ==========================================
// ìƒìˆ˜ / ìƒíƒœ
// ==========================================
let cards = []; // ë§ˆìŠ¤í„° ë„ê° ë°ì´í„°
let userInventory = [];   // ìœ ì €ê°€ ì‹¤ì œë¡œ ì†Œìœ í•œ ì¹´ë“œ (ì¸ë²¤í† ë¦¬)
let slots = [null,null,null,null,null];

// â”€â”€ ì„¸íŠ¸ ì •ì˜ DB â”€â”€
// { id, name, cardTypes:[], size:2|3|5, grade:'pair'|'triple'|'straight', desc, effect:{} }
let setDefs = [
  // 1. ìŠ¤íŠ¸ë ˆì´íŠ¸ (ê³ í‹°ì–´ ë§ì¹´ë°”ëˆ í¬í•¨ìœ¼ë¡œ ë‚œì´ë„ ìƒìŠ¹)
  { 
    id: 'set_str_abyss', name: 'ì‹¬ì—°ì˜ ê°œì²™ì', 
    cardTypes: ['ëˆ„ì´ì•ˆ', 'ì˜¤í¬', 'ë†€', 'ìŠ¤ì¼ˆë ˆí†¤', 'ë§ì¹´ë°”ëˆ'], 
    size: 5, grade: 'straight',
    desc: 'ì‹¬ì—°ì˜ í˜ê³¼ ê°œì²™ìì˜ ì˜ì§€ê°€ ë§Œë‚˜ ìµœê°•ì˜ ì„±ëŠ¥ì„ ë°œíœ˜í•©ë‹ˆë‹¤.',
    effect: { AttackVary: 50, MaxHpVary: 300, DamageUpVaryper: 15 } 
  },
  // 2. íŠ¸ë¦¬í”Œ (ì •ë ¹ ì¡°í•©)
  { 
    id: 'set_tri_element', name: 'ì›ì†Œì˜ ì¸ë„ì', 
    cardTypes: ['ë¬¼ ì •ë ¹', 'ë‚˜ë¬´ ì •ë ¹', 'ë°”ìœ„ ì •ë ¹'], 
    size: 3, grade: 'triple',
    desc: 'ìˆœìˆ˜ ì›ì†Œ ì •ë ¹ë“¤ì´ ë§ˆë ¥ì˜ íë¦„ì„ ì›í™œí•˜ê²Œ í•©ë‹ˆë‹¤.',
    effect: { SkillCooldownAccVary: 20, RegenMpVary: 10 } 
  },
  { 
    id: 'set_tri_earth', name: 'ëŒ€ì§€ì˜ ìˆ˜í˜¸ì', 
    cardTypes: ['ì´ë¼ ì •ë ¹', 'ë‚˜ë¬´ ì •ë ¹', 'ë°”ìœ„ ì •ë ¹'], 
    size: 3, grade: 'triple',
    desc: 'ëŒ€ì§€ì˜ ê¸°ìš´ì„ ë¨¸ê¸ˆì€ ì •ë ¹ë“¤ì´ ê²¬ê³ í•œ ë°©ì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.',
    effect: { PhysicalDefenseVary: 40, SCNegativeRecoveryVary: 15 } 
  },
  // 3. í˜ì–´ (ê¸°ì´ˆ ì„±ëŠ¥)
  { 
    id: 'set_pair_wild', name: 'ì•¼ì„±ì˜ ì§€ë°°ì', 
    cardTypes: ['ì˜¤í¬ ì¡±ì¥', 'ë†€ ìš°ë‘ë¨¸ë¦¬'], 
    size: 2, grade: 'pair',
    desc: 'ì•¼ìƒì˜ ìš°ë‘ë¨¸ë¦¬ë“¤ì´ ë¹ ë¥¸ ì†ë„ë¥¼ ì„ ì‚¬í•©ë‹ˆë‹¤.',
    effect: { AtkSpeedVaryper: 1.5, MoveSpeedVaryper: 1.0 } 
  },
  { 
    id: 'set_pair_phantom', name: 'ë§ë ¹ì˜ ê¸°ìŠµ', 
    cardTypes: ['íŒ¬í…€', 'ìŠ¤ì¼ˆë ˆí†¤'], 
    size: 2, grade: 'pair',
    desc: 'ì–´ë‘  ì†ì˜ ë§ë ¹ë“¤ì´ ì¹˜ëª…ì ì¸ ì¼ê²©ì„ ë•ìŠµë‹ˆë‹¤.',
    effect: { CriVaryper: 3.0, AttackVary: 10 } 
  },
  { 
    id: 'set_pair_nature', name: 'ìì—°ì˜ ê³µëª…', 
    cardTypes: ['ì´ë¼ ì •ë ¹', 'ë¬¼ ì •ë ¹'], 
    size: 2, grade: 'pair',
    desc: 'ìì—°ì˜ ì •ë ¹ë“¤ì´ ëŠì„ì—†ëŠ” ìƒëª…ë ¥ì„ ë¶€ì—¬í•©ë‹ˆë‹¤.',
    effect: { RegenHpVary: 5, RegenMpVary: 5 } 
  }
];
let selTierVal = null;
let selIconVal = 'ğŸ”¥';
let invFilterVal = 'all';
let dragCardId = null;
let dragFromSlot = null;
let activeModalSlot = null;
let enhTargetId = null; // í˜„ì¬ ê°•í™” ì˜¤ë²„ë ˆì´ì— ì—´ë ¤ìˆëŠ” ì¹´ë“œ ID

// ê°•í™” ì„¤ì •
let enhConfig = [
  {fail:0,  destroy:0 },
  {fail:20, destroy:50},
  {fail:50, destroy:50},
  {fail:70, destroy:50},
  {fail:90, destroy:50},
];

const ICONS = ['ğŸ”¥','ğŸ’§','âš¡','ğŸŒ¿','ğŸŒ‘','â„ï¸','ğŸ‰','ğŸº','ğŸ¦‚','ğŸ¦','ğŸ¸','ğŸ¦Š','ğŸ¦‡','ğŸ•·ï¸','ğŸ’€','âš”ï¸','ğŸ—¡ï¸','ğŸ›¡ï¸','ğŸŒ€','ğŸŒªï¸','ğŸ”®','ğŸ’','ğŸ‘¹','ğŸ‘º','ğŸ²','ğŸ¦…','ğŸ','ğŸ¦ˆ','ğŸ¯','ğŸ¦‹'];

// StatExpose.csv ê¸°ë°˜ ì‹¤ì œ ìŠ¤íƒ¯ ëª©ë¡
// key: StatName(ì˜ë¬¸), label: í•œê¸€ëª…, unit: ë‹¨ìœ„, sortOrder: ì •ë ¬
const STAT_DEFS = [
  {key:'AttackVary',              label:'ê³µê²©ë ¥',             unit:'',  sort:1},
  {key:'PhysicalDefenseVary',     label:'ë¬¼ë¦¬ ë°©ì–´ë ¥',         unit:'',  sort:2},
  {key:'MagicDefenseVary',        label:'ë§ˆë²• ë°©ì–´ë ¥',         unit:'',  sort:3},
  {key:'AtkSpeedVaryper',         label:'ê³µê²© ì†ë„',           unit:'%', sort:4},
  {key:'MoveSpeedVaryper',        label:'ì´ë™ ì†ë„',           unit:'%', sort:5},
  {key:'MaxHpVary',               label:'ìµœëŒ€ ì²´ë ¥',           unit:'',  sort:6},
  {key:'MaxMpVary',               label:'ìµœëŒ€ ë§ˆë ¥',           unit:'',  sort:7},
  {key:'RegenHpVary',             label:'ì²´ë ¥ ì§€ì† íšŒë³µëŸ‰',    unit:'',  sort:8},
  {key:'RegenMpVary',             label:'ë§ˆë ¥ ì§€ì† íšŒë³µëŸ‰',    unit:'',  sort:9},
  {key:'DamageUpVaryper',         label:'ì£¼ëŠ” í”¼í•´ ì¦ê°€',      unit:'%', sort:10},
  {key:'DamageDownVaryper',       label:'ë°›ëŠ” í”¼í•´ ê°ì†Œ',      unit:'%', sort:11},
  {key:'PhysicalDamageUpVaryper', label:'ë¬¼ë¦¬ í”¼í•´ ì¦ê°€',      unit:'%', sort:12},
  {key:'PhysicalDamageDownVaryper',label:'ë¬¼ë¦¬ í”¼í•´ ê°ì†Œ',     unit:'%', sort:13},
  {key:'MagicDamageUpVaryper',    label:'ë§ˆë²• í”¼í•´ ì¦ê°€',      unit:'%', sort:14},
  {key:'MagicDamageDownVaryper',  label:'ë§ˆë²• í”¼í•´ ê°ì†Œ',      unit:'%', sort:15},
  {key:'PVEDamageUpVaryper',      label:'PVE ëŒ€ë¯¸ì§€ ì¦ê°€',     unit:'%', sort:16},
  {key:'PVEDamageDownVaryper',    label:'PVE ëŒ€ë¯¸ì§€ ê°ì†Œ',     unit:'%', sort:17},
  {key:'PVPDamageUpVaryper',      label:'PVP ëŒ€ë¯¸ì§€ ì¦ê°€',     unit:'%', sort:18},
  {key:'PVPDamageDownVaryper',    label:'PVP ëŒ€ë¯¸ì§€ ê°ì†Œ',     unit:'%', sort:19},
  {key:'DodgeVaryper',            label:'íšŒí”¼',               unit:'%', sort:20},
  {key:'CriVaryper',              label:'ì¹˜ëª…íƒ€ í™•ë¥ ',         unit:'%', sort:21},
  {key:'CriDamageVaryper',        label:'ì¹˜ëª…íƒ€ í”¼í•´ ì¦ê°€',    unit:'%', sort:22},
  {key:'SkillCooldownAccVary',    label:'ìŠ¤í‚¬ ê°€ì†',           unit:'',  sort:23},
  {key:'SCNegativeRecoveryVary',  label:'ìƒíƒœ ì´ìƒ íšŒë³µ',      unit:'',  sort:24},
  {key:'CostMpDownVaryper',       label:'ë§ˆë‚˜ ì†Œëª¨ëŸ‰ ê°ì†Œ',    unit:'%', sort:25},
  {key:'MountSpeedVaryper',       label:'íƒˆ ê²ƒ ì´ë™ ì†ë„',     unit:'%', sort:26},
];
// í¸ì˜ìš© ë§µ
const STAT_MAP = Object.fromEntries(STAT_DEFS.map(s=>[s.key,s]));
const SLBL = Object.fromEntries(STAT_DEFS.map(s=>[s.key,s.label]));
const SUNIT = Object.fromEntries(STAT_DEFS.map(s=>[s.key,s.unit]));
const TCOLOR = {1:'var(--t1)',2:'var(--t2)',3:'var(--t3)',4:'var(--t4)',5:'var(--t5)',6:'var(--t6)',7:'var(--t7)'};
const ECOLOR = {1:'var(--e1)',2:'var(--e2)',3:'var(--e3)',4:'var(--e4)',5:'var(--e5)'};
const ENH_MULT = {0:1.00,1:1.10,2:1.22,3:1.36,4:1.52,5:1.70};
const TIER_BG = {
  1:'rgba(156,163,175,.08)', 2:'rgba(74,222,128,.06)',
  3:'rgba(56,189,248,.06)',  4:'rgba(167,139,250,.06)',
  5:'rgba(249,115,22,.06)',  6:'rgba(244,63,94,.06)',
  7:'rgba(251,191,36,.08)'
};

// ==========================================
// ì´ˆê¸°í™”
// ==========================================
function init() {
  // ì„¸íŠ¸ í¼ ìŠ¤íƒ¯ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
  const sfStatKey = document.getElementById('sf-stat-key');
  if (sfStatKey) {
    sfStatKey.innerHTML = `<option value="">ìŠ¤íƒ¯ ì„ íƒ</option>` +
      STAT_DEFS.map(s=>`<option value="${s.key}">${s.label}${s.unit?'('+s.unit+')':''}</option>`).join('');
  }
  renderIconGrid();
  renderSlots();
  renderConfigTable();
  loadSamples();
  renderStatFilterDropdown();
  renderMasterStatDropdown();
}

// PrototypeDB.csv ê¸°ë°˜ ì¹´ë“œ ë°ì´í„°
// ì—…ê·¸ë ˆì´ë“œ ë‹¨ê³„ 0~5 ë¥¼ ê°•í™” ë ˆë²¨ì— ë§¤í•‘ (enhance=0 â†’ step0 ìŠ¤íƒ¯ ì‚¬ìš©)
// card.upgradeStats[step] = { StatKey: value }
const PROTOTYPE_DB = [
  // Cid 17010001 - ëˆ„ì´ì•ˆ ì¹´ë“œ (Tier1, ìµœëŒ€ ì²´ë ¥)
  { cid:'17010001', name:'ëˆ„ì´ì•ˆ', type:'ëˆ„ì´ì•ˆ', icon:'ğŸŒ¿', tier:1,
    upgradeStats:[
      {MaxHpVary:25},{MaxHpVary:40},{MaxHpVary:55},{MaxHpVary:70},{MaxHpVary:85},{MaxHpVary:100}
    ],
    setEffects:{ pair:'ìµœëŒ€ ì²´ë ¥ +5%', triple:'ìµœëŒ€ ì²´ë ¥ +12%, ì²´ë ¥ íšŒë³µ +3', straight:'ìƒëª…ì˜ ê°€í˜¸: ì²´ë ¥ ìƒí•œ +20%' }
  },
  // Cid 17010002 - ì˜¤í¬ ì¹´ë“œ (Tier1, ë¬¼ë¦¬ ë°©ì–´ë ¥)
  { cid:'17010002', name:'ì˜¤í¬', type:'ì˜¤í¬', icon:'ğŸ‘¹', tier:1,
    upgradeStats:[
      {PhysicalDefenseVary:10},{PhysicalDefenseVary:15},{PhysicalDefenseVary:20},{PhysicalDefenseVary:25},{PhysicalDefenseVary:30},{PhysicalDefenseVary:35}
    ],
    setEffects:{ pair:'ë¬¼ë¦¬ ë°©ì–´ +5%', triple:'ë¬¼ë¦¬ ë°©ì–´ +12%, ë°›ëŠ” í”¼í•´ ê°ì†Œ +2%', straight:'ì² ë²½: ë¬¼ë¦¬ í”¼í•´ ê°ì†Œ +10%' }
  },
  // Cid 17010003 - ë†€ ì¹´ë“œ (Tier1, ë¬¼ë¦¬ ë°©ì–´ë ¥)
  { cid:'17010003', name:'ë†€', type:'ë†€', icon:'ğŸ¦', tier:1,
    upgradeStats:[
      {PhysicalDefenseVary:10},{PhysicalDefenseVary:15},{PhysicalDefenseVary:20},{PhysicalDefenseVary:25},{PhysicalDefenseVary:30},{PhysicalDefenseVary:35}
    ],
    setEffects:{ pair:'ë¬¼ë¦¬ ë°©ì–´ +5%', triple:'ë¬¼ë¦¬ ë°©ì–´ +10%, ì´ë™ì†ë„ +2%', straight:'ë§¹ìˆ˜ì˜ ê¸°ìš´: ê³µê²©ë ¥ +8%' }
  },
  // Cid 17010004 - ìŠ¤ì¼ˆë ˆí†¤ ì¹´ë“œ (Tier1, ì²´ë ¥ ì§€ì† íšŒë³µëŸ‰)
  { cid:'17010004', name:'ìŠ¤ì¼ˆë ˆí†¤', type:'ìŠ¤ì¼ˆë ˆí†¤', icon:'ğŸ’€', tier:1,
    upgradeStats:[
      {RegenHpVary:3},{RegenHpVary:5},{RegenHpVary:7},{RegenHpVary:9},{RegenHpVary:11},{RegenHpVary:13}
    ],
    setEffects:{ pair:'ì²´ë ¥ íšŒë³µ +2', triple:'ì²´ë ¥ íšŒë³µ +5, ìµœëŒ€ ì²´ë ¥ +50', straight:'ë¶ˆì‚¬ì˜ ì¸ë‚´: ì „íˆ¬ ì¤‘ ì²´ë ¥ íšŒë³µ +20%' }
  },
  // Cid 17010005 - íŒ¬í…€ ì¹´ë“œ (Tier1, ê³µê²©ë ¥)
  { cid:'17010005', name:'íŒ¬í…€', type:'íŒ¬í…€', icon:'ğŸŒ‘', tier:1,
    upgradeStats:[
      {AttackVary:3},{AttackVary:5},{AttackVary:7},{AttackVary:9},{AttackVary:11},{AttackVary:13}
    ],
    setEffects:{ pair:'ê³µê²©ë ¥ +4%', triple:'ê³µê²©ë ¥ +10%, ì¹˜ëª…íƒ€ í™•ë¥  +1%', straight:'ìœ ë ¹ì˜ ìŠµê²©: ì£¼ëŠ” í”¼í•´ +8%' }
  },
  // Cid 17010006 - ë¬¼ ì •ë ¹ ì¹´ë“œ (Tier1, ë§ˆë ¥ ì§€ì† íšŒë³µëŸ‰)
  { cid:'17010006', name:'ë¬¼ ì •ë ¹', type:'ë¬¼ ì •ë ¹', icon:'ğŸ’§', tier:1,
    upgradeStats:[
      {RegenMpVary:3},{RegenMpVary:5},{RegenMpVary:7},{RegenMpVary:9},{RegenMpVary:11},{RegenMpVary:13}
    ],
    setEffects:{ pair:'ë§ˆë ¥ íšŒë³µ +2', triple:'ë§ˆë ¥ íšŒë³µ +5, ë§ˆë‚˜ ì†Œëª¨ -2%', straight:'ì •ë ¹ì˜ íë¦„: ìŠ¤í‚¬ ì¿¨íƒ€ì„ -5%' }
  },
  // Cid 17010007 - ë‚˜ë¬´ ì •ë ¹ ì¹´ë“œ (Tier1, ìŠ¤í‚¬ ê°€ì†)
  { cid:'17010007', name:'ë‚˜ë¬´ ì •ë ¹', type:'ë‚˜ë¬´ ì •ë ¹', icon:'ğŸŒ¿', tier:1,
    upgradeStats:[
      {SkillCooldownAccVary:3},{SkillCooldownAccVary:5},{SkillCooldownAccVary:7},{SkillCooldownAccVary:9},{SkillCooldownAccVary:11},{SkillCooldownAccVary:13}
    ],
    setEffects:{ pair:'ìŠ¤í‚¬ ê°€ì† +2', triple:'ìŠ¤í‚¬ ê°€ì† +5, ë§ˆë ¥ íšŒë³µ +2', straight:'ìì—°ì˜ ë¦¬ë“¬: ìŠ¤í‚¬ ì¿¨íƒ€ì„ -8%' }
  },
  // Cid 17010008 - ë°”ìœ„ ì •ë ¹ ì¹´ë“œ (Tier1, ìŠ¤í‚¬ ê°€ì†)
  { cid:'17010008', name:'ë°”ìœ„ ì •ë ¹', type:'ë°”ìœ„ ì •ë ¹', icon:'ğŸª¨', tier:1,
    upgradeStats:[
      {SkillCooldownAccVary:3},{SkillCooldownAccVary:5},{SkillCooldownAccVary:7},{SkillCooldownAccVary:9},{SkillCooldownAccVary:11},{SkillCooldownAccVary:13}
    ],
    setEffects:{ pair:'ìŠ¤í‚¬ ê°€ì† +2', triple:'ìŠ¤í‚¬ ê°€ì† +5, ë¬¼ë¦¬ ë°©ì–´ +5', straight:'ëŒ€ì§€ì˜ ì˜ì§€: ë°›ëŠ” í”¼í•´ -5%' }
  },
  // Cid 17010009 - ì´ë¼ ì •ë ¹ ì¹´ë“œ (Tier1, ìŠ¤í‚¬ ê°€ì†)
  { cid:'17010009', name:'ì´ë¼ ì •ë ¹', type:'ì´ë¼ ì •ë ¹', icon:'ğŸŒ±', tier:1,
    upgradeStats:[
      {SkillCooldownAccVary:3},{SkillCooldownAccVary:5},{SkillCooldownAccVary:7},{SkillCooldownAccVary:9},{SkillCooldownAccVary:11},{SkillCooldownAccVary:13}
    ],
    setEffects:{ pair:'ìŠ¤í‚¬ ê°€ì† +2', triple:'ìŠ¤í‚¬ ê°€ì† +5, ì´ë™ ì†ë„ +1%', straight:'ì´ë¼ì˜ ì—°í™˜: ìƒíƒœì´ìƒ íšŒë³µ +10' }
  },
  // Cid 17020001 - ì˜¤í¬ ì¡±ì¥ ì¹´ë“œ (Tier1, ê³µê²© ì†ë„%)
  { cid:'17020001', name:'ì˜¤í¬ ì¡±ì¥', type:'ì˜¤í¬ ì¡±ì¥', icon:'âš”ï¸', tier:2,
    upgradeStats:[
      {AtkSpeedVaryper:0.4},{AtkSpeedVaryper:0.6},{AtkSpeedVaryper:0.8},{AtkSpeedVaryper:1.0},{AtkSpeedVaryper:1.2},{AtkSpeedVaryper:1.4}
    ],
    setEffects:{ pair:'ê³µê²© ì†ë„ +0.5%', triple:'ê³µê²© ì†ë„ +1%, ê³µê²©ë ¥ +5%', straight:'ì¡±ì¥ì˜ í•¨ì„±: ê³µê²©ë ¥ +15%' }
  },
  // Cid 17020002 - ë†€ ìš°ë‘ë¨¸ë¦¬ ì¹´ë“œ (Tier2, ì´ë™ ì†ë„%)
  { cid:'17020002', name:'ë†€ ìš°ë‘ë¨¸ë¦¬', type:'ë†€ ìš°ë‘ë¨¸ë¦¬', icon:'ğŸ¦…', tier:2,
    upgradeStats:[
      {MoveSpeedVaryper:0.3},{MoveSpeedVaryper:0.5},{MoveSpeedVaryper:0.7},{MoveSpeedVaryper:0.9},{MoveSpeedVaryper:1.1},{MoveSpeedVaryper:1.3}
    ],
    setEffects:{ pair:'ì´ë™ ì†ë„ +0.5%', triple:'ì´ë™ ì†ë„ +1%, íšŒí”¼ +1%', straight:'ìš°ë‘ë¨¸ë¦¬ì˜ ê¸°ë™: PVE ëŒ€ë¯¸ì§€ +8%' }
  },
  // Cid 17030001 - ìŠ¤ì¹¼ë‹ˆí† ìŠ¤ ì¹´ë“œ (Tier3, PVE ëŒ€ë¯¸ì§€ ê°ì†Œ%)
  { cid:'17030001', name:'ìŠ¤ì¹¼ë‹ˆí† ìŠ¤', type:'ìŠ¤ì¹¼ë‹ˆí† ìŠ¤', icon:'ğŸ¦‚', tier:3,
    upgradeStats:[
      {PVEDamageDownVaryper:0.2},{PVEDamageDownVaryper:0.3},{PVEDamageDownVaryper:0.4},{PVEDamageDownVaryper:0.5},{PVEDamageDownVaryper:0.6},{PVEDamageDownVaryper:0.7}
    ],
    setEffects:{ pair:'PVE í”¼í•´ ê°ì†Œ +0.3%', triple:'PVE í”¼í•´ ê°ì†Œ +0.7%, ë¬¼ë¦¬ ë°©ì–´ +10', straight:'ìŠ¤ì¹¼ë‹ˆí† ìŠ¤ì˜ ê°‘ì£¼: ë°›ëŠ” í”¼í•´ ê°ì†Œ +3%' }
  },
  // Cid 17030002 - ë§ì¹´ë°”ëˆ ì¹´ë“œ (Tier3, PVE ëŒ€ë¯¸ì§€ ì¦ê°€%)
  { cid:'17030002', name:'ë§ì¹´ë°”ëˆ', type:'ë§ì¹´ë°”ëˆ', icon:'ğŸ²', tier:3,
    upgradeStats:[
      {PVEDamageUpVaryper:0.2},{PVEDamageUpVaryper:0.3},{PVEDamageUpVaryper:0.4},{PVEDamageUpVaryper:0.5},{PVEDamageUpVaryper:0.6},{PVEDamageUpVaryper:0.7}
    ],
    setEffects:{ pair:'PVE ëŒ€ë¯¸ì§€ +0.3%', triple:'PVE ëŒ€ë¯¸ì§€ +0.7%, ê³µê²©ë ¥ +8', straight:'ë§ì¹´ë°”ëˆì˜ ë¶„ë…¸: ì£¼ëŠ” í”¼í•´ ì¦ê°€ +5%' }
  },
];

function loadSamples() {
  // PROTOTYPE_DB ë°ì´í„°ë¥¼ ë§ˆìŠ¤í„° ë„ê°(cards)ì— ì±„ì›ë‹ˆë‹¤.
  cards = PROTOTYPE_DB.map(db => ({
    id: uid(), // ë„ê°ìš© ê³ ìœ  ID (ì¸ìŠ¤í„´ìŠ¤ì™€ êµ¬ë¶„ìš©)
    cid: db.cid,
    name: db.name,
    type: db.type,
    icon: db.icon,
    tier: db.tier,
    upgradeStats: db.upgradeStats,
    stats: {...db.upgradeStats[0]},
    setEffects: db.setEffects,
    enhance: 0,
  }));
  
  // [ì¶”ê°€] ì²˜ìŒ ì‹œì‘ ì‹œ ë„ê°ì˜ ì²« ë²ˆì§¸ ì¹´ë“œë¥¼ ìœ ì € ì¸ë²¤í† ë¦¬ì— í•˜ë‚˜ ë„£ì–´ì¤ë‹ˆë‹¤ (í…ŒìŠ¤íŠ¸ìš©)
  if(cards.length > 0) {
    obtainCard(cards[0].cid); 
  }
  renderAll();
}

function uid(){return Math.random().toString(36).slice(2,9);}

// ==========================================
// ìŠ¤íƒ¯ ê³„ì‚°
// ==========================================
// ê°•í™” ë ˆë²¨ â†’ ì—…ê·¸ë ˆì´ë“œ ë‹¨ê³„ ë§¤í•‘: enhance 0~5 â†’ step 0~5
function effStats(card) {
  // upgradeStatsê°€ ìˆìœ¼ë©´ ê°•í™” ë‹¨ê³„ì— ë§ëŠ” ìŠ¤íƒ¯ ì‚¬ìš©
  if (card.upgradeStats) {
    const step = Math.min(card.enhance, card.upgradeStats.length - 1);
    return {...card.upgradeStats[step]};
  }
  // ë ˆê±°ì‹œ(ì§ì ‘ ìƒì„± ì¹´ë“œ): êµ¬ ë°©ì‹ ë°°ìœ¨ ì ìš©
  const m = ENH_MULT[card.enhance]||1;
  const r={};
  for(const[k,v] of Object.entries(card.stats||{})) r[k]=Math.round(v*m);
  return r;
}

// ==========================================
// ì „ì²´ ë Œë”
// ==========================================
function renderAll() {
  renderInventory();
  renderCreatedList();
  renderSlots();
  renderEffectSummary();
}

// â”€â”€ ì•„ì´ì½˜ ê·¸ë¦¬ë“œ â”€â”€
function renderIconGrid() {
  document.getElementById('icon-grid').innerHTML = ICONS.map(ic =>
    `<div class="icon-btn${ic===selIconVal?' active':''}" onclick="selIcon('${ic}')">${ic}</div>`
  ).join('');
}

// â”€â”€ ì¸ë²¤í† ë¦¬ â”€â”€
function renderInventory() {
  const el = document.getElementById('inv-list');
  // ë„ê°ì´ ì•„ë‹Œ userInventoryë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.
  document.getElementById('inv-count').textContent = userInventory.length + 'ì¥';
  const eqIds = slots.filter(Boolean).map(c => c.id);
  
  let list = invFilterVal === 'all' ? userInventory : userInventory.filter(c => String(c.tier) === invFilterVal);
  
  if (!list.length) { 
    el.innerHTML = `<div class="empty"><div class="empty-ico">ğŸ´</div>ì¸ë²¤í† ë¦¬ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</div>`; 
    return; 
  }
  el.innerHTML = list.map(c => cardItemHTML(c, eqIds.includes(c.id), 'inv')).join('');
}

// ì „ì—­ ìƒíƒœ ë³€ìˆ˜ ì¶”ê°€
let masterFilterVal = 'all';

// [ì¶”ê°€] ë„ê° í•„í„°ë§ í•¨ìˆ˜
function filterMaster(f, el) {
  masterFilterVal = f;
  document.querySelectorAll('#master-filter .filter-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  renderCreatedList();
}

// â”€â”€ ìƒì„± ëª©ë¡ â”€â”€
function renderCreatedList() {
  const el = document.getElementById('created-list');
  const searchKeyword = document.getElementById('master-search')?.value.trim().toLowerCase() || "";
  const statFilter = document.getElementById('master-stat-filter')?.value || "";
  
  if (!cards.length) { 
    el.innerHTML = `<div class="empty">ë“±ë¡ëœ ë„ê°ì´ ì—†ìŠµë‹ˆë‹¤.</div>`; 
    return; 
  }

  // í•„í„°ë§ ë¡œì§: í‹°ì–´, ê²€ìƒ‰ì–´, ê°œë³„ ìŠ¤íƒ¯ ì²´í¬
  let filtered = cards.filter(c => {
    const matchTier = masterFilterVal === 'all' || String(c.tier) === masterFilterVal;
    const matchName = c.name.toLowerCase().includes(searchKeyword);
    const matchStat = !statFilter || (c.upgradeStats && c.upgradeStats[0][statFilter]);
    return matchTier && matchName && matchStat;
  });

  if (!filtered.length) {
    el.innerHTML = `<div class="empty">ì¡°ê±´ì— ë§ëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  el.innerHTML = filtered.map(c => {
    const displayName = searchKeyword 
      ? c.name.replace(new RegExp(`(${searchKeyword})`, 'gi'), `<span style="color:var(--gold); font-weight:bold;">$1</span>`)
      : c.name;

    // 0ê°•(Base) ìŠ¤íƒ¯ ì¹© ìƒì„±
    const baseStats = c.upgradeStats ? c.upgradeStats[0] : {};
    const statChips = Object.entries(baseStats).map(([k, v]) => {
      const d = STAT_MAP[k];
      return `<span style="display:inline-block; font-size:9px; background:rgba(255,255,255,0.05); padding:1px 5px; border-radius:3px; margin-right:4px; color:var(--text2); border: 1px solid var(--border);">
        ${d ? d.label : k} +${v}${d ? d.unit : ''}
      </span>`;
    }).join('');

    return `
      <div class="card-item ani" data-tier="${c.tier}" data-id="${c.id}" onclick="openCardTooltip('${c.id}')" style="align-items: flex-start;">
        <div class="card-icon" style="width:40px; height:40px; font-size:22px;">${c.icon}</div>
        <div class="card-info" style="flex:1; min-width:0; margin-left:12px;">
          <div style="display:flex; align-items:center; gap:5px; margin-bottom:4px;">
            <span class="card-tier-badge tb${c.tier}">T${c.tier}</span>
            <span class="card-name" style="font-size:13px;">${displayName}</span>
            <span style="font-size:9px; color:var(--gold); opacity:0.8; font-family:'Rajdhani',sans-serif;">[${c.cid}]</span>
          </div>
          
          <div style="display:flex; flex-wrap:wrap; gap:3px; margin-bottom:8px;">
            ${statChips}
          </div>

          <div style="margin-top:5px; display:flex; gap:5px;">
            <button class="btn-import" style="padding: 4px 10px; font-size: 10px;" onclick="event.stopPropagation(); obtainCard('${c.cid}')">â• ì¸ë²¤í† ë¦¬ íšë“</button>
            <button class="btn-danger" style="padding: 4px 10px; font-size: 10px;" onclick="event.stopPropagation(); deleteCard('${c.id}')">ë„ê° ì‚­ì œ</button>
          </div>
        </div>
      </div>`;
  }).join('');
}



// â”€â”€ ì¹´ë“œ HTML ë¹Œë” â”€â”€
function cardItemHTML(card, equipped, mode) {
  const eff = effStats(card);
  const statsHtml = Object.entries(eff).filter(([,v])=>v>0)
    .map(([k,v])=>{
      const def=STAT_MAP[k];
      const unit=def?def.unit:'';
      const label=def?def.label:k;
      return `<span class="stat-chip">+${v}${unit} ${label}</span>`;
    }).join('');
  const enhBadge = card.enhance>0
    ? `<span class="enh-badge lv${card.enhance}">+${card.enhance}ê°•</span>`
    : `<span class="enh-badge">0ê°•</span>`;

  // [ì¶”ê°€] ì¹´ë“œ ëª©ë¡(ìƒì„± íƒ­)ì—ì„œë§Œ CID ë…¸ì¶œ
  const cidBadge = (mode === 'created' || mode === 'inv') 
    ? `<span style="font-family:'Rajdhani',sans-serif; font-size:9px; color:var(--gold); font-weight:700; margin-left:4px; opacity:0.8;">[${card.cid}]</span>` 
    : '';

  // ìš°ì¸¡ ì•¡ì…˜
  let actionBtns = '';
  if (mode==='inv') {
    const eqBtn = equipped
      ? `<span style="font-size:9px;color:var(--green);font-family:'Rajdhani',sans-serif;font-weight:700;letter-spacing:.5px;">âœ“ì¥ì°©</span>`
      : `<button class="btn-sm" onclick="event.stopPropagation();quickEquip('${card.id}')">ì¥ì°©</button>`;
    actionBtns = `<div style="display:flex;gap:4px;align-items:center;margin-top:5px;">
      ${eqBtn}
      <button class="btn-enh" onclick="event.stopPropagation();openEnhOverlay('${card.id}')">ğŸ”¥ê°•í™”</button>
      <button class="btn-danger" onclick="event.stopPropagation();deleteCard('${card.id}')">ì‚­ì œ</button>
    </div>`;
  } else if (mode==='created') {
    actionBtns = `<div style="margin-top:5px;"><button class="btn-danger" onclick="deleteCard('${card.id}')">ì‚­ì œ</button></div>`;
  } else if (mode==='modal-slot') {
    actionBtns = `<div style="margin-top:5px;"><button class="btn-sm" onclick="equipFromModal('${card.id}')">ì„ íƒ</button></div>`;
  }

  const clickHandler = `onclick="openCardTooltip('${card.id}')"`;

  return `<div class="card-item${equipped?' equipped':''} ani" data-tier="${card.tier}" data-id="${card.id}"
    ${clickHandler} draggable="true" ondragstart="if(document.getElementById('enh-overlay').classList.contains('open')){event.preventDefault();return;}onDragStart(event,'${card.id}',null)">
    <div class="card-icon">${card.icon}</div>
    <div class="card-info" style="flex:1;min-width:0;">
      <div style="display:flex;align-items:center;gap:5px;flex-wrap:nowrap;overflow:hidden;">
        <span class="card-tier-badge tb${card.tier}" style="flex-shrink:0;">T${card.tier}</span>
        ${enhBadge}
        <span class="card-name" style="font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${card.name}</span>
        ${cidBadge} </div>
      <div class="card-stats-row">${statsHtml||'<span style="color:var(--text3)">ìŠ¤íƒ¯ ì—†ìŒ</span>'}</div>
      ${actionBtns}
    </div>
  </div>`;
}

// â”€â”€ ìŠ¬ë¡¯ â”€â”€
function renderSlots() {
  const el = document.getElementById('slots-grid');
  el.innerHTML = slots.map((card, i) => {
    if (!card) return `
      <div class="slot" id="slot-${i}"
        ondragover="onDragOverSlot(event,${i})" ondrop="onDropSlot(event,${i})" ondragleave="onDragLeaveSlot(${i})"
        onclick="openSlotModal(${i})">
        <div class="slot-num">SLOT ${i+1}</div>
        <div class="slot-empty-ico">â¬œ</div>
        <div class="slot-empty-txt">ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­</div>
      </div>`;
    const eff = effStats(card);
    const statLines = Object.entries(eff).filter(([,v])=>v>0).map(([k,v])=>{
      const def=STAT_MAP[k]; return `+${v}${def?def.unit:''} ${def?def.label:k}`;
    }).join('<br>');
    const ec = card.enhance>0 ? ECOLOR[card.enhance] : 'var(--text3)';
    return `
      <div class="slot filled" id="slot-${i}" data-tier="${card.tier}"
        ondragover="onDragOverSlot(event,${i})" ondrop="onDropSlot(event,${i})" ondragleave="onDragLeaveSlot(${i})"
        draggable="true" ondragstart="onDragStart(event,'${card.id}',${i})"
        onclick="openCardTooltip('${card.id}')">
        <div class="slot-num">SLOT ${i+1}</div>
        <div class="slot-remove" onclick="event.stopPropagation();unequipSlot(${i})">âœ•</div>
        <div class="slot-ico">${card.icon}</div>
        <div class="slot-name">${card.name}</div>
        <div class="slot-tier" style="color:${TCOLOR[card.tier]}">T${card.tier} Â· ${card.type}</div>
        ${card.enhance>0?`<div class="slot-enh" style="color:${ec}">+${card.enhance}ê°•</div>`:''}
        <div class="slot-stats">${statLines}</div>
        <button class="slot-enh-btn" onclick="event.stopPropagation();openEnhOverlay('${card.id}')">ğŸ”¥ ê°•í™”</button>
      </div>`;
  }).join('');
}

// â”€â”€ íš¨ê³¼ í•©ì‚° â”€â”€
function renderEffectSummary() {
  const el = document.getElementById('effect-summary');
  const equipped = slots.filter(Boolean);
  
  if (!equipped.length) {
    el.innerHTML = `<div class="empty" style="padding:16px;"><div class="empty-ico">ğŸ“Š</div>ì¹´ë“œë¥¼ ì¥ì°©í•˜ë©´ ì„¸íŠ¸ ê°€ì´ë“œê°€ í‘œì‹œë©ë‹ˆë‹¤</div>`;
    return;
  }

  // 1. í™œì„± ì„¸íŠ¸ì™€ ì¥ì°© íƒ€ì… ì •ë³´ë¥¼ ê°€ì ¸ì˜´ (ê°ì²´ ë¶„í•  ëŒ€ì…)
  const result = calcActiveSetEffects(equipped);
  const activeSets = result.active;
  const equippedTypes = result.equippedTypes;
  const activeIds = new Set(activeSets.map(s => s.id));

  // 2. ê°€ì´ë“œ ì„¸íŠ¸ ê³„ì‚° (ì´ë¯¸ ë°œë™ëœ ê±´ ì œì™¸, ì¥ì°© ì¹´ë“œ ì¤‘ 1ì¥ì´ë¼ë„ í¬í•¨ëœ ëª¨ë“  ì„¸íŠ¸)
  const potentialSets = setDefs.filter(def => {
    if (activeIds.has(def.id)) return false; 
    const matchCount = def.cardTypes.filter(t => equippedTypes.has(t)).length;
    return matchCount > 0;
  });

  let html = `<div class="set-area"><div class="set-area-title">ì ìš© ì¤‘ì¸ íš¨ê³¼</div>`;

  // 3. ê°œë³„ ìŠ¤íƒ¯ í•©ì‚° ë Œë”ë§ (ì¹´ë“œ ìì²´ ìŠ¤íƒ¯)
  const individualStats = {};
  equipped.forEach(c => {
    const e = effStats(c);
    Object.entries(e).forEach(([k, v]) => { individualStats[k] = (individualStats[k] || 0) + v; });
  });

  html += `<div class="eff-row ind">
    <span class="eff-badge" style="background:rgba(255,255,255,.06);color:var(--text3);">ê°œë³„</span>
    <div>
      <div class="eff-label">ê°œë³„ ìŠ¤íƒ¯ í•©ì‚°</div>
      <div class="eff-stats">${Object.entries(individualStats).filter(([,v])=>v>0).map(([k,v])=>{
        const def=STAT_MAP[k]; return `<span class="eff-stat-chip">+${v}${def?def.unit:''} ${def?def.label:k}</span>`;
      }).join('')}</div>
    </div>
  </div>`;

  // 4. í˜„ì¬ ì ìš© ì¤‘ì¸ ì„¸íŠ¸ íš¨ê³¼ ë Œë”ë§
  if (activeSets.length > 0) {
    activeSets.forEach(def => {
      const gc = GRADE_COLOR[def.grade] || 'var(--text3)';
      const gl = GRADE_LABEL[def.grade] || def.grade;
      const effChips = Object.entries(def.effect || {}).filter(([,v])=>v>0).map(([k,v])=>{
        const d=STAT_MAP[k]; return `<span class="eff-stat-chip" style="background:rgba(232,184,75,.08);border-color:rgba(232,184,75,.2);color:var(--gold2);">+${v}${d?d.unit:''} ${d?d.label:k}</span>`;
      }).join('');

      html += `
        <div class="active-set-row grade-${def.grade}">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
            <span style="font-size:11px; font-weight:700; color:var(--gold);">${def.name}</span>
            <span class="set-def-grade" style="background:${gc}20;color:${gc};font-size:9px;padding:1px 6px;border-radius:3px;">âš¡ ${gl}</span>
          </div>
          <div class="active-set-desc" style="font-size:10px; color:var(--text2); margin-bottom:4px;">${def.desc || ''}</div>
          <div class="active-set-bonus">${effChips}</div>
        </div>`;
    });
  } else {
    html += `<div style="font-size:10px; color:var(--text3); padding:8px 4px;">â¬¥ ë°œë™ ì¤‘ì¸ ì„¸íŠ¸ íš¨ê³¼ ì—†ìŒ</div>`;
  }

  // 5. ì„¸íŠ¸ ì¡°í•© ê°€ì´ë“œ (ì¥ì°©í•œ ì¹´ë“œê°€ í¬í•¨ëœ ëª¨ë“  ì¡±ë³´)
  if (potentialSets.length > 0) {
    html += `<div class="divider"><div class="divider-txt" style="font-size:8px;">ì„¸íŠ¸ ì¡°í•© ê°€ì´ë“œ</div></div>`;
    potentialSets.forEach(def => {
      const gl = GRADE_LABEL[def.grade] || def.grade;
      const matchCount = def.cardTypes.filter(t => equippedTypes.has(t)).length;
      
      // [ê°œì„ ] ì¹´ë“œ ëª©ë¡ ìƒì„±: ì¥ì°© ì—¬ë¶€ì— ë”°ë¼ ìŠ¤íƒ€ì¼ ë¶„ê¸°
      const cardListHtml = def.cardTypes.map(type => {
        const isEquipped = equippedTypes.has(type);
        if (isEquipped) {
          // ì¥ì°©ëœ ì¹´ë“œëŠ” ë…¸ë€ìƒ‰ ê°•ì¡°
          return `<span style="color:var(--gold); font-weight:bold;">${type}</span>`;
        } else {
          // ì¥ì°©ë˜ì§€ ì•Šì€ ì¹´ë“œëŠ” íšŒìƒ‰ ë¹„í™œì„±í™” ëŠë‚Œ
          return `<span style="color:var(--text3); opacity:0.5;">${type}</span>`;
        }
      }).join('<span style="color:var(--border2); margin:0 3px;">/</span>'); // êµ¬ë¶„ì„  ì¶”ê°€

      html += `
        <div class="potential-set-row" style="border-style: solid; border-color: rgba(255,255,255,0.05);">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
            <span style="font-size:11px; font-weight:700; color:var(--text2);">${def.name}</span>
            <span class="potential-badge" style="background:rgba(255,255,255,0.03);">${gl} (${matchCount}/${def.size})</span>
          </div>
          <div style="font-size:10px; line-height:1.5; padding:4px 0;">
            ${cardListHtml}
          </div>
        </div>`;
    });
  }

  // 6. ì „ì²´ í•©ì‚° ìŠ¤íƒ¯ (ê°œë³„ + ì„¸íŠ¸ ë³´ë„ˆìŠ¤)
  const setBonusStats = {};
  activeSets.forEach(def => {
    Object.entries(def.effect || {}).forEach(([k, v]) => { setBonusStats[k] = (setBonusStats[k] || 0) + v; });
  });

  const combinedStats = {};
  const allKeys = new Set([...Object.keys(individualStats), ...Object.keys(setBonusStats)]);
  allKeys.forEach(k => { combinedStats[k] = (individualStats[k] || 0) + (setBonusStats[k] || 0); });

  const totalEntries = Object.entries(combinedStats).filter(([,v])=>v>0);
  if (totalEntries.length > 0) {
    html += `<div class="total-stats"><div class="total-stats-title">í•©ì‚° ìŠ¤íƒ¯</div><div class="total-grid">`;
    totalEntries.forEach(([k, v]) => {
      const d = STAT_MAP[k];
      const hasBonus = (setBonusStats[k] || 0) > 0;
      html += `
        <div class="total-item">
          <div class="total-name">${d ? d.label : k}</div>
          <div class="total-val" style="color:${hasBonus?'var(--gold2)':'var(--green)'};">
            +${v}${d ? d.unit : ''}
            ${hasBonus ? `<span style="font-size:8px;color:var(--gold);margin-left:2px;">(ì„¸íŠ¸+${setBonusStats[k]})</span>` : ''}
          </div>
        </div>`;
    });
    html += `</div></div>`;
  }

  html += `</div>`;
  el.innerHTML = html;
}

// â”€â”€ Config í…Œì´ë¸” â”€â”€
function renderConfigTable() {
  document.getElementById('config-tbody').innerHTML = enhConfig.map((cfg,i) => {
    const succProb = 100-cfg.fail;
    const destroyEff = cfg.fail>0 ? cfg.destroy : 0;
    return `<tr>
      <td><span class="config-lv-label" style="color:${ECOLOR[i+1]}">${i}ê°• â†’ +${i+1}ê°•</span></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="${cfg.fail}"
          oninput="updateCfg(${i},'fail',this.value);updateProbBar('fbar${i}',${cfg.fail},this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="fbar${i}" style="width:${cfg.fail}%;background:var(--red);"></div></div></td>
      <td>
        <input class="config-input" type="number" min="0" max="100" value="${cfg.destroy}"
          oninput="updateCfg(${i},'destroy',this.value);updateProbBar('dbar${i}',${cfg.destroy},this.value)">
      </td>
      <td><div class="prob-bar-wrap"><div class="prob-bar" id="dbar${i}" style="width:${cfg.destroy}%;background:#ff3030;"></div></div></td>
    </tr>`;
  }).join('');
}

function updateCfg(idx, key, val) {
  enhConfig[idx][key] = Math.min(100, Math.max(0, parseInt(val)||0));
  if (enhTargetId) renderEnhOverlayContent();
}
function updateProbBar(id, oldVal, newVal) {
  const el = document.getElementById(id);
  if (el) el.style.width = Math.min(100, Math.max(0, parseInt(newVal)||0))+'%';
}

// ==========================================
// ê°•í™” ì˜¤ë²„ë ˆì´
// ==========================================
function openEnhOverlay(cardId) {
  // ë„ê°ì´ ì•„ë‹Œ ì¸ë²¤í† ë¦¬ì—ì„œ ì°¾ìŠµë‹ˆë‹¤.
  const card = userInventory.find(c => c.id === cardId);
  if (!card) return;
  enhTargetId = cardId;
  renderEnhOverlayContent();
  document.getElementById('enh-overlay').classList.add('open');
}

function renderEnhOverlayContent() {
  const card = cards.find(c=>c.id===enhTargetId);
  if (!card) return;

  const curLv = card.enhance;
  const isMax = curLv >= 5;
  const tc = TCOLOR[card.tier];

  // â”€â”€ í—¤ë” â”€â”€
  const pips = [1,2,3,4,5].map(i=>
    `<div class="lv-pip${i<=curLv?' filled p'+i:''}"></div>`
  ).join('');
  const lvLabel = isMax
    ? `<span style="color:var(--t7);font-family:'Rajdhani',sans-serif;font-size:12px;font-weight:700;">â­ MAX</span>`
    : `<span class="lv-label">${curLv}ê°• â†’ <span style="color:${ECOLOR[curLv+1]||'var(--text1)'}">+${curLv+1}ê°•</span></span>`;

  document.getElementById('enh-header').innerHTML = `
    <div class="enh-card-big-icon"
      style="border-color:${tc};background:${TIER_BG[card.tier]||'rgba(255,255,255,.03)'}">
      ${card.icon}
    </div>
    <div class="enh-card-header-info">
      <div class="enh-card-header-name">${card.name}</div>
      <div class="enh-card-header-sub" style="color:${tc}">T${card.tier} &nbsp;Â·&nbsp; ${card.type}</div>
      <div class="lv-bar">${pips}&nbsp;&nbsp;${lvLabel}</div>
    </div>`;

  // â”€â”€ í™•ë¥  â”€â”€
  const probSection = document.getElementById('enh-prob-section');
  const probGrid = document.getElementById('enh-prob-grid');
  if (isMax) {
    probSection.style.display = 'none';
  } else {
    probSection.style.display = 'block';
    const cfg = enhConfig[curLv];
    const succ = 100 - cfg.fail;
    const dest = cfg.fail > 0 ? cfg.destroy : 0;
    probGrid.innerHTML = `
      <div class="prob-card">
        <div class="prob-card-label">ì„±ê³µ</div>
        <div class="prob-card-val succ">${succ}%</div>
      </div>
      <div class="prob-card">
        <div class="prob-card-label">ì‹¤íŒ¨</div>
        <div class="prob-card-val fail">${cfg.fail}%</div>
      </div>
      <div class="prob-card">
        <div class="prob-card-label">íŒŒê´´<span style="font-size:8px;font-family:'Rajdhani',sans-serif;color:var(--text3);margin-left:2px;">(ì‹¤íŒ¨ì‹œ)</span></div>
        <div class="prob-card-val dest">${dest}%</div>
      </div>`;
  }

  // â”€â”€ ìŠ¤íƒ¯ ë¹„êµ â”€â”€
  const statSection = document.getElementById('enh-stat-section');
  const statCompare = document.getElementById('enh-stat-compare');
  if (isMax) {
    statSection.style.display = 'none';
  } else {
    statSection.style.display = 'block';
    const curStats = effStats(card);
    // ë‹¤ìŒ ë‹¨ê³„ ìŠ¤íƒ¯ ê³„ì‚°
    let nextStats;
    if (card.upgradeStats) {
      const nextStep = Math.min(curLv+1, card.upgradeStats.length-1);
      nextStats = {...card.upgradeStats[nextStep]};
    } else {
      const nextMult = ENH_MULT[curLv+1];
      nextStats = {};
      for(const[k,v] of Object.entries(card.stats||{})) nextStats[k]=Math.round(v*nextMult);
    }
    const allKeys = new Set([...Object.keys(curStats), ...Object.keys(nextStats)]);
    const statRows = [...allKeys].filter(k=>(nextStats[k]||0)>0 || (curStats[k]||0)>0).map(k=>{
        const cur = curStats[k]||0;
        const next = nextStats[k]||0;
        const diff = next - cur;
        const def = STAT_MAP[k];
        const unit = def?def.unit:'';
        const label = def?def.label:k;
        const ec = ECOLOR[curLv+1]||'var(--green)';
        return `<div class="stat-compare-row">
          <div class="stat-cmp-name">${label}</div>
          <div class="stat-cmp-before">${cur}${unit}</div>
          <div class="stat-cmp-arrow">â†’</div>
          <div class="stat-cmp-after up" style="color:${ec}">
            ${next}${unit}
            ${diff!==0?`<span class="stat-cmp-diff">(${diff>0?'+':''}${diff}${unit})</span>`:''}
          </div>
        </div>`;
      }).join('');
    statCompare.innerHTML = statRows || `<div style="font-size:10px;color:var(--text3);text-align:center;padding:8px;">ìŠ¤íƒ¯ ì—†ìŒ</div>`;
  }

  // â”€â”€ ë²„íŠ¼ â”€â”€
  const btn = document.getElementById('enh-do-btn');
  const note = document.getElementById('enh-action-note');
  if (isMax) {
    btn.className = 'btn-enhance max';
    btn.textContent = 'â­ ìµœëŒ€ ê°•í™” ì™„ë£Œ';
    btn.disabled = true;
    note.textContent = 'ì´ ì¹´ë“œëŠ” ì´ë¯¸ ìµœëŒ€ ê°•í™” ìƒíƒœì…ë‹ˆë‹¤.';
  } else {
    const cfg = enhConfig[curLv];
    btn.className = 'btn-enhance';
    btn.textContent = `ğŸ”¥ +${curLv+1}ê°• ê°•í™” ì‹œë„`;
    btn.disabled = false;
    note.innerHTML = cfg.destroy > 0 && cfg.fail > 0
      ? `ì‹¤íŒ¨ ì‹œ <span style="color:var(--red)">${cfg.destroy}%</span> í™•ë¥ ë¡œ ì¹´ë“œê°€ íŒŒê´´ë©ë‹ˆë‹¤`
      : cfg.fail > 0
        ? `ì‹¤íŒ¨ ì‹œ ê°•í™” ìˆ˜ì¹˜ê°€ ìœ ì§€ë©ë‹ˆë‹¤`
        : `ì´ ë‹¨ê³„ëŠ” ê°•í™”ê°€ ë°˜ë“œì‹œ ì„±ê³µí•©ë‹ˆë‹¤`;
  }
}

function closeEnhOverlay() {
  document.getElementById('enh-overlay').classList.remove('open');
  enhTargetId = null;
}

document.getElementById('enh-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeEnhOverlay();
});

// ==========================================
// ê°•í™” ì‹¤í–‰
// ==========================================
function doEnhance() {
  const card = userInventory.find(c=>c.id===enhTargetId);
  if (!card || card.enhance>=5) return;

  const curLv = card.enhance;
  const cfg = enhConfig[curLv];
  const roll = Math.random()*100;

  if (roll >= cfg.fail) {
    // ì„±ê³µ
    card.enhance = curLv+1;
    // ìŠ¬ë¡¯ì—ë„ ë°˜ì˜
    slots = slots.map(s => s && s.id===card.id ? {...card} : s);
    addLog('ok', `"${card.name}" +${curLv} â†’ +${card.enhance}ê°• ì„±ê³µ`);
    renderAll();
    renderEnhOverlayContent();
    showResultPopup('suc', card, curLv);
  } else {
    // ì‹¤íŒ¨
    const destroyRoll = Math.random()*100;
    if (cfg.destroy>0 && destroyRoll < cfg.destroy) {
      // íŒŒê´´
      const snap = {...card};
      addLog('dest', `"${card.name}" +${curLv+1}ê°• ì‹¤íŒ¨ â†’ íŒŒê´´`);
      cards = cards.filter(c=>c.id!==enhTargetId);
      slots = slots.map(s => s&&s.id===enhTargetId ? null : s);
      enhTargetId = null;
      renderAll();
      closeEnhOverlay();
      showResultPopup('dest', snap, curLv);
    } else {
      // ì‹¤íŒ¨ (ìœ ì§€)
      addLog('fail', `"${card.name}" +${curLv+1}ê°• ì‹¤íŒ¨ (${curLv}ê°• ìœ ì§€)`);
      renderAll();
      renderEnhOverlayContent();
      showResultPopup('fail', card, curLv);
    }
  }
}

function addLog(type, txt) {
  const log = document.getElementById('enh-log');
  const noMsg = log.querySelector(':not(.log-row)');
  if (noMsg) noMsg.remove();
  const now = new Date();
  const t = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
  const row = document.createElement('div');
  row.className = 'log-row';
  row.innerHTML = `<span class="log-time">${t}</span><span class="log-txt ${type}">${txt}</span>`;
  log.insertBefore(row, log.firstChild);
}

function showResultPopup(type, card, fromLv) {
  const overlay = document.getElementById('result-overlay');
  const box = document.getElementById('result-box');
  const sparks = document.getElementById('result-sparks');
  sparks.innerHTML='';

  const ico = document.getElementById('result-ico');
  const title = document.getElementById('result-title');
  const desc = document.getElementById('result-desc');

  if (type==='suc') {
    box.className='result-box suc';
    ico.textContent = card.icon;
    title.className='result-title s'; title.textContent='ê°•í™” ì„±ê³µ!';
    desc.innerHTML=`<strong style="color:var(--text1)">${card.name}</strong><br>+${fromLv}ê°• â†’ <strong style="color:${ECOLOR[card.enhance]||'var(--green)'}">+${card.enhance}ê°•</strong> ë‹¬ì„±!`;
    // ì„±ê³µ íŒŒí‹°í´
    for(let i=0;i<24;i++){
      const s=document.createElement('div'); s.className='spark';
      const tx=(Math.random()-.5)*300, ty=(Math.random()-.5)*250;
      s.style.cssText=`left:50%;top:50%;background:${['#34d399','#fbbf24','#60a5fa','#a78bfa'][i%4]};--tx:${tx}px;--ty:${ty}px;animation-delay:${i*.03}s;width:${3+Math.random()*4}px;height:${3+Math.random()*4}px;`;
      sparks.appendChild(s);
    }
  } else if (type==='fail') {
    box.className='result-box fail';
    ico.textContent='ğŸ’«';
    title.className='result-title f'; title.textContent='ê°•í™” ì‹¤íŒ¨';
    desc.innerHTML=`<strong style="color:var(--text1)">${card.name}</strong><br>+${fromLv+1}ê°• ê°•í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br><span style="font-size:11px;color:var(--text3)">ê°•í™” ìˆ˜ì¹˜ëŠ” <strong>+${fromLv}ê°•</strong>ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.</span>`;
  } else {
    box.className='result-box dest';
    ico.textContent='ğŸ’¥';
    title.className='result-title d'; title.textContent='ì¹´ë“œ íŒŒê´´!';
    desc.innerHTML=`<strong style="color:var(--text1)">${card.name}</strong><br>ê°•í™” ì‹¤íŒ¨ì™€ í•¨ê»˜ ì¹´ë“œê°€ ì†Œë©¸í–ˆìŠµë‹ˆë‹¤.`;
    for(let i=0;i<20;i++){
      const s=document.createElement('div'); s.className='spark';
      const tx=(Math.random()-.5)*300, ty=(Math.random()-.5)*250;
      s.style.cssText=`left:50%;top:50%;background:#f87171;--tx:${tx}px;--ty:${ty}px;animation-delay:${i*.04}s;width:5px;height:5px;`;
      sparks.appendChild(s);
    }
  }
  overlay.classList.add('show');
}

function closeResult() {
  document.getElementById('result-overlay').classList.remove('show');
}

// ==========================================
// ë“œë˜ê·¸ ì•¤ ë“œë¡­
// ==========================================
function onDragStart(e, cardId, fromSlot) {
  dragCardId = cardId; dragFromSlot = fromSlot;
  e.dataTransfer.effectAllowed='move';
  setTimeout(()=>{
    const el=document.querySelector(`.card-item[data-id="${cardId}"]`);
    if(el) el.classList.add('dragging');
  },0);
}
function onDragOverSlot(e, i) {
  e.preventDefault(); e.dataTransfer.dropEffect='move';
  document.getElementById('slot-'+i)?.classList.add('drag-over');
}
function onDragLeaveSlot(i) {
  document.getElementById('slot-'+i)?.classList.remove('drag-over');
}
function onDropSlot(e, i) {
  e.preventDefault();
  document.getElementById('slot-'+i)?.classList.remove('drag-over');
  if (!dragCardId) return;
  const card = userInventory.find(c=>c.id===dragCardId);
  if (!card) return;

  const dupType = slots.some((s,si)=>s&&s.type===card.type&&s.id!==dragCardId&&si!==i);
  if (dupType) { showToast(`ë™ì¼ ì¢…ë¥˜(${card.type}) ì´ë¯¸ ì¥ì°© ì¤‘`,'err'); clearDrag(); return; }

  const existIdx = slots.findIndex(s=>s&&s.id===dragCardId);
  const targetCard = slots[i];
  if (existIdx!==-1 && existIdx!==i) {
    slots[i]=card; slots[existIdx]=targetCard;
  } else {
    slots[i]=card;
  }
  clearDrag(); renderAll();
  showToast(`ìŠ¬ë¡¯ ${i+1}ì— "${card.name}" ì¥ì°©!`,'ok');
}
function onDropToList(e) {
  e.preventDefault();
  if (dragFromSlot!==null) { slots[dragFromSlot]=null; clearDrag(); renderAll(); showToast('ìŠ¬ë¡¯ í•´ì œ',''); }
}
function clearDrag() {
  document.querySelectorAll('.card-item.dragging').forEach(el=>el.classList.remove('dragging'));
  dragCardId=null; dragFromSlot=null;
}

// ==========================================
// ìŠ¬ë¡¯ ëª¨ë‹¬ (í´ë¦­ ì¥ì°©)
// ==========================================
function openSlotModal(i) {
  activeModalSlot = i;
  const eqTypes = slots.filter((c,si)=>c&&si!==i).map(c=>c.type);
  const eqIds = slots.filter((c,si)=>c&&si!==i).map(c=>c.id);
  const avail = userInventory.filter(c=>!eqTypes.includes(c.type)&&!eqIds.includes(c.id));
  document.getElementById('modal-title').textContent = `ìŠ¬ë¡¯ ${i+1} â€” ì¹´ë“œ ì„ íƒ`;
  document.getElementById('modal-card-list').innerHTML = avail.length
    ? avail.map(c=>cardItemHTML(c,false,'modal-slot')).join('')
    : `<div class="empty"><div class="empty-ico">ğŸ´</div>ì¥ì°© ê°€ëŠ¥í•œ ì¹´ë“œ ì—†ìŒ</div>`;
  document.getElementById('card-modal').classList.add('open');
}
function equipFromModal(cardId) {
  if (activeModalSlot===null) return;
  const card = userInventory.find(c=>c.id===cardId);
  if (card) { slots[activeModalSlot]=card; renderAll(); showToast(`ìŠ¬ë¡¯ ${activeModalSlot+1} ì¥ì°©!`,'ok'); }
  closeModal();
}

// [ì¶”ê°€] ì¸ë²¤í† ë¦¬ì—ì„œ ì§ì ‘ ì¹´ë“œë¥¼ íšë“í•˜ê¸° ìœ„í•œ ëª¨ë‹¬ ì˜¤í”ˆ
function openObtainModal() {
  if (!cards.length) return showToast('ë“±ë¡ëœ ë„ê°ì´ ì—†ìŠµë‹ˆë‹¤.', 'err');
  activeModalSlot = null;
  
  document.getElementById('modal-title').textContent = `ë„ê°ì—ì„œ ì¹´ë“œ íšë“`;
  
  const modalBody = document.querySelector('.modal-body');
  modalBody.innerHTML = `
    <div style="margin-bottom:12px; position:sticky; top:0; z-index:10; background:var(--bg1); padding-bottom:8px; display:flex; flex-direction:column; gap:5px;">
      <input type="text" id="modal-search" class="form-input" placeholder="íšë“í•  ì¹´ë“œ ê²€ìƒ‰..." oninput="updateObtainModalList()">
      <div style="display:flex; gap:5px;">
        <select id="modal-tier-filter" class="form-input" style="flex:1; font-size:11px;" onchange="updateObtainModalList()">
          <option value="all">ëª¨ë“  í‹°ì–´</option>
          ${[1,2,3,4,5,6,7].map(t => `<option value="${t}">Tier ${t}</option>`).join('')}
        </select>
        <select id="modal-stat-filter" class="form-input" style="flex:1; font-size:11px;" onchange="updateObtainModalList()">
          <option value="">ëª¨ë“  ìŠ¤íƒ¯</option>
          ${STAT_DEFS.map(s => `<option value="${s.key}">${s.label}</option>`).join('')}
        </select>
      </div>
    </div>
    <div class="card-list" id="modal-card-list"></div>
  `;
  
  updateObtainModalList();
  document.getElementById('card-modal').classList.add('open');
}

// [ì¶”ê°€] ëª¨ë‹¬ì—ì„œ ì¹´ë“œë¥¼ í´ë¦­í–ˆì„ ë•Œ ì‹¤ì œ ì¸ë²¤í† ë¦¬ë¡œ ë³µì‚¬
function obtainFromModal(cid) {
  obtainCard(cid); // ê¸°ì¡´ì— ë§Œë“  íšë“ ë¡œì§ ì¬ì‚¬ìš©
  // ëª¨ë‹¬ì„ ë‹«ì§€ ì•Šê³  ê³„ì† íšë“í•  ìˆ˜ ìˆê²Œ ë‘ê±°ë‚˜, ì›í•˜ì‹œë©´ closeModal()ì„ ì¶”ê°€í•˜ì„¸ìš”.
  // closeModal(); 
}

// [ì¶”ê°€] ëª¨ë‹¬ ë‚´ ì‹¤ì‹œê°„ ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ê°±ì‹ 
function updateObtainModalList() {
  const searchKeyword = document.getElementById('modal-search').value.trim().toLowerCase();
  const tierFilter = document.getElementById('modal-tier-filter').value;
  const statFilter = document.getElementById('modal-stat-filter').value;
  const el = document.getElementById('modal-card-list');

  let filtered = cards.filter(c => {
    const matchName = c.name.toLowerCase().includes(searchKeyword);
    const matchTier = tierFilter === 'all' || String(c.tier) === tierFilter;
    const matchStat = !statFilter || (c.upgradeStats && c.upgradeStats[0][statFilter]);
    return matchName && matchTier && matchStat;
  });

  if (!filtered.length) {
    el.innerHTML = `<div class="empty">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  el.innerHTML = filtered.map(c => {
    const displayName = searchKeyword 
      ? c.name.replace(new RegExp(`(${searchKeyword})`, 'gi'), `<span style="color:var(--gold); font-weight:bold;">$1</span>`)
      : c.name;

    // [ì¶”ê°€] 0ê°• ê¸°ì¤€ ìŠ¤íƒ¯ ì¹© ìƒì„± ë¡œì§
    const baseStats = c.upgradeStats ? c.upgradeStats[0] : {};
    const statChips = Object.entries(baseStats).map(([k, v]) => {
      const d = STAT_MAP[k];
      return `<span style="display:inline-block; font-size:9px; background:rgba(255,255,255,0.05); padding:1px 4px; border-radius:3px; margin-right:3px; color:var(--text3);">
        ${d ? d.label : k} +${v}${d ? d.unit : ''}
      </span>`;
    }).join('');

    return `
      <div class="card-item ani" data-tier="${c.tier}" onclick="obtainFromModal('${c.cid}')" style="align-items: flex-start; padding: 10px;">
        <div class="card-icon" style="width:32px; height:32px; font-size:18px;">${c.icon}</div>
        <div class="card-info" style="flex:1; min-width:0; margin-left:10px;">
          <div style="display:flex; align-items:center; gap:5px; margin-bottom:4px;">
            <span class="card-tier-badge tb${c.tier}">T${c.tier}</span>
            <span class="card-name" style="font-size:12px;">${displayName}</span>
          </div>
          <div style="display:flex; flex-wrap:wrap; gap:2px;">
            ${statChips}
          </div>
          <div style="font-size:8px; color:var(--gold); margin-top:6px; opacity:0.7;">ë‹¨ í´ë¦­ ì‹œ ì¸ë²¤í† ë¦¬ì— ì¦‰ì‹œ ì¶”ê°€</div>
        </div>
      </div>`;
  }).join('');
}

function quickEquip(cardId) {
  const card = userInventory.find(c=>c.id===cardId);
  if (!card) return;
  if (slots.some(s=>s&&s.type===card.type&&s.id!==cardId)) return showToast(`ë™ì¼ ì¢…ë¥˜(${card.type}) ì´ë¯¸ ì¥ì°©`,'err');
  if (slots.some(s=>s&&s.id===cardId)) return showToast('ì´ë¯¸ ì¥ì°©ë¨','err');
  const empty = slots.indexOf(null);
  if (empty===-1) return showToast('ìŠ¬ë¡¯ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤','err');
  slots[empty]=card; renderAll();
  showToast(`ìŠ¬ë¡¯ ${empty+1}ì— "${card.name}" ì¥ì°©!`,'ok');
}
function unequipSlot(i) {
  const c=slots[i]; slots[i]=null;
  if(c) showToast(`"${c.name}" í•´ì œ`,'');
  renderAll();
}
function closeModal() { document.getElementById('card-modal').classList.remove('open'); }
document.getElementById('card-modal').addEventListener('click',e=>{
  if(e.target===document.getElementById('card-modal')) closeModal();
});

// ==========================================
// ì„¸íŠ¸ íš¨ê³¼ ê³„ì‚° (ìƒˆ ë°©ì‹)
// ==========================================
function calcActiveSetEffects(equipped) {
  if (!equipped.length) return { active: [], equippedTypes: new Set() };
  
  // ì¥ì°©ëœ ì¹´ë“œì˜ type(ì´ë¦„)ë“¤ë§Œ ëª¨ì€ Set ìƒì„±
  const equippedTypes = new Set(equipped.map(c => c.type));
  const active = [];
  
  // ëª¨ë“  ì„¸íŠ¸ ë„ê°ì„ ëŒë©°, êµ¬ì„±í’ˆì´ ëª¨ë‘ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
  setDefs.forEach(def => {
    const allPresent = def.cardTypes.every(t => equippedTypes.has(t));
    if (allPresent) active.push(def);
  });
  
  // í™œì„±í™”ëœ ì„¸íŠ¸ì™€ ë¶„ì„ëœ íƒ€ì… ì •ë³´ë¥¼ í•¨ê»˜ ë°˜í™˜
  return { active, equippedTypes };
}
// ìµœìƒìœ„ í™œì„± ì„¸íŠ¸ ë“±ê¸‰ ê³„ì‚° (í‘œì‹œìš©)
function topSetGrade(activeSets) {
  if (activeSets.some(s=>s.grade==='straight')) return 'straight';
  if (activeSets.some(s=>s.grade==='triple'))   return 'triple';
  if (activeSets.length >= 2)                   return 'twopair';
  if (activeSets.some(s=>s.grade==='pair'))      return 'pair';
  return 'none';
}

// ==========================================
// ì„¸íŠ¸ ì¡°í•© íƒ­ ë Œë”ë§
// ==========================================
const GRADE_LABEL  = {pair:'í˜ì–´',triple:'íŠ¸ë¦¬í”Œ',straight:'ìŠ¤íŠ¸ë ˆì´íŠ¸'};
const GRADE_COLOR  = {pair:'var(--pair-c)',triple:'var(--triple-c)',straight:'var(--straight-c)'};
const GRADE_SIZE   = {pair:2,triple:3,straight:5};

let sfPendingStats = {}; // ì„¸íŠ¸ í¼ ì„ì‹œ ìŠ¤íƒ¯

function renderSetDefsTab() {
  renderSetDefsList();
  renderSetFormCardPicker();
}

function renderSetDefsList() {
  const el = document.getElementById('set-defs-list');
  const searchKeyword = document.getElementById('set-search').value.trim().toLowerCase();
  if (!el) return;

  const equipped = slots.filter(Boolean);
  const activeSets = calcActiveSetEffects(equipped);
  const activeIds = new Set(activeSets.map(s => s.id));

  // 1. í•„í„°ë§ ë¡œì§
  let filtered = setDefs.filter(def => {
    // ë“±ê¸‰ í•„í„°
    if (setFilterGrade !== 'all' && def.grade !== setFilterGrade) return false;
    // ìŠ¤íƒ¯ í•„í„°
    if (setFilterStat && !def.effect[setFilterStat]) return false;
    // ê²€ìƒ‰ì–´ í•„í„° (ì´ë¦„ ë˜ëŠ” êµ¬ì„± ì¹´ë“œ í¬í•¨ ì—¬ë¶€)
    if (searchKeyword) {
      const nameMatch = def.name.toLowerCase().includes(searchKeyword);
      const cardMatch = def.cardTypes.some(ct => ct.toLowerCase().includes(searchKeyword));
      if (!nameMatch && !cardMatch) return false;
    }
    return true;
  });

  if (!filtered.length) {
    el.innerHTML = `<div class="empty"><div class="empty-ico">ğŸ”</div>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }

  // ê²€ìƒ‰ì–´ ê°•ì¡° í•¨ìˆ˜
  const highlight = (text) => {
    if (!searchKeyword) return text;
    const regex = new RegExp(`(${searchKeyword})`, 'gi');
    return text.replace(regex, `<span style="color:var(--gold); font-weight:bold;">$1</span>`);
  };

  // 2. ë Œë”ë§
  el.innerHTML = filtered.map(def => {
    const gc = GRADE_COLOR[def.grade] || 'var(--text3)';
    const gl = GRADE_LABEL[def.grade] || def.grade;
    const isActive = activeIds.has(def.id);

    const effChips = Object.entries(def.effect || {}).filter(([, v]) => v > 0).map(([k, v]) => {
      const d = STAT_MAP[k];
      return `<span class="set-def-efx-chip">+${v}${d ? d.unit : ''} ${d ? d.label : k}</span>`;
    }).join('');

    const memberChips = def.cardTypes.map(typeName => {
      const cardInfo = cards.find(c => c.type === typeName || c.name === typeName);
      const tier = cardInfo ? cardInfo.tier : 1;
      return `
        <span class="set-def-chip">
          <span class="card-tier-badge tb${tier}" style="font-size:8px; padding:0 3px; margin-right:3px; vertical-align:middle;">T${tier}</span>
          ${highlight(typeName)}
        </span>`;
    }).join('');

    return `
      <div class="set-def-card grade-${def.grade}${isActive ? ' set-def-active' : ''} ani">
        ${isActive ? `<div class="set-def-active-badge">âš¡ ë°œë™ ì¤‘</div>` : ''}
        <div class="set-def-name">${highlight(def.name)}</div>
        <div class="set-def-grade" style="background:${gc}20;color:${gc};">${gl} Â· ${def.size}ì¥</div>
        <div class="set-def-members">${memberChips}</div>
        ${def.desc ? `<div class="set-def-desc">${def.desc}</div>` : ''}
        <div class="set-def-effect">${effChips}</div>
        <div class="set-def-actions">
          <button class="btn-sm" onclick="editSetDef('${def.id}')">í¸ì§‘</button>
          <button class="btn-danger" onclick="deleteSetDef('${def.id}')">ì‚­ì œ</button>
        </div>
      </div>`;
  }).join('');
}

function renderSetFormCardPicker() {
  const el = document.getElementById('sf-card-picker');
  if (!el) return;
  
  const grade = document.querySelector('input[name="sf-grade"]:checked')?.value || 'pair';
  const editId = document.getElementById('sf-edit-id')?.value || '';
  const targetSize = GRADE_SIZE[grade];
  
  // 1. ì¸ë²¤í† ë¦¬ ì¹´ë“œ ëª©ë¡ì„ ì •ë ¬ ì¡°ê±´ì— ë§ì¶° ì •ë ¬
  // ì¤‘ë³µë˜ì§€ ì•Šì€ 'Type'ì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ì§€ë§Œ, ì •ë ¬ì„ ìœ„í•´ ì¹´ë“œ ê°ì²´ ì›ë³¸ì„ í™œìš©í•©ë‹ˆë‹¤.
  const uniqueCards = [];
  const typeSet = new Set();
  
  // í˜„ì¬ ì¸ë²¤í† ë¦¬ì˜ ëª¨ë“  ì¹´ë“œë¥¼ í™•ì¸í•˜ì—¬ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ì¢…ë¥˜ë§Œ ì¶”ì¶œ
  cards.forEach(c => {
    if (!typeSet.has(c.type)) {
      typeSet.add(c.type);
      uniqueCards.push(c);
    }
  });

  // 2. [í•µì‹¬] ì •ë ¬ ë¡œì§ ì ìš©
  uniqueCards.sort((a, b) => {
    // â‘  í‹°ì–´ ë‚´ë¦¼ì°¨ìˆœ (T7 -> T1)
    if (Number(b.tier) !== Number(a.tier)) {
      return Number(b.tier) - Number(a.tier);
    }
    // â‘¡ ë™ì¼ í‹°ì–´ ë‚´ CID ì˜¤ë¦„ì°¨ìˆœ
    return String(a.cid).localeCompare(String(b.cid), undefined, { numeric: true });
  });

  const selected = editId ? getSelectedCardTypes() : []; 
  const hintEl = document.getElementById('sf-card-hint');
  if (hintEl) {
    hintEl.textContent = `${targetSize}ì¥ ì„ íƒ (${selected.length}/${targetSize})`;
    hintEl.style.color = GRADE_COLOR[grade];
  }

  if (!uniqueCards.length) {
    el.innerHTML = `<span style="font-size:10px;color:var(--text3);">ì¸ë²¤í† ë¦¬ì— ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤</span>`;
    return;
  }

  // 3. ì •ë ¬ëœ uniqueCardsë¥¼ ê¸°ë°˜ìœ¼ë¡œ HTML ìƒì„±
  el.innerHTML = uniqueCards.map(card => {
    const isSel = selected.includes(card.type);
    const isDisabled = !isSel && selected.length >= targetSize;
    
    return `
      <div class="card-picker-chip${isSel ? ' selected' : ''}${isDisabled ? ' disabled' : ''}"
        onclick="togglePickerType('${card.type}')">
        <span class="card-tier-badge tb${card.tier}" style="font-size:8px; padding:0 3px; margin-right:4px; vertical-align:middle;">T${card.tier}</span>
        ${card.icon} ${card.type}
      </div>`;
  }).join('');
}

let setFilterGrade = 'all'; // all -> pair -> triple -> straight -> all
let setFilterStat = null;   // í´ë¦­í•œ ìŠ¤íƒ¯ í‚¤ ì €ì¥
// ë“±ê¸‰ ìˆœí™˜ í† ê¸€
function toggleGradeFilter() {
  const sequence = ['all', 'pair', 'triple', 'straight'];
  let idx = sequence.indexOf(setFilterGrade);
  setFilterGrade = sequence[(idx + 1) % sequence.length];
  
  const btn = document.getElementById('filter-grade-toggle');
  const labels = { all: 'ë“±ê¸‰: ì „ì²´', pair: 'ë“±ê¸‰: í˜ì–´', triple: 'ë“±ê¸‰: íŠ¸ë¦¬í”Œ', straight: 'ë“±ê¸‰: ìŠ¤íŠ¸ë ˆì´íŠ¸' };
  btn.textContent = labels[setFilterGrade];
  renderSetDefsList();
}

// ìŠ¤íƒ¯ í•„í„° í† ê¸€
function toggleStatFilter(statKey) {
  setFilterStat = statKey || null; // ì„ íƒëœ ê°’ì´ ì—†ìœ¼ë©´ null
  renderSetDefsList();
}


//ë“œë¡­ë‹¤ìš´ ë©”ë‰´ë¥¼ ì±„ì›Œì£¼ëŠ” í•¨ìˆ˜
function renderStatFilterDropdown() {
  const dropdown = document.getElementById('filter-stat-dropdown');
  if (!dropdown) return;

  // STAT_DEFSì— ì •ì˜ëœ ëª¨ë“  ìŠ¤íƒ¯ì„ <option> íƒœê·¸ë¡œ ë³€í™˜
  const options = STAT_DEFS.map(s => 
    `<option value="${s.key}">${s.label}${s.unit ? '(' + s.unit + ')' : ''}</option>`
  ).join('');

  // ì´ˆê¸°ê°’ê³¼ í•¨ê»˜ ë“œë¡­ë‹¤ìš´ì— ì‚½ì…
  dropdown.innerHTML = `<option value="">ìŠ¤íƒ¯ í•„í„°: ì „ì²´</option>` + options;
}

function renderMasterStatDropdown() {
  const dropdown = document.getElementById('master-stat-filter');
  const modalDropdown = document.getElementById('modal-stat-filter'); // ëª¨ë‹¬ìš©ë„ ëŒ€ë¹„
  if (!dropdown) return;

  const options = STAT_DEFS.map(s => 
    `<option value="${s.key}">${s.label}</option>`
  ).join('');

  dropdown.innerHTML = `<option value="">ìŠ¤íƒ¯ í•„í„°: ì „ì²´</option>` + options;
}

function getSelectedCardTypes() {
  return [...document.querySelectorAll('.card-picker-chip.selected')].map(el=>el.textContent.trim().replace(/^\S+\s*/,'').trim());
}

function togglePickerType(type) {
  const el = document.querySelector(`.card-picker-chip[onclick="togglePickerType('${type}')"]`);
  if (!el) return;
  const grade = document.querySelector('input[name="sf-grade"]:checked')?.value || 'pair';
  const targetSize = GRADE_SIZE[grade];
  const selected = getSelectedCardTypes();
  if (el.classList.contains('selected')) {
    el.classList.remove('selected');
  } else {
    if (selected.length >= targetSize) return;
    el.classList.add('selected');
  }
  // disabled ìƒíƒœ ê°±ì‹ 
  const newSel = getSelectedCardTypes();
  document.querySelectorAll('.card-picker-chip').forEach(chip => {
    const t = chip.textContent.trim().replace(/^\S+\s*/,'').trim();
    if (!newSel.includes(t)) {
      chip.classList.toggle('disabled', newSel.length >= targetSize);
    }
  });
  const hintEl = document.getElementById('sf-card-hint');
  if (hintEl) hintEl.textContent = `${targetSize}ì¥ ì„ íƒ (${newSel.length}/${targetSize})`;
}

function onGradeChange(radio) {
  renderSetFormCardPicker();
  sfPendingStats = {};
  renderSfStatList();
}

function addSetStat() {
  const key = document.getElementById('sf-stat-key').value;
  const val = parseFloat(document.getElementById('sf-stat-val').value);
  if (!key) return showToast('ìŠ¤íƒ¯ì„ ì„ íƒí•˜ì„¸ìš”','err');
  if (isNaN(val) || val <= 0) return showToast('ê°’ì„ ì…ë ¥í•˜ì„¸ìš” (0 ì´ˆê³¼)','err');
  sfPendingStats[key] = val;
  renderSfStatList();
  document.getElementById('sf-stat-key').value = '';
  document.getElementById('sf-stat-val').value = '';
}

function removeSfStat(key) {
  delete sfPendingStats[key];
  renderSfStatList();
}

function renderSfStatList() {
  const el = document.getElementById('sf-stat-list');
  if (!el) return;
  el.innerHTML = Object.entries(sfPendingStats).map(([k,v])=>{
    const d = STAT_MAP[k];
    return `<div class="sf-stat-row">
      <span class="sf-stat-row-name">${d?d.label:k}</span>
      <span class="sf-stat-row-val">+${v}${d?d.unit:''}</span>
      <button class="btn-danger" style="padding:2px 7px;font-size:9px;" onclick="removeSfStat('${k}')">âœ•</button>
    </div>`;
  }).join('') || `<span style="font-size:10px;color:var(--text3);">ë³´ë„ˆìŠ¤ ìŠ¤íƒ¯ ì—†ìŒ</span>`;
}

function saveSetDef() {
  const name = document.getElementById('sf-name').value.trim();
  const grade = document.querySelector('input[name="sf-grade"]:checked')?.value || 'pair';
  const cardTypes = getSelectedCardTypes();
  const targetSize = GRADE_SIZE[grade];
  const desc = document.getElementById('sf-desc').value.trim();
  const editId = document.getElementById('sf-edit-id').value;

  if (!name) return showToast('ì„¸íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', 'err');
  if (cardTypes.length !== targetSize) return showToast(`ì¹´ë“œ ${targetSize}ì¥ì„ ì„ íƒí•˜ì„¸ìš”`, 'err');

  // --- [ì¶”ê°€] ì œ 1ê·œì¹™ ê²€ì‚¬ ë¡œì§ ---
  const isViolation = setDefs.some(existing => {
    if (existing.id === editId) return false; // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì„¸íŠ¸ëŠ” ì œì™¸

    // 1. ë‚´ê°€ ë§Œë“¤ë ¤ëŠ” ê²Œ ìŠ¤íŠ¸ë ˆì´íŠ¸ì¸ ê²½ìš°: ê¸°ì¡´ì˜ í˜ì–´/íŠ¸ë¦¬í”Œì„ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸
    if (grade === 'straight') {
      if (existing.grade === 'pair' || existing.grade === 'triple') {
        const isContained = existing.cardTypes.every(type => cardTypes.includes(type));
        if (isContained) {
          showToast(`ê·œì¹™ ìœ„ë°˜: "${existing.name}"(${existing.grade})ì„ í¬í•¨í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`, 'err');
          return true;
        }
      }
    }
    // 2. ë‚´ê°€ ë§Œë“¤ë ¤ëŠ” ê²Œ í˜ì–´/íŠ¸ë¦¬í”Œì¸ ê²½ìš°: ê¸°ì¡´ ìŠ¤íŠ¸ë ˆì´íŠ¸ì— ë‚´ê°€ í¬í•¨ë˜ëŠ”ì§€ í™•ì¸
    else {
      if (existing.grade === 'straight') {
        const amIContained = cardTypes.every(type => existing.cardTypes.includes(type));
        if (amIContained) {
          showToast(`ê·œì¹™ ìœ„ë°˜: "${existing.name}"(ìŠ¤íŠ¸ë ˆì´íŠ¸)ì— í¬í•¨ë˜ëŠ” ì¡°í•©ì…ë‹ˆë‹¤.`, 'err');
          return true;
        }
      }
    }
    return false;
  });

  if (isViolation) return; // ìœ„ë°˜ ì‹œ í•¨ìˆ˜ ì¢…ë£Œ ë° ì €ì¥ ì¤‘ë‹¨
  // --------------------------------

  const defObj = {
    id: editId || 'set_' + uid(),
    name, grade, size: targetSize,
    cardTypes, desc,
    effect: { ...sfPendingStats },
  };

  if (editId) {
    const idx = setDefs.findIndex(s => s.id === editId);
    if (idx !== -1) setDefs[idx] = defObj;
  } else {
    setDefs.push(defObj);
  }

  resetSetForm();
  renderSetDefsList();
  renderEffectSummary();
  showToast(editId ? `"${name}" ìˆ˜ì • ì™„ë£Œ` : `"${name}" ì¶”ê°€ ì™„ë£Œ!`, 'ok');
}

function editSetDef(id) {
  const def = setDefs.find(s=>s.id===id);
  if (!def) return;
  document.getElementById('sf-name').value = def.name;
  document.getElementById('sf-desc').value = def.desc || '';
  document.getElementById('sf-edit-id').value = def.id;
  document.getElementById('set-form-title').textContent = 'âœï¸ ì„¸íŠ¸ í¸ì§‘';
  // ë“±ê¸‰ ë¼ë””ì˜¤
  const radio = document.querySelector(`input[name="sf-grade"][value="${def.grade}"]`);
  if (radio) radio.checked = true;
  sfPendingStats = {...(def.effect||{})};
  renderSfStatList();
  // ì¹´ë“œ í”¼ì»¤ ì¬ë Œë” í›„ ì„ íƒ í‘œì‹œ
  renderSetFormCardPicker();
  setTimeout(() => {
    def.cardTypes.forEach(t => {
      const el = document.querySelector(`.card-picker-chip[onclick="togglePickerType('${t}')"]`);
      if (el && !el.classList.contains('selected')) togglePickerType(t);
    });
  }, 50);
}

function deleteSetDef(id) {
  const def = setDefs.find(s=>s.id===id);
  if (!def) return;
  setDefs = setDefs.filter(s=>s.id!==id);
  renderSetDefsList();
  renderEffectSummary();
  showToast(`"${def.name}" ì„¸íŠ¸ ì‚­ì œ`,'');
}

function resetSetForm() {
  document.getElementById('sf-name').value = '';
  document.getElementById('sf-desc').value = '';
  document.getElementById('sf-edit-id').value = '';
  document.getElementById('set-form-title').textContent = 'âœ¨ ìƒˆ ì„¸íŠ¸ ì¶”ê°€';
  
  const radio = document.querySelector('input[name="sf-grade"][value="pair"]');
  if (radio) radio.checked = true;
  
  sfPendingStats = {};
  renderSfStatList();
  
  // [ì¶”ê°€] ì¹´ë“œ í”¼ì»¤ì˜ ëª¨ë“  ì„ íƒ(selected)ê³¼ ë¹„í™œì„±(disabled) í´ë˜ìŠ¤ ì œê±°
  document.querySelectorAll('.card-picker-chip').forEach(chip => {
    chip.classList.remove('selected', 'disabled');
  });
  
  renderSetFormCardPicker(); // ìƒíƒœì— ë§ì¶° ë‹¤ì‹œ ê·¸ë¦¼
}

// (êµ¬ calcSet í˜¸í™˜ - grade í‘œì‹œìš©)
function calcSet(equipped) {
  const active = calcActiveSetEffects(equipped);
  return { type: topSetGrade(active), effects: active };
}

// ==========================================
// ì¹´ë“œ CRUD
// ==========================================
let pendingStats = {}; // { StatKey: value } ì„ì‹œ ì €ì¥
let pendingUpgradeStats = Array(6).fill(null).map(() => ({})); // 0~5ê°• ì„ì‹œ ìŠ¤íƒ¯ ì €ì¥
let currentStepIdx = 0; // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ê°•í™” ë‹¨ê³„ (0:ê¸°ë³¸, 1~5:ê°•í™”)

// í¸ì§‘í•  ê°•í™” ë‹¨ê³„ ì „í™˜
function switchStep(step) {
  currentStepIdx = step;

  // step-btn í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ë²„íŠ¼ë“¤ë§Œ ì´ˆê¸°í™”
  document.querySelectorAll('.step-btn').forEach(btn => {
    btn.classList.remove('active');
  });

  // ì„ íƒëœ ë²„íŠ¼ë§Œ ê°•ì¡°
  const activeBtn = document.getElementById(`step-btn-${step}`);
  if (activeBtn) {
    activeBtn.classList.add('active');
  }

  renderStepStatEntries();
}

function addStatEntry() {
  const sel = document.getElementById('stat-select');
  const valEl = document.getElementById('stat-val');
  const key = sel.value;
  const val = parseFloat(valEl.value);
  
  if (!key) return showToast('ìŠ¤íƒ¯ì„ ì„ íƒí•˜ì„¸ìš”', 'err');
  if (isNaN(val) || val <= 0) return showToast('ê°’ì„ ì…ë ¥í•˜ì„¸ìš”', 'err');
  
  // í˜„ì¬ ì„ íƒëœ ê°•í™” ë‹¨ê³„ì— ìŠ¤íƒ¯ ì €ì¥
  pendingUpgradeStats[currentStepIdx][key] = val;
  renderStepStatEntries();
  
  valEl.value = '';
}

// 0ê°•(Base) ìŠ¤íƒ¯ì„ 1~5ê°• ì „ì²´ì— ë°°ìˆ˜(n)ë¥¼ ì ìš©í•˜ì—¬ ë³µì‚¬
function copyBaseToAll() {
  const baseStats = pendingUpgradeStats[0];
  if (Object.keys(baseStats).length === 0) {
    return showToast('ë³µì‚¬í•  0ê°• ìŠ¤íƒ¯ì´ ì—†ìŠµë‹ˆë‹¤.', 'err');
  }

  // UI ì…ë ¥ì°½ì—ì„œ nê°’ì„ ê°€ì ¸ì˜´
  const n = parseFloat(document.getElementById('copy-all-n').value);
  if (isNaN(n) || n <= 0) return showToast('ìœ íš¨í•œ ë°°ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'err');

  if (!confirm(`0ê°• ìŠ¤íƒ¯ì„ ê¸°ì¤€ìœ¼ë¡œ ë§¤ ë‹¨ê³„ ${n}ë°°ì”© ë³µë¦¬ ìƒìŠ¹ì‹œì¼œ ëª¨ë“  ë‹¨ê³„ì— ë³µì‚¬í• ê¹Œìš”?`)) return;

  for (let i = 1; i < 6; i++) {
    const power = Math.pow(n, i); 
    const newStepStats = {};
    for (const [key, val] of Object.entries(baseStats)) {
      // ì†Œìˆ˜ì  1ìë¦¬ê¹Œì§€ ë°˜ì˜¬ë¦¼
      newStepStats[key] = Math.round(val * power * 10) / 10;
    }
    pendingUpgradeStats[i] = newStepStats;
  }

  renderStepStatEntries();
  showToast(`ì „ì²´ ë‹¨ê³„ì— ${n}ë°°ìˆ˜ ìƒìŠ¹ ë³µì‚¬ ì™„ë£Œ`, 'ok');
}

// ë°”ë¡œ ì´ì „ ë‹¨ê³„ì˜ ìŠ¤íƒ¯ì— ë°°ìˆ˜(n)ë¥¼ ì ìš©í•˜ì—¬ í˜„ì¬ ë‹¨ê³„ë¡œ ê°€ì ¸ì˜¤ê¸°
function copyPrevStep() {
  if (currentStepIdx === 0) return showToast('0ê°•ì€ ì´ì „ ë‹¨ê³„ê°€ ì—†ìŠµë‹ˆë‹¤.', 'err');

  const prevStats = pendingUpgradeStats[currentStepIdx - 1];
  if (Object.keys(prevStats).length === 0) {
    return showToast('ì´ì „ ë‹¨ê³„ì— ì„¤ì •ëœ ìŠ¤íƒ¯ì´ ì—†ìŠµë‹ˆë‹¤.', 'err');
  }

  // UI ì…ë ¥ì°½ì—ì„œ nê°’ì„ ê°€ì ¸ì˜´
  const n = parseFloat(document.getElementById('copy-prev-n').value);
  if (isNaN(n) || n <= 0) return showToast('ìœ íš¨í•œ ë°°ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'err');

  const newStepStats = {};
  for (const [key, val] of Object.entries(prevStats)) {
    newStepStats[key] = Math.round(val * n * 10) / 10;
  }

  pendingUpgradeStats[currentStepIdx] = newStepStats;
  renderStepStatEntries();
  showToast(`${currentStepIdx-1}ê°• ìŠ¤íƒ¯ì˜ ${n}ë°°ë¥¼ í˜„ì¬ ë‹¨ê³„ì— ì ìš©`, 'ok');
}


function removeStatEntry(key) {
  delete pendingUpgradeStats[currentStepIdx][key];
  renderStepStatEntries();
}

function renderStepStatEntries() {
  const el = document.getElementById('stat-entries');
  const currentStats = pendingUpgradeStats[currentStepIdx];
  const keys = Object.keys(currentStats);
  
  if (!keys.length) { 
    el.innerHTML = `<div style="font-size:10px;color:var(--text3);text-align:center;padding:5px;">í˜„ì¬ ë‹¨ê³„ì— ì„¤ì •ëœ ìŠ¤íƒ¯ì´ ì—†ìŠµë‹ˆë‹¤.</div>`; 
    return; 
  }
  
  el.innerHTML = keys.map(k => {
    const def = STAT_MAP[k];
    return `<div style="display:flex;align-items:center;gap:8px;padding:5px 10px;background:var(--bg);border:1px solid var(--border2);border-radius:5px;font-size:11px;">
      <span style="flex:1;color:var(--text2);font-family:'Rajdhani',sans-serif;">${def ? def.label : k}</span>
      <span style="color:var(--gold2);font-family:'Rajdhani',sans-serif;font-weight:700;">+${currentStats[k]}${def ? def.unit : ''}</span>
      <button onclick="removeStatEntry('${k}')" style="background:none;border:none;color:var(--red);cursor:pointer;padding:0 2px;">âœ•</button>
    </div>`;
  }).join('');
}

// í‹°ì–´ ì„ íƒ ì‹œ CID ìë™ ìƒì„± ë¡œì§ ì¶”ê°€
function selTier(n, el) {
  selTierVal = n;
  // ëª¨ë“  ë²„íŠ¼ì—ì„œ active ì œê±° í›„ í´ë¦­í•œ ë²„íŠ¼ì—ë§Œ ì¶”ê°€
  document.querySelectorAll('.tier-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  
  // CID ìƒì„± ì‹¤í–‰
  generateCID(n);
}

function generateCID(tier) {
  if (!tier) return;
  
  // í˜„ì¬ ì¸ë²¤í† ë¦¬(cards)ì—ì„œ í•´ë‹¹ í‹°ì–´ì˜ ì¼ë ¨ë²ˆí˜¸ ì°¾ê¸°
  const tierCards = cards.filter(c => Number(c.tier) === Number(tier));
  let nextNum = 1;
  
  if (tierCards.length > 0) {
    // CID 170{í‹°ì–´}XXXX ì¤‘ ë 4ìë¦¬ë¥¼ ì¶”ì¶œí•˜ì—¬ ìµœëŒ€ê°’ + 1
    const nums = tierCards.map(c => {
      const cidStr = String(c.cid);
      return parseInt(cidStr.substring(4)) || 0;
    });
    nextNum = Math.max(...nums) + 1;
  }
  
  const cid = `170${tier}${String(nextNum).padStart(4, '0')}`;
  document.getElementById('c-cid').value = cid;
}

// [ì¶”ê°€] ë„ê° ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‹¤ì œ ì†Œìœ  ì¹´ë“œ ìƒì„±
function obtainCard(masterCid) {
  const master = cards.find(c => c.cid === masterCid);
  if (!master) return showToast('ë„ê° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'err');

  // ë„ê° ë°ì´í„°ì˜ 'ë³µì‚¬ë³¸'ì„ ë§Œë“­ë‹ˆë‹¤. (Deep Copy)
  const newItem = JSON.parse(JSON.stringify(master));
  
  // ì¤‘ìš”: ì¸ë²¤í† ë¦¬ ì•„ì´í…œì€ ê³ ìœ í•œ idì™€ ê°œë³„ì ì¸ ê°•í™” ìˆ˜ì¹˜ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
  newItem.id = uid();    // ì¸ë²¤í† ë¦¬ ë‚´ ê³ ìœ  ì‹ë³„ì ë¶€ì—¬
  newItem.enhance = 0;   // íšë“ ì‹œ 0ê°• ê³ ì •
  
  userInventory.push(newItem);
  renderAll();
  showToast(`"${master.name}" íšë“!`, 'ok');
}

function createCard() {
  const cid = document.getElementById('c-cid').value;
  const name = document.getElementById('c-name').value.trim();
  
  if (!cid) return showToast('í‹°ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”', 'err');
  if (!name) return showToast('ì¹´ë“œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', 'err');
  if (!Object.keys(pendingUpgradeStats[0]).length) return showToast('0ê°•(Base) ìŠ¤íƒ¯ì€ í•„ìˆ˜ì…ë‹ˆë‹¤', 'err');

  // ë°ì´í„° ë¬´ê²°ì„± ì²´í¬: 0ê°• ì´í›„ ë‹¨ê³„ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì´ì „ ë‹¨ê³„ ìŠ¤íƒ¯ìœ¼ë¡œ ë³´ì¶©
  const finalUpgradeStats = [...pendingUpgradeStats];
  for (let i = 1; i < 6; i++) {
    if (Object.keys(finalUpgradeStats[i]).length === 0) {
      finalUpgradeStats[i] = { ...finalUpgradeStats[i-1] };
    }
  }

  const newCard = {
    id: uid(),
    cid: cid,
    name: name,
    type: name,
    icon: selIconVal,
    tier: selTierVal,
    upgradeStats: finalUpgradeStats,
    stats: { ...finalUpgradeStats[0] },
    enhance: 0,
    setEffects: { pair: "", triple: "", straight: "" }
  };

  cards.push(newCard);

  //ì¹´ë“œ ìƒì„± ì‹œ ì„¸íŠ¸ ì¡°í•© íƒ­ì˜ ì¹´ë“œ ëª©ë¡ë„ ì¦‰ì‹œ ê°±ì‹  
  renderSetFormCardPicker();

  renderAll();
  clearForm(); // í¼ ì´ˆê¸°í™”

  // [ì¶”ê°€ëœ ë¶€ë¶„] í˜„ì¬ ì„ íƒëœ í‹°ì–´ì˜ ë‹¤ìŒ ì¼ë ¨ë²ˆí˜¸ë¡œ CID ì¦‰ì‹œ ê°±ì‹ 
  if (selTierVal) {
    generateCID(selTierVal); 
  }

  showToast(`"${name}" ìƒì„± ì™„ë£Œ!`, 'ok');
}

function deleteCard(id) {
  // 1. ë¨¼ì € ì¸ë²¤í† ë¦¬ì—ì„œ ì°¾ì•„ë´…ë‹ˆë‹¤.
  const invIdx = userInventory.findIndex(c => c.id === id);
  if (invIdx !== -1) {
    userInventory.splice(invIdx, 1);
    slots = slots.map(s => s && s.id === id ? null : s);
    showToast('ì¸ë²¤í† ë¦¬ ì•„ì´í…œ íŒŒê´´ë¨', '');
  } else {
    // 2. ì¸ë²¤í† ë¦¬ì— ì—†ìœ¼ë©´ ë„ê°ì—ì„œ ì‚­ì œí•©ë‹ˆë‹¤.
    const masterIdx = cards.findIndex(c => c.id === id);
    if (masterIdx !== -1) {
      if(!confirm('ë„ê° ë°ì´í„°ë¥¼ ì˜êµ¬ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      cards.splice(masterIdx, 1);
      showToast('ë„ê° ë°ì´í„° ì‚­ì œë¨', 'err');
    }
  }
  renderAll();
}

function clearAll() {
  if(!confirm('ëª¨ë“  ì¹´ë“œë¥¼ ì‚­ì œí• ê¹Œìš”?')) return;
  cards=[];slots=[null,null,null,null,null];closeEnhOverlay();renderAll();
}
function clearForm() {
  document.getElementById('c-name').value = '';
  document.getElementById('c-cid').value = '';
  pendingUpgradeStats = Array(6).fill(null).map(() => ({}));
  switchStep(0); // 0ê°• ì…ë ¥ ìƒíƒœë¡œ ë³µê·€
  renderStepStatEntries();
}

// ==========================================
// íƒ­ / ê¸°íƒ€
// ==========================================
function switchTab(tab) {
  document.querySelectorAll('.tab-content').forEach(el=>el.style.display='none');
  document.querySelectorAll('.tab-btn').forEach(el=>el.classList.remove('active'));
  document.getElementById('tab-'+tab).style.display='block';
  ['equip','create','config','sets'].forEach((t,i)=>{
    if(t===tab) document.querySelectorAll('.tab-btn')[i].classList.add('active');
  });
  if(tab==='sets') renderSetDefsTab();
}

function selIcon(ic){ selIconVal=ic; renderIconGrid(); }
function filterInv(f,el){
  invFilterVal=f;
  document.querySelectorAll('#inv-filter .filter-chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active'); renderInventory();
}

// ==========================================
// CSV Export (PrototypeDB.csv í¬ë§·)
// ==========================================
function exportCSV() {
  if (!cards.length) return showToast('ë‚´ë³´ë‚¼ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤', 'err');

  // 1. CID ê¸°ì¤€ìœ¼ë¡œ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ì •ë ¬
  const sortedCards = [...cards].sort((a, b) => {
    return String(a.cid).localeCompare(String(b.cid), undefined, { numeric: true });
  });

  const rows = [];
  // í—¤ë”ëª…ì„ Iconì—ì„œ IconIndexë¡œ ëª…í™•íˆ ë³€ê²½
  rows.push('Cid,Name,UpgradeStep,StatName,Stat,Tier,IconIndex');

  const tierLabel = n => `Tier${n}`;

  // 2. ì •ë ¬ëœ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ í–‰ ìƒì„±
  sortedCards.forEach(card => {
    const tierStr = tierLabel(card.tier);
    
    // [ì¤‘ìš”] ì•„ì´ì½˜ ë¬¸ìë¥¼ ICONS ë°°ì—´ì—ì„œ ì°¾ì•„ 'ì¸ë±ìŠ¤ ë²ˆí˜¸'ë¥¼ ì¶”ì¶œ
    // ë§Œì•½ ì°¾ì§€ ëª»í•˜ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ 0(ì²« ë²ˆì§¸ ì•„ì´ì½˜)ì„ í• ë‹¹
    const iconIdx = ICONS.indexOf(card.icon);
    const saveIdx = (iconIdx !== -1) ? iconIdx : 0;

    if (card.upgradeStats && card.upgradeStats.length > 0) {
      card.upgradeStats.forEach((stepStats, step) => {
        Object.entries(stepStats).forEach(([statKey, val]) => {
          const def = STAT_MAP[statKey];
          const statName = def ? def.label : statKey;
          // ë§ˆì§€ë§‰ ì»¬ëŸ¼ì— saveIdx(ìˆ«ì)ë¥¼ ë„£ìŠµë‹ˆë‹¤.
          rows.push(`${card.cid||''},${card.name},${step},${statName},${val},${tierStr},${saveIdx}`);
        });
      });
    } else {
      // ë ˆê±°ì‹œ ëŒ€ì‘ìš© (upgradeStatsê°€ ì—†ëŠ” ê²½ìš°)
      Object.entries(card.stats||{}).forEach(([statKey, val]) => {
        if (val > 0) {
          const def = STAT_MAP[statKey];
          const statName = def ? def.label : statKey;
          rows.push(`${card.cid||'custom'},${card.name},0,${statName},${val},${tierStr},${saveIdx}`);
        }
      });
    }
  });

  const csv = rows.join('\n');
  const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  // íŒŒì¼ëª…ì— Indexì„ì„ ëª…ì‹œí•˜ì—¬ êµ¬ë¶„í•˜ê¸° ì‰½ê²Œ í•©ë‹ˆë‹¤.
  a.download = `PrototypeDB_Index_export_${new Date().toISOString().slice(0, 10)}.csv`;
  a.click();
  URL.revokeObjectURL(url);
  
  showToast(`${sortedCards.length}ê°œ ì¹´ë“œ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!`, 'ok');
}

// ==========================================
// CSV Import (PrototypeDB.csv í¬ë§·)
// ==========================================
function importCSV(event) {
  const file = event.target.files[0];
  if (!file) return;
  event.target.value = ''; // íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥í•˜ê²Œ ì´ˆê¸°í™”

  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const text = e.target.result.replace(/^\uFEFF/, ''); // BOM ì œê±°
      const lines = text.split(/\r?\n/).filter(l => l.trim());
      if (!lines.length) return showToast('ë¹ˆ íŒŒì¼ì…ë‹ˆë‹¤', 'err');

      // í—¤ë” íŒŒì‹±
      const header = lines[0].split(',').map(h => h.trim().toLowerCase());
      const idxCid  = header.indexOf('cid');
      const idxName = header.indexOf('name');
      const idxStep = header.indexOf('upgradestep');
      const idxStat = header.indexOf('statname');
      const idxVal  = header.indexOf('stat');
      const idxTier = header.indexOf('tier');
      const idxIcon = header.indexOf('iconindex'); // ì¸ë±ìŠ¤ ê¸°ë°˜ ì•„ì´ì½˜ ì»¬ëŸ¼

      // [ë³µêµ¬ ì™„ë£Œ] í•„ìˆ˜ í—¤ë” ì˜ˆì™¸ ì²˜ë¦¬ êµ¬ë¬¸
      if ([idxCid, idxName, idxStep, idxStat, idxVal, idxTier].some(i => i === -1)) {
        return showToast('CSV í¬ë§· ì˜¤ë¥˜: í•„ìˆ˜ í—¤ë”ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'err');
      }

      // StatName ë§¤í•‘ ì •ë³´ ì¤€ë¹„
      const labelToKey = {};
      STAT_DEFS.forEach(s => {
        labelToKey[s.label] = s.key;
        labelToKey[s.key] = s.key;
      });

      const cardMap = new Map();
      for (let i = 1; i < lines.length; i++) {
        const cols = lines[i].split(',').map(c => c.trim());
        if (cols.length < 6) continue;

        const cid = cols[idxCid];
        if (!cardMap.has(cid)) {
          // IconIndexê°€ ìˆìœ¼ë©´ í•´ë‹¹ ì¸ë±ìŠ¤ì˜ ì•„ì´ì½˜ì„, ì—†ê±°ë‚˜ ì˜ëª»ëìœ¼ë©´ 0ë²ˆ ì•„ì´ì½˜ ì‚¬ìš©
          const iconNum = (idxIcon !== -1) ? parseInt(cols[idxIcon]) : 0;
          const iconChar = ICONS[iconNum] || ICONS[0];

          cardMap.set(cid, {
            cid: cid,
            name: cols[idxName],
            tier: parseInt(cols[idxTier].replace(/[^0-9]/g, '')) || 1,
            icon: iconChar,
            upgradeStats: [{},{},{},{},{},{}]
          });
        }
        
        const statKey = labelToKey[cols[idxStat]] || null;
        if (statKey) {
          const step = Math.max(0, Math.min(5, parseInt(cols[idxStep]) || 0));
          const val = parseFloat(cols[idxVal]) || 0;
          cardMap.get(cid).upgradeStats[step][statKey] = val;
        }
      }

      // ê¸°ì¡´ cards ë°°ì—´ ì—…ë°ì´íŠ¸ ë˜ëŠ” ì‹ ê·œ ì¶”ê°€
      cardMap.forEach(entry => {
        const existingIdx = cards.findIndex(c => c.cid === entry.cid);
        
        // ë¹ˆ ë‹¨ê³„ ë³´ì • (ì• ë‹¨ê³„ ìŠ¤íƒ¯ìœ¼ë¡œ ì±„ì›€)
        for (let s = 1; s < 6; s++) {
          if (Object.keys(entry.upgradeStats[s]).length === 0) {
            entry.upgradeStats[s] = {...entry.upgradeStats[s-1]};
          }
        }

        const cardObj = {
          id: existingIdx !== -1 ? cards[existingIdx].id : uid(),
          cid: entry.cid,
          name: entry.name,
          type: entry.name,
          icon: entry.icon,
          tier: entry.tier,
          upgradeStats: entry.upgradeStats,
          stats: {...entry.upgradeStats[0]},
          enhance: 0,
          setEffects: { pair: "", triple: "", straight: "" }
        };

        if (existingIdx !== -1) {
          cards[existingIdx] = cardObj;
        } else {
          cards.push(cardObj);
        }
      });

      renderAll();
      showToast(`ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ`, 'ok');
    } catch(err) {
      console.error(err);
      showToast('CSV ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'err');
    }
  };
  reader.readAsText(file, 'UTF-8');
}

// ==========================================
// ì¹´ë“œ íˆ´íŒ ì˜¤ë²„ë ˆì´
// ==========================================
function openCardTooltip(cardId) {
  const invCard = userInventory.find(c => c.id === cardId); //í´ë¦­ì¤‘ì¸ê²Œ ì‹¤ë¬¼ ì¹´ë“œë‹ˆ? ë„ê° ì¹´ë“œë‹ˆ? ì‹¤ë¬¼ ì¹´ë“œì—¬ì•¼ë§Œ ê°•í™”,íŒŒê´´ ë²„íŠ¼ì„ ë³´ì—¬ì¤€ë‹¤.
  const masterCard = cards.find(c => c.id === cardId);
  const card = invCard || masterCard;
  if (!card) return;

  const tc = TCOLOR[card.tier];
  const tierBg = TIER_BG[card.tier]||'rgba(255,255,255,.03)';
  const eff = effStats(card);

  // â”€â”€ í—¤ë” â”€â”€
  const pips = card.enhance>0
    ? `<span class="enh-badge lv${card.enhance}" style="margin-right:4px;">+${card.enhance}ê°•</span>`
    : `<span class="enh-badge" style="margin-right:4px;">0ê°•</span>`;
  document.getElementById('ctt-header').innerHTML = `
    <div class="ctt-big-icon" style="border-color:${tc};background:${tierBg};">${card.icon}</div>
    <div class="ctt-title-block">
      <div class="ctt-name">${card.name}</div>
      <div class="ctt-sub" style="color:${tc}">T${card.tier} &nbsp;Â·&nbsp; ${card.type}</div>
      <div>${pips}</div>
    </div>
    <div class="ctt-close-hint">ESC / ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°</div>`;

  // â”€â”€ ë°”ë”” â”€â”€
  let body = '';

  // í˜„ì¬ ìŠ¤íƒ¯
  body += `<div class="ctt-section-label">í˜„ì¬ ëŠ¥ë ¥ì¹˜</div>`;
  const effEntries = Object.entries(eff).filter(([,v])=>v>0);
  if (effEntries.length) {
    body += effEntries.map(([k,v])=>{
      const def=STAT_MAP[k];
      const unit=def?def.unit:'';
      const label=def?def.label:k;
      return `<div class="ctt-stat-row">
        <span class="ctt-stat-name">${label}</span>
        <span class="ctt-stat-val">+${v}${unit}</span>
      </div>`;
    }).join('');
  } else {
    body += `<div style="font-size:10px;color:var(--text3);padding:4px;">ìŠ¤íƒ¯ ì—†ìŒ</div>`;
  }

  // ì—…ê·¸ë ˆì´ë“œ ë‹¨ê³„ë³„ ìŠ¤íƒ¯ (upgradeStats ìˆëŠ” ì¹´ë“œë§Œ)
  if (card.upgradeStats && card.upgradeStats.length > 1) {
    body += `<div class="ctt-section-label">ê°•í™” ë‹¨ê³„ë³„ ëŠ¥ë ¥ì¹˜</div>`;
    // ìŠ¤íƒ¯ í‚¤ ì¶”ì¶œ
    const keys = [...new Set(card.upgradeStats.flatMap(s=>Object.keys(s)))];
    const stepColors = ['var(--text2)','var(--e1)','var(--e2)','var(--e3)','var(--e4)','var(--e5)'];
    body += `<table class="ctt-upgrade-table">
      <thead><tr><th>ê°•í™”</th>${keys.map(k=>{
        const def=STAT_MAP[k]; return `<th>${def?def.label:k}</th>`;
      }).join('')}</tr></thead>
      <tbody>${card.upgradeStats.map((stepStats, step)=>{
        const isActive = step===card.enhance;
        const stepLabel = step===0 ? 'ê¸°ë³¸' : `+${step}ê°•`;
        const color = stepColors[step]||'var(--text2)';
        return `<tr${isActive?' class="active-step"':''}>
          <td style="color:${color};font-weight:700;">${stepLabel}</td>
          ${keys.map(k=>{
            const def=STAT_MAP[k];
            const unit=def?def.unit:'';
            const v=stepStats[k]||0;
            return `<td>+${v}${unit}</td>`;
          }).join('')}
        </tr>`;
      }).join('')}</tbody>
    </table>`;
  }


// ì—­ì¶”ì : ì´ ì¹´ë“œê°€ í¬í•¨ëœ ì„¸íŠ¸ ì°¾ê¸°
  const relatedSets = setDefs.filter(def => def.cardTypes.includes(card.type));
  
  let relatedSetsHtml = `<div class="ctt-section-label">í¬í•¨ëœ ì„¸íŠ¸ ì¡°í•© (${relatedSets.length})</div>`;
  
  if (relatedSets.length > 0) {
    relatedSetsHtml += `<div style="display:flex; flex-direction:column; gap:6px;">`;
    relatedSetsHtml += relatedSets.map(set => {
      const gc = GRADE_COLOR[set.grade] || 'var(--text3)';
      const gl = GRADE_LABEL[set.grade] || set.grade;
      return `
        <div style="padding:8px; background:rgba(255,255,255,.03); border:1px solid var(--border); border-radius:6px; cursor:pointer;" 
             onclick="closeCardTooltip(); switchTab('sets'); focusSet('${set.id}')">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px;">
            <span style="font-size:11px; font-weight:700; color:var(--text1);">${set.name}</span>
            <span style="font-family:'Rajdhani',sans-serif; font-size:9px; color:${gc}; font-weight:700;">${gl}</span>
          </div>
          <div style="font-size:9px; color:var(--text3);">${set.cardTypes.join(' Â· ')}</div>
        </div>`;
    }).join('');
    relatedSetsHtml += `</div>`;
  } else {
    relatedSetsHtml += `<div style="font-size:10px; color:var(--text3); padding:4px;">í¬í•¨ëœ ì„¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
  }

  // ê¸°ì¡´ body ë‚´ìš©ì— ì—­ì¶”ì  ì„¹ì…˜ ê²°í•©
  document.getElementById('ctt-body').innerHTML = body + relatedSetsHtml;

  // â”€â”€ í‘¸í„° (ì•¡ì…˜ ë²„íŠ¼) â”€â”€
  let footerBtns = '';

  if (invCard) {
    // [A] ì¸ë²¤í† ë¦¬ì— ìˆëŠ” "ì‹¤ë¬¼ ì¹´ë“œ"ì¼ ë•Œë§Œ ê°•í™”/ì‚­ì œ ë²„íŠ¼ ë…¸ì¶œ
    const isEquipped = slots.some(s => s && s.id === cardId);
    const isMax = card.enhance >= 5;

    if (isEquipped) {
      footerBtns += `<span style="font-size:10px;color:var(--green);font-family:'Rajdhani',sans-serif;font-weight:700;flex:1;display:flex;align-items:center;justify-content:center;">âœ“ ì¥ì°©ì¤‘</span>`;
    } else {
      footerBtns += `<button class="btn-sm" style="flex:1;" onclick="quickEquip('${cardId}');closeCardTooltip()">ì¥ì°©</button>`;
    }

    if (!isMax) {
      footerBtns += `<button class="btn-enh" style="flex:1;" onclick="closeCardTooltip();openEnhOverlay('${cardId}')">ğŸ”¥ ê°•í™”</button>`;
    } else {
      footerBtns += `<span style="font-size:10px;color:var(--t7);font-family:'Rajdhani',sans-serif;font-weight:700;flex:1;display:flex;align-items:center;justify-content:center;">â­ MAX</span>`;
    }

    footerBtns += `<button class="btn-danger" style="flex:1;" onclick="deleteCard('${cardId}');closeCardTooltip()">ì‚­ì œ</button>`;

  } else {
    // [B] ë„ê°(Master)ì— ìˆëŠ” ì¹´ë“œì¼ ë•Œ: ê°•í™”/ì‚­ì œ ìˆ¨ê¸°ê³  "íšë“" ë²„íŠ¼ë§Œ ë…¸ì¶œ
    footerBtns += `<button class="btn-import" style="flex:1;" onclick="obtainCard('${card.cid}');closeCardTooltip()">â• ì¸ë²¤í† ë¦¬ íšë“</button>`;
    footerBtns += `<button class="btn-sm" style="flex:1;" onclick="closeCardTooltip()">ë‹«ê¸°</button>`;
  }

  document.getElementById('ctt-footer').innerHTML = footerBtns;
  document.getElementById('card-tooltip-overlay').classList.add('open');
}

// íŠ¹ì • ì„¸íŠ¸ë¥¼ ê°•ì¡°í•´ì£¼ëŠ” ë³´ì¡° í•¨ìˆ˜
function focusSet(setId) {
  // ê²€ìƒ‰ì°½ì„ í•´ë‹¹ ì„¸íŠ¸ ì´ë¦„ìœ¼ë¡œ ì±„ì›Œ í•„í„°ë§ íš¨ê³¼ë¥¼ ì¤Œ
  const set = setDefs.find(s => s.id === setId);
  if (set) {
    const searchInput = document.getElementById('set-search');
    if (searchInput) {
      searchInput.value = set.name;
      renderSetDefsList();
    }
  }
}

function closeCardTooltip() {
  document.getElementById('card-tooltip-overlay').classList.remove('open');
}

// ESC í‚¤ë¡œ íˆ´íŒ/ê°•í™”ì˜¤ë²„ë ˆì´ ë‹«ê¸°
document.addEventListener('keydown', e=>{
  if (e.key==='Escape') {
    closeCardTooltip();
    closeEnhOverlay();
  }
});

// í† ìŠ¤íŠ¸
let toastT;
function showToast(msg,type=''){
  const el=document.getElementById('toast');
  el.textContent=msg; el.className='show'+(type?' '+type:'');
  clearTimeout(toastT); toastT=setTimeout(()=>el.className='',2400);
}

init();
</script>


</body></html>